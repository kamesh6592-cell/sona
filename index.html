<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Secure Hierarchical Communication Platform for Sona College of Technology">
    <meta name="theme-color" content="#1E3A8A">
    
    <!-- Favicon -->
    <link rel="icon" href="https://upload.wikimedia.org/wikipedia/commons/9/9d/Sona_College_of_Technology_logo.jpg" type="image/jpeg">
    <link rel="apple-touch-icon" href="https://upload.wikimedia.org/wikipedia/commons/9/9d/Sona_College_of_Technology_logo.jpg">
    <link rel="manifest" href="data:application/json;base64,eyJuYW1lIjoiU29uYSBDb21tdW5pY2F0aW9uIiwic2hvcnRfbmFtZSI6IlNvbmFDb21tIiwic3RhcnRfdXJsIjoiLiIsImRpc3BsYXkiOiJzdGFuZGFsb25lIiwiYmFja2dyb3VuZF9jb2xvciI6IiMwYTE5MmYiLCJ0aGVtZV9jb2xvciI6IiMxRTNBOEEiLCJvcmllbnRhdGlvbiI6InBvcnRyYWl0In0=">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Sona Communication">
    
    <title>Sona College of Technology - Communication Platform</title>
    
    <!-- Preconnect to external domains for performance -->
    <link rel="preconnect" href="https://rsms.me/">
    <link rel="preconnect" href="https://cdnjs.cloudflare.com">
    <link rel="preconnect" href="https://cdn.jsdelivr.net">
    
    <!-- CSS -->
    <link rel="stylesheet" href="https://rsms.me/inter/inter.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/tonsky/FiraCode@4/distr/fira_code.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-firestore-compat.js"></script>
    
    <!-- JavaScript -->
    <script src="https://cdn.socket.io/4.7.5/socket.io.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
    
    <style>
        /* CSS Variables for theming - Light Mode */
        :root {
            --primary-blue: #0a192f;
            --secondary-blue: #172a45;
            --accent-blue: #233554;
            --primary-yellow: #f1c40f;
            --secondary-yellow: #f9e79f;
            --accent-yellow: #ffd700;
            --text-primary: #ffffff;
            --text-secondary: #a8b2d1;
            --text-muted: #64748b;
            --success: #4ade80;
            --warning: #f59e0b;
            --error: #ef4444;
            --info: #3b82f6;
            --glass-bg: rgba(255, 255, 255, 0.05);
            --glass-border: rgba(255, 255, 255, 0.1);
            --font-family: 'Inter', sans-serif;
            --mono-font: 'Fira Code', monospace;
            --card-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1), 0 8px 10px -6 rgba(0, 0, 0, 0.1);
            --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            --border-radius: 16px;
            --input-padding: 1rem;
            --button-padding: 1rem 1.5rem;
            --background-color: #f8fafc;
            --card-background: #ffffff;
            --header-background: #ffffff;
            --footer-background: #f1f5f9;
            --input-background: #ffffff;
            --input-border: #e2e8f0;
            --button-text: #0a192f;
        }

        /* Dark Mode Variables */
        [data-theme="dark"] {
            --primary-blue: #0f172a;
            --secondary-blue: #1e293b;
            --accent-blue: #334155;
            --primary-yellow: #f1c40f;
            --secondary-yellow: #f9e79f;
            --accent-yellow: #ffd700;
            --text-primary: #f8fafc;
            --text-secondary: #cbd5e1;
            --text-muted: #94a3b8;
            --success: #4ade80;
            --warning: #f59e0b;
            --error: #ef4444;
            --info: #60a5fa;
            --glass-bg: rgba(30, 41, 59, 0.5);
            --glass-border: rgba(148, 163, 184, 0.1);
            --background-color: #0f172a;
            --card-background: #1e293b;
            --header-background: #1e293b;
            --footer-background: #0f172a;
            --input-background: #334155;
            --input-border: #475569;
            --button-text: #0f172a;
        }

        /* Base styles */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html {
            font-size: 16px;
            scroll-behavior: smooth;
        }

        body {
            font-family: var(--font-family);
            background-color: var(--background-color);
            color: var(--text-primary);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            overflow-x: hidden;
            position: relative;
            transition: background-color 0.3s ease;
        }

        /* Background pattern */
        .background-pattern {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: 
                radial-gradient(circle at 10% 20%, rgba(255, 255, 255, 0.05) 0%, transparent 20%),
                radial-gradient(circle at 90% 80%, rgba(255, 255, 255, 0.05) 0%, transparent 20%),
                radial-gradient(circle at 50% 50%, rgba(255, 255, 255, 0.03) 0%, transparent 50%);
            z-index: -1;
        }

        /* Header */
        .header {
            background-color: var(--header-background);
            backdrop-filter: blur(10px);
            padding: 1rem 2rem;
            display: flex;
            align-items: center;
            justify-content: space-between;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            z-index: 100;
            border-bottom: 1px solid var(--glass-border);
            transition: background-color 0.3s ease;
        }

        .logo-container {
            display: flex;
            align-items: center;
            gap: 1.25rem;
        }

        .logo {
            height: 50px;
            width: auto;
            filter: drop-shadow(0 2px 4px rgba(0,0,0,0.1));
            transition: var(--transition);
        }

        .logo:hover {
            transform: scale(1.05);
        }

        .logo-text {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--primary-blue);
            transition: var(--transition);
        }

        /* Header Controls */
        .header-controls {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        /* Language Selector */
        .language-selector {
            position: relative;
        }

        .language-button {
            background: none;
            border: 1px solid var(--input-border);
            border-radius: 8px;
            padding: 0.5rem 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            cursor: pointer;
            color: var(--text-primary);
            font-size: 0.9rem;
            transition: var(--transition);
        }

        .language-button:hover {
            background-color: var(--glass-bg);
        }

        .language-dropdown {
            position: absolute;
            top: 100%;
            right: 0;
            margin-top: 0.5rem;
            background-color: var(--card-background);
            border-radius: var(--border-radius);
            box-shadow: var(--card-shadow);
            min-width: 200px;
            z-index: 1000;
            display: none;
            overflow: hidden;
        }

        .language-dropdown.show {
            display: block;
        }

        .language-option {
            padding: 0.75rem 1rem;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .language-option:hover {
            background-color: var(--glass-bg);
        }

        .language-option.active {
            background-color: var(--primary-yellow);
            color: var(--button-text);
        }

        /* Theme Toggle */
        .theme-toggle {
            background: none;
            border: 1px solid var(--input-border);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            color: var(--text-primary);
            transition: var(--transition);
        }

        .theme-toggle:hover {
            background-color: var(--glass-bg);
        }

        /* Main Container */
        .main-container {
            flex: 1;
            display: flex;
            flex-direction: column;
            padding: 2rem;
            max-width: 1200px;
            margin: 0 auto;
            width: 100%;
        }

        /* Tab Navigation */
        .tab-navigation {
            display: flex;
            border-bottom: 2px solid var(--glass-border);
            margin-bottom: 2rem;
            overflow-x: auto;
        }

        .tab-button {
            padding: 1rem 1.5rem;
            background: none;
            border: none;
            color: var(--text-secondary);
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            white-space: nowrap;
            position: relative;
        }

        .tab-button:hover {
            color: var(--text-primary);
        }

        .tab-button.active {
            color: var(--primary-yellow);
        }

        .tab-button.active::after {
            content: '';
            position: absolute;
            bottom: -2px;
            left: 0;
            width: 100%;
            height: 2px;
            background-color: var(--primary-yellow);
        }

        /* Tab Content */
        .tab-content {
            display: none;
            animation: fadeIn 0.5s ease;
        }

        .tab-content.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Login Container */
        .login-container {
            background-color: var(--card-background);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            padding: 3rem;
            border-radius: var(--border-radius);
            box-shadow: var(--card-shadow);
            width: 100%;
            max-width: 500px;
            margin: 0 auto;
            animation: fadeInUp 0.6s ease-out;
            position: relative;
            overflow: hidden;
            border: 1px solid var(--glass-border);
            transition: background-color 0.3s ease;
        }

        .login-container::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 5px;
            background: linear-gradient(90deg, var(--primary-yellow), var(--accent-yellow));
        }

        @keyframes fadeInUp {
            from { opacity: 0; transform: translateY(30px) scale(0.95); }
            to { opacity: 1; transform: translateY(0) scale(1); }
        }

        /* Logo and title */
        .app-title {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-bottom: 2.5rem;
        }

        h1 {
            font-size: 2.25rem;
            font-weight: 700;
            color: var(--primary-blue);
            margin-bottom: 0.5rem;
            background: linear-gradient(90deg, var(--primary-yellow), var(--accent-yellow));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .subtitle {
            font-size: 1.125rem;
            color: var(--text-secondary);
            text-align: center;
        }

        /* Form styles */
        .form-group {
            margin-bottom: 1.75rem;
            position: relative;
        }

        label {
            display: block;
            margin-bottom: 0.75rem;
            font-size: 0.875rem;
            font-weight: 600;
            color: var(--text-primary);
            transition: var(--transition);
        }

        .input-container {
            position: relative;
            display: flex;
            align-items: center;
        }

        .input-icon {
            position: absolute;
            left: 1.25rem;
            color: var(--text-secondary);
            z-index: 1;
            transition: var(--transition);
        }

        input, select {
            width: 100%;
            padding: var(--input-padding);
            padding-left: 3.5rem;
            border: 2px solid var(--input-border);
            border-radius: var(--border-radius);
            font-size: 1rem;
            transition: var(--transition);
            background-color: var(--input-background);
            color: var(--text-primary);
            font-family: var(--font-family);
        }

        select {
            appearance: none;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' viewBox='0 0 24 24' fill='none' stroke='%23a8b2d1' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpolyline points='6 9 12 15 18 9'%3E%3C/polyline%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 1.25rem center;
            background-size: 1rem;
        }

        input:focus, select:focus {
            border-color: var(--primary-yellow);
            box-shadow: 0 0 0 3px rgba(241, 196, 15, 0.15);
            outline: none;
        }

        input:focus + .input-icon, select:focus + .input-icon {
            color: var(--primary-yellow);
        }

        .password-toggle {
            position: absolute;
            right: 1.25rem;
            background: none;
            border: none;
            color: var(--text-secondary);
            cursor: pointer;
            transition: var(--transition);
            padding: 0.5rem;
            border-radius: 8px;
        }

        .password-toggle:hover {
            color: var(--text-primary);
            background-color: var(--glass-bg);
        }

        /* Form options */
        .form-options {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin: 1.75rem 0;
            flex-wrap: wrap;
            gap: 1rem;
        }

        .checkbox-group {
            display: flex;
            align-items: center;
        }

        .checkbox-group input {
            width: auto;
            margin-right: 0.75rem;
            accent-color: var(--primary-yellow);
        }

        .checkbox-group label {
            margin-bottom: 0;
            font-size: 0.875rem;
            color: var(--text-secondary);
            cursor: pointer;
        }

        .forgot-link {
            font-size: 0.875rem;
            color: var(--info);
            text-decoration: none;
            transition: var(--transition);
            font-weight: 600;
        }

        .forgot-link:hover {
            color: var(--primary-yellow);
            text-decoration: underline;
        }

        /* Buttons */
        .btn {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 100%;
            padding: var(--button-padding);
            border: none;
            border-radius: var(--border-radius);
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            position: relative;
            overflow: hidden;
            margin-bottom: 1rem;
            gap: 0.75rem;
            text-decoration: none;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary-yellow) 0%, var(--accent-yellow) 100%);
            color: var(--button-text);
            box-shadow: 0 4px 15px rgba(241, 196, 15, 0.3);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(241, 196, 15, 0.4);
        }

        .btn-primary:active {
            transform: translateY(0);
        }

        .btn-microsoft {
            background: var(--info);
            color: var(--white);
            box-shadow: 0 4px 15px rgba(59, 130, 246, 0.3);
        }

        .btn-microsoft:hover {
            background: #2563eb;
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(59, 130, 246, 0.4);
        }

        .btn-google {
            background: #ea4335;
            color: var(--white);
            box-shadow: 0 4px 15px rgba(234, 67, 53, 0.3);
        }

        .btn-google:hover {
            background: #d33b2c;
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(234, 67, 53, 0.4);
        }

        .btn-loading .btn-text {
            visibility: hidden;
            opacity: 0;
        }

        .btn-loading::after {
            content: "";
            position: absolute;
            width: 20px;
            height: 20px;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            margin: auto;
            border: 2px solid transparent;
            border-top-color: var(--white);
            border-radius: 50%;
            animation: button-loading-spinner 1s ease infinite;
        }

        @keyframes button-loading-spinner {
            from { transform: rotate(0turn); }
            to { transform: rotate(1turn); }
        }

        /* Divider */
        .divider {
            display: flex;
            align-items: center;
            margin: 2rem 0;
            color: var(--text-secondary);
            font-size: 0.875rem;
        }

        .divider::before,
        .divider::after {
            content: "";
            flex: 1;
            height: 1px;
            background: var(--glass-border);
        }

        .divider span {
            padding: 0 1.5rem;
        }

        /* Role badges */
        .role-badges {
            display: flex;
            gap: 1rem;
            margin-top: 1.25rem;
            justify-content: center;
            flex-wrap: wrap;
        }

        .role-badge {
            padding: 0.75rem 1.25rem;
            border-radius: 30px;
            font-size: 0.875rem;
            font-weight: 600;
            background-color: var(--glass-bg);
            color: var(--text-secondary);
            transition: var(--transition);
            cursor: pointer;
            user-select: none;
            border: 1px solid var(--glass-border);
            position: relative;
            overflow: hidden;
        }

        .role-badge::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, var(--primary-yellow), var(--accent-yellow));
            opacity: 0;
            transition: opacity 0.3s ease;
            z-index: -1;
        }

        .role-badge:hover {
            background-color: rgba(255, 255, 255, 0.1);
            border-color: var(--primary-yellow);
            transform: translateY(-2px);
        }

        .role-badge.active {
            background-color: var(--primary-yellow);
            color: var(--button-text);
            border-color: var(--primary-yellow);
            box-shadow: 0 4px 10px rgba(241, 196, 15, 0.3);
        }

        .role-badge.active::before {
            opacity: 1;
        }

        .role-student.active {
            background: linear-gradient(135deg, #4ade80, #22c55e);
        }

        .role-faculty.active {
            background: linear-gradient(135deg, #3b82f6, #2563eb);
        }

        .role-hod.active {
            background: linear-gradient(135deg, #8b5cf6, #7c3aed);
        }

        .role-principal.active {
            background: linear-gradient(135deg, #f59e0b, #d97706);
        }

        /* Register link */
        .register-link {
            text-align: center;
            margin-top: 2rem;
            font-size: 0.875rem;
            color: var(--text-secondary);
        }

        .register-link a {
            color: var(--info);
            text-decoration: none;
            font-weight: 600;
            transition: var(--transition);
        }

        .register-link a:hover {
            color: var(--primary-yellow);
            text-decoration: underline;
        }

        /* Security notice */
        .security-notice {
            margin-top: 2rem;
            padding: 1.25rem;
            background-color: rgba(241, 196, 15, 0.1);
            border-radius: var(--border-radius);
            font-size: 0.875rem;
            color: var(--text-primary);
            text-align: center;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.75rem;
            border-left: 4px solid var(--primary-yellow);
        }

        /* Modal styles */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            backdrop-filter: blur(5px);
            padding: 1rem;
        }

        .modal-content {
            background-color: var(--card-background);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            padding: 3rem;
            border-radius: var(--border-radius);
            max-width: 500px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            position: relative;
            animation: modalFadeIn 0.3s ease-out;
            box-shadow: var(--card-shadow);
            border: 1px solid var(--glass-border);
            transition: background-color 0.3s ease;
        }

        @keyframes modalFadeIn {
            from { opacity: 0; transform: scale(0.9) translateY(-20px); }
            to { opacity: 1; transform: scale(1) translateY(0); }
        }

        .close-btn {
            position: absolute;
            top: 1.5rem;
            right: 1.5rem;
            font-size: 1.5rem;
            color: var(--text-secondary);
            cursor: pointer;
            transition: var(--transition);
            background: none;
            border: none;
            width: 2.5rem;
            height: 2.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
        }

        .close-btn:hover {
            color: var(--text-primary);
            background-color: var(--glass-bg);
        }

        .modal h2 {
            margin-bottom: 1.75rem;
            color: var(--primary-yellow);
            font-size: 1.75rem;
        }

        /* Password strength */
        .password-strength {
            margin-top: 0.75rem;
            height: 4px;
            border-radius: 2px;
            background-color: var(--glass-border);
            overflow: hidden;
        }

        .password-strength-bar {
            height: 100%;
            width: 0%;
            transition: var(--transition);
        }

        .password-strength.weak .password-strength-bar {
            width: 33%;
            background-color: var(--error);
        }

        .password-strength.medium .password-strength-bar {
            width: 66%;
            background-color: var(--warning);
        }

        .password-strength.strong .password-strength-bar {
            width: 100%;
            background-color: var(--success);
        }

        .password-strength-text {
            font-size: 0.75rem;
            margin-top: 0.5rem;
            color: var(--text-secondary);
        }

        /* Notification */
        .notification {
            position: fixed;
            top: 1.5rem;
            right: 1.5rem;
            padding: 1.25rem 1.75rem;
            border-radius: var(--border-radius);
            color: var(--white);
            font-weight: 600;
            box-shadow: var(--card-shadow);
            z-index: 1100;
            transform: translateX(150%);
            transition: transform 0.3s ease;
            max-width: 90%;
        }

        .notification.show {
            transform: translateX(0);
        }

        .notification.success {
            background-color: var(--success);
        }

        .notification.error {
            background-color: var(--error);
        }

        .notification.info {
            background-color: var(--info);
        }

        /* Tooltip */
        .tooltip {
            position: relative;
            display: inline-block;
        }

        .tooltip .tooltiptext {
            visibility: hidden;
            width: 200px;
            background-color: var(--secondary-blue);
            color: var(--white);
            text-align: center;
            border-radius: 6px;
            padding: 0.5rem;
            position: absolute;
            z-index: 1;
            bottom: 125%;
            left: 50%;
            margin-left: -100px;
            opacity: 0;
            transition: opacity 0.3s;
            font-size: 0.75rem;
        }

        .tooltip:hover .tooltiptext {
            visibility: visible;
            opacity: 1;
        }

        /* Footer */
        .footer {
            background-color: var(--footer-background);
            backdrop-filter: blur(10px);
            padding: 2rem;
            text-align: center;
            color: var(--text-secondary);
            border-top: 1px solid var(--glass-border);
            font-size: 0.875rem;
            transition: background-color 0.3s ease;
        }

        .footer-content {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 0.75rem;
        }

        .footer-heart {
            color: #e74c3c;
            animation: heartbeat 1.2s infinite;
        }

        @keyframes heartbeat {
            0% { transform: scale(1); }
            25% { transform: scale(1.1); }
            50% { transform: scale(1); }
            75% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }

        /* Debug panel */
        .debug-panel {
            position: fixed;
            bottom: 10px;
            left: 10px;
            background-color: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 10px;
            border-radius: 5px;
            font-family: monospace;
            font-size: 12px;
            max-width: 300px;
            z-index: 10000;
            display: none;
        }

        .debug-panel.show {
            display: block;
        }

        /* Sync button */
        .sync-button {
            position: fixed;
            bottom: 20px;
            right: 20px;
            padding: 12px 20px;
            background: linear-gradient(135deg, var(--info), #2563eb);
            color: white;
            border: none;
            border-radius: 50px;
            font-weight: 600;
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(59, 130, 246, 0.3);
            transition: var(--transition);
            z-index: 999;
            display: none;
            align-items: center;
            gap: 8px;
        }

        .sync-button:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(59, 130, 246, 0.4);
        }

        .sync-button.show {
            display: flex;
        }

        /* About Section */
        .about-section {
            background-color: var(--card-background);
            border-radius: var(--border-radius);
            padding: 2rem;
            margin-bottom: 2rem;
            box-shadow: var(--card-shadow);
        }

        .about-section h2 {
            color: var(--primary-blue);
            margin-bottom: 1rem;
            font-size: 1.75rem;
        }

        .about-section p {
            color: var(--text-secondary);
            line-height: 1.6;
            margin-bottom: 1rem;
        }

        .features-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            margin-top: 2rem;
        }

        .feature-card {
            background-color: var(--glass-bg);
            border-radius: var(--border-radius);
            padding: 1.5rem;
            transition: var(--transition);
            border: 1px solid var(--glass-border);
        }

        .feature-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--card-shadow);
        }

        .feature-icon {
            font-size: 2rem;
            color: var(--primary-yellow);
            margin-bottom: 1rem;
        }

        .feature-title {
            font-size: 1.25rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
            color: var(--text-primary);
        }

        .feature-description {
            color: var(--text-secondary);
            font-size: 0.9rem;
        }

        /* Contact Section */
        .contact-section {
            background-color: var(--card-background);
            border-radius: var(--border-radius);
            padding: 2rem;
            box-shadow: var(--card-shadow);
        }

        .contact-section h2 {
            color: var(--primary-blue);
            margin-bottom: 1rem;
            font-size: 1.75rem;
        }

        .contact-form {
            display: grid;
            gap: 1.5rem;
        }

        .contact-info {
            display: flex;
            flex-direction: column;
            gap: 1rem;
            margin-top: 2rem;
        }

        .contact-item {
            display: flex;
            align-items: center;
            gap: 1rem;
            color: var(--text-secondary);
        }

        .contact-icon {
            color: var(--primary-yellow);
            font-size: 1.25rem;
        }

        /* Responsive design */
        @media (max-width: 768px) {
            html {
                font-size: 14px;
            }
            
            .header {
                padding: 1rem;
            }
            
            .logo-text {
                font-size: 1.25rem;
            }
            
            .login-container {
                padding: 2rem 1.5rem;
            }
            
            .modal-content {
                padding: 2rem 1.5rem;
            }
            
            .form-options {
                flex-direction: column;
                align-items: flex-start;
            }
            
            .notification {
                right: 0.75rem;
                left: 0.75rem;
                max-width: none;
            }
            
            .sync-button {
                bottom: 10px;
                right: 10px;
                padding: 10px 15px;
                font-size: 0.9rem;
            }
            
            .header-controls {
                gap: 0.5rem;
            }
            
            .language-button {
                padding: 0.4rem 0.8rem;
                font-size: 0.8rem;
            }
            
            .theme-toggle {
                width: 36px;
                height: 36px;
            }
        }

        @media (max-width: 480px) {
            html {
                font-size: 13px;
            }
            
            .header {
                padding: 0.75rem;
                flex-direction: column;
                gap: 1rem;
            }
            
            .logo {
                height: 40px;
            }
            
            .logo-text {
                font-size: 1rem;
            }
            
            .login-container {
                padding: 1.75rem 1.25rem;
            }
            
            .modal-content {
                padding: 1.75rem 1.25rem;
            }
            
            h1 {
                font-size: 1.75rem;
            }
            
            .btn {
                padding: 0.875rem 1.25rem;
            }
            
            .features-grid {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 320px) {
            html {
                font-size: 12px;
            }
            
            .header {
                padding: 0.5rem;
            }
            
            .logo {
                height: 35px;
            }
            
            .logo-text {
                font-size: 0.9rem;
            }
            
            .login-container {
                padding: 1.5rem 1rem;
            }
            
            .modal-content {
                padding: 1.5rem 1rem;
            }
            
            .role-badges {
                gap: 0.5rem;
            }
            
            .role-badge {
                padding: 0.5rem 1rem;
                font-size: 0.75rem;
            }
        }

        /* High contrast mode support */
        @media (prefers-contrast: high) {
            :root {
                --primary-blue: #000080;
                --secondary-blue: #0066CC;
                --primary-yellow: #FF8C00;
                --secondary-yellow: #FFF8DC;
                --glass-bg: rgba(255, 255, 255, 0.1);
                --glass-border: rgba(255, 255, 255, 0.3);
                --text-secondary: #E0E0E0;
                --text-muted: #B0B0B0;
            }
        }

        /* Reduced motion support */
        @media (prefers-reduced-motion: reduce) {
            * {
                animation-duration: 0.01ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: 0.01ms !important;
            }
        }

        /* Print styles */
        @media print {
            body {
                background: none;
                padding: 0;
            }
            
            .login-container {
                box-shadow: none;
                max-width: 100%;
            }
        }

        /* Accessibility improvements */
        :focus-visible {
            outline: 2px solid var(--primary-yellow);
            outline-offset: 2px;
        }

        .sr-only {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            white-space: nowrap;
            border-width: 0;
        }

        /* Custom scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background-color: var(--secondary-blue);
        }

        ::-webkit-scrollbar-thumb {
            background-color: var(--primary-yellow);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background-color: var(--accent-yellow);
        }
    </style>
</head>
<body>
    <div class="background-pattern"></div>
    
    <!-- Header -->
    <header class="header">
        <div class="logo-container">
            <img src="https://upload.wikimedia.org/wikipedia/commons/9/9d/Sona_College_of_Technology_logo.jpg" alt="Sona College of Technology Logo" class="logo">
            <span class="logo-text">Sona College of Technology</span>
        </div>
        
        <div class="header-controls">
            <!-- Language Selector -->
            <div class="language-selector">
                <button class="language-button" id="languageButton">
                    <i class="fas fa-globe"></i>
                    <span id="currentLanguage">English</span>
                    <i class="fas fa-chevron-down"></i>
                </button>
                <div class="language-dropdown" id="languageDropdown">
                    <div class="language-option active" data-lang="en">
                        <span>🇬🇧</span>
                        <span>English</span>
                    </div>
                    <div class="language-option" data-lang="hi">
                        <span>🇮🇳</span>
                        <span>हिन्दी</span>
                    </div>
                    <div class="language-option" data-lang="ta">
                        <span>🇮🇳</span>
                        <span>தமிழ்</span>
                    </div>
                    <div class="language-option" data-lang="te">
                        <span>🇮🇳</span>
                        <span>తెలుగు</span>
                    </div>
                    <div class="language-option" data-lang="kn">
                        <span>🇮🇳</span>
                        <span>ಕನ್ನಡ</span>
                    </div>
                    <div class="language-option" data-lang="ml">
                        <span>🇮🇳</span>
                        <span>മലയാളം</span>
                    </div>
                    <div class="language-option" data-lang="mr">
                        <span>🇮🇳</span>
                        <span>मराठी</span>
                    </div>
                    <div class="language-option" data-lang="bn">
                        <span>🇮🇳</span>
                        <span>বাংলা</span>
                    </div>
                    <div class="language-option" data-lang="gu">
                        <span>🇮🇳</span>
                        <span>ગુજરાતી</span>
                    </div>
                    <div class="language-option" data-lang="pa">
                        <span>🇮🇳</span>
                        <span>ਪੰਜਾਬੀ</span>
                    </div>
                </div>
            </div>
            
            <!-- Theme Toggle -->
            <button class="theme-toggle" id="themeToggle" aria-label="Toggle theme">
                <i class="fas fa-moon"></i>
            </button>
        </div>
    </header>
    
    <!-- Main Container -->
    <div class="main-container">
        <!-- Tab Navigation -->
        <div class="tab-navigation">
            <button class="tab-button active" data-tab="login" data-i18n="login">Login</button>
            <button class="tab-button" data-tab="about" data-i18n="about">About</button>
            <button class="tab-button" data-tab="contact" data-i18n="contact">Contact</button>
        </div>
        
        <!-- Login Tab -->
        <div class="tab-content active" id="login-tab">
            <div class="login-container">
                <div class="app-title">
                    <h1 data-i18n="platform-title">Communication Platform</h1>
                    <p class="subtitle" data-i18n="platform-subtitle">Secure Hierarchical Communication System</p>
                </div>
                
                <form id="loginForm" aria-label="Login form">
                    <div class="form-group">
                        <label for="collegeId" data-i18n="college-id">College ID</label>
                        <div class="input-container">
                            <i class="fas fa-user input-icon" aria-hidden="true"></i>
                            <input type="text" id="collegeId" required aria-required="true" placeholder="Enter your College ID" autocomplete="username">
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="password" data-i18n="password">Password</label>
                        <div class="input-container">
                            <i class="fas fa-lock input-icon" aria-hidden="true"></i>
                            <input type="password" id="password" required aria-required="true" placeholder="Enter your password" autocomplete="current-password">
                            <button type="button" class="password-toggle tooltip" id="passwordToggle" aria-label="Toggle password visibility">
                                <i class="fas fa-eye" aria-hidden="true"></i>
                                <span class="tooltiptext" data-i18n="toggle-password">Toggle password visibility</span>
                            </button>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="role" data-i18n="role">Role</label>
                        <div class="input-container">
                            <i class="fas fa-user-tag input-icon" aria-hidden="true"></i>
                            <select id="role" required aria-required="true">
                                <option value="" data-i18n="select-role">Select Your Role</option>
                                <option value="student" data-i18n="student">Student</option>
                                <option value="faculty" data-i18n="faculty">Faculty</option>
                                <option value="hod" data-i18n="hod">Head of Department</option>
                                <option value="principal" data-i18n="principal">Principal</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="role-badges" role="group" aria-label="Role selection">
                        <button type="button" class="role-badge role-student" data-role="student" aria-pressed="false">
                            <i class="fas fa-graduation-cap" aria-hidden="true"></i>
                            <span data-i18n="student">Student</span>
                        </button>
                        <button type="button" class="role-badge role-faculty" data-role="faculty" aria-pressed="false">
                            <i class="fas fa-chalkboard-teacher" aria-hidden="true"></i>
                            <span data-i18n="faculty">Faculty</span>
                        </button>
                        <button type="button" class="role-badge role-hod" data-role="hod" aria-pressed="false">
                            <i class="fas fa-user-tie" aria-hidden="true"></i>
                            <span data-i18n="hod">HOD</span>
                        </button>
                        <button type="button" class="role-badge role-principal" data-role="principal" aria-pressed="false">
                            <i class="fas fa-user-shield" aria-hidden="true"></i>
                            <span data-i18n="principal">Principal</span>
                        </button>
                    </div>
                    
                    <div class="form-options">
                        <div class="checkbox-group">
                            <input type="checkbox" id="rememberMe" name="rememberMe">
                            <label for="rememberMe" data-i18n="remember-me">Remember Me</label>
                        </div>
                        <a href="#" class="forgot-link" id="forgotPassword" data-i18n="forgot-password">Forgot Password?</a>
                    </div>
                    
                    <button type="submit" class="btn btn-primary" aria-live="polite">
                        <span class="btn-text" data-i18n="login-to-platform">Login to Platform</span>
                    </button>
                </form>
                
                <div class="divider">
                    <span data-i18n="or">OR</span>
                </div>
                
                <button type="button" class="btn btn-google" id="googleLoginBtn" aria-live="polite">
                    <i class="fab fa-google" aria-hidden="true"></i>
                    <span class="btn-text" data-i18n="login-with-google">Login with Google</span>
                </button>
                
                <button type="button" class="btn btn-microsoft" id="microsoftLoginBtn" aria-live="polite">
                    <i class="fab fa-microsoft" aria-hidden="true"></i>
                    <span class="btn-text" data-i18n="login-with-microsoft">Login with Microsoft</span>
                </button>
                
                <p class="register-link">
                    <span data-i18n="new-to-platform">New to Sona Communication?</span>
                    <a href="#" id="registerLink" data-i18n="create-account">Create an account</a>
                </p>
                
                <div class="security-notice">
                    <i class="fas fa-shield-alt" aria-hidden="true"></i>
                    <span data-i18n="security-notice">All communications are end-to-end encrypted</span>
                </div>
            </div>
        </div>
        
        <!-- About Tab -->
        <div class="tab-content" id="about-tab">
            <div class="about-section">
                <h2 data-i18n="about-title">About Sona Communication Platform</h2>
                <p data-i18n="about-description">
                    The Sona Communication Platform is a secure hierarchical communication system designed specifically for Sona College of Technology. It enables seamless communication between students, faculty, heads of departments, and the principal while maintaining proper organizational structure and security.
                </p>
                
                <div class="features-grid">
                    <div class="feature-card">
                        <div class="feature-icon">
                            <i class="fas fa-shield-alt"></i>
                        </div>
                        <h3 class="feature-title" data-i18n="secure-communication">Secure Communication</h3>
                        <p class="feature-description" data-i18n="secure-communication-desc">
                            End-to-end encryption ensures that all communications remain private and secure.
                        </p>
                    </div>
                    
                    <div class="feature-card">
                        <div class="feature-icon">
                            <i class="fas fa-sitemap"></i>
                        </div>
                        <h3 class="feature-title" data-i18n="hierarchical-structure">Hierarchical Structure</h3>
                        <p class="feature-description" data-i18n="hierarchical-structure-desc">
                            Organized communication flow that respects the college's organizational hierarchy.
                        </p>
                    </div>
                    
                    <div class="feature-card">
                        <div class="feature-icon">
                            <i class="fas fa-mobile-alt"></i>
                        </div>
                        <h3 class="feature-title" data-i18n="cross-platform">Cross-Platform</h3>
                        <p class="feature-description" data-i18n="cross-platform-desc">
                            Accessible from any device with a web browser, ensuring connectivity anytime, anywhere.
                        </p>
                    </div>
                    
                    <div class="feature-card">
                        <div class="feature-icon">
                            <i class="fas fa-users"></i>
                        </div>
                        <h3 class="feature-title" data-i18n="user-friendly">User-Friendly</h3>
                        <p class="feature-description" data-i18n="user-friendly-desc">
                            Intuitive interface designed for users of all technical skill levels.
                        </p>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Contact Tab -->
        <div class="tab-content" id="contact-tab">
            <div class="contact-section">
                <h2 data-i18n="contact-title">Contact Us</h2>
                <p data-i18n="contact-description">
                    Have questions or feedback? Reach out to our support team and we'll get back to you as soon as possible.
                </p>
                
                <form class="contact-form" id="contactForm">
                    <div class="form-group">
                        <label for="contactName" data-i18n="name">Name</label>
                        <div class="input-container">
                            <i class="fas fa-user input-icon" aria-hidden="true"></i>
                            <input type="text" id="contactName" required placeholder="Your name">
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="contactEmail" data-i18n="email">Email</label>
                        <div class="input-container">
                            <i class="fas fa-envelope input-icon" aria-hidden="true"></i>
                            <input type="email" id="contactEmail" required placeholder="Your email address">
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="contactSubject" data-i18n="subject">Subject</label>
                        <div class="input-container">
                            <i class="fas fa-tag input-icon" aria-hidden="true"></i>
                            <input type="text" id="contactSubject" required placeholder="Subject of your message">
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="contactMessage" data-i18n="message">Message</label>
                        <div class="input-container">
                            <i class="fas fa-comment-alt input-icon" aria-hidden="true"></i>
                            <textarea id="contactMessage" required placeholder="Your message" rows="5" style="resize: vertical; padding-left: 3.5rem; padding-top: 1rem; width: 100%; border: 2px solid var(--input-border); border-radius: var(--border-radius); background-color: var(--input-background); color: var(--text-primary); font-family: var(--font-family);"></textarea>
                        </div>
                    </div>
                    
                    <button type="submit" class="btn btn-primary">
                        <span class="btn-text" data-i18n="send-message">Send Message</span>
                    </button>
                </form>
                
                <div class="contact-info">
                    <div class="contact-item">
                        <i class="fas fa-map-marker-alt contact-icon"></i>
                        <span data-i18n="address">Sona College of Technology, Salem, Tamil Nadu 636005</span>
                    </div>
                    
                    <div class="contact-item">
                        <i class="fas fa-phone contact-icon"></i>
                        <span data-i18n="phone">+91 427 409 9999</span>
                    </div>
                    
                    <div class="contact-item">
                        <i class="fas fa-envelope contact-icon"></i>
                        <span data-i18n="support-email">support@sonatech.ac.in</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Registration Modal -->
    <div class="modal" id="registerModal" role="dialog" aria-labelledby="registerModalTitle" aria-modal="true">
        <div class="modal-content">
            <button class="close-btn" id="closeRegister" aria-label="Close registration modal">&times;</button>
            <h2 id="registerModalTitle" data-i18n="register-title">Register New User</h2>
            <form id="registerForm" aria-label="Registration form">
                <div class="form-group">
                    <label for="regCollegeId" data-i18n="college-id">College ID</label>
                    <div class="input-container">
                        <i class="fas fa-id-card input-icon" aria-hidden="true"></i>
                        <input type="text" id="regCollegeId" required placeholder="e.g., SONA2024001" autocomplete="username">
                    </div>
                </div>
                <div class="form-group">
                    <label for="regEmail" data-i18n="email">Email Address</label>
                    <div class="input-container">
                        <i class="fas fa-envelope input-icon" aria-hidden="true"></i>
                        <input type="email" id="regEmail" required pattern=".+@sonatech\.ac\.in" placeholder="name@sonatech.ac.in" autocomplete="email">
                    </div>
                </div>
                <div class="form-group">
                    <label for="regPassword" data-i18n="password">Password</label>
                    <div class="input-container">
                        <i class="fas fa-lock input-icon" aria-hidden="true"></i>
                        <input type="password" id="regPassword" required placeholder="Create a strong password" autocomplete="new-password">
                        <button type="button" class="password-toggle tooltip" id="regPasswordToggle" aria-label="Toggle password visibility">
                            <i class="fas fa-eye" aria-hidden="true"></i>
                            <span class="tooltiptext" data-i18n="toggle-password">Toggle password visibility</span>
                        </button>
                    </div>
                    <div class="password-strength" id="passwordStrength" aria-hidden="true">
                        <div class="password-strength-bar"></div>
                    </div>
                    <div class="password-strength-text" id="passwordStrengthText" aria-live="polite" data-i18n="password-strength">Password strength</div>
                </div>
                <div class="form-group">
                    <label for="regRole" data-i18n="role">Role</label>
                    <div class="input-container">
                        <i class="fas fa-user-tag input-icon" aria-hidden="true"></i>
                        <select id="regRole" required>
                            <option value="" data-i18n="select-role">Select Your Role</option>
                            <option value="student" data-i18n="student">Student</option>
                            <option value="faculty" data-i18n="faculty">Faculty</option>
                        </select>
                    </div>
                </div>
                <div class="form-group">
                    <label for="regDepartment" data-i18n="department">Department ID</label>
                    <div class="input-container">
                        <i class="fas fa-building input-icon" aria-hidden="true"></i>
                        <input type="number" id="regDepartment" required placeholder="e.g., 101">
                    </div>
                </div>
                <div class="form-group">
                    <label for="regFullName" data-i18n="full-name">Full Name</label>
                    <div class="input-container">
                        <i class="fas fa-user input-icon" aria-hidden="true"></i>
                        <input type="text" id="regFullName" required placeholder="Enter your full name" autocomplete="name">
                    </div>
                </div>
                <button type="submit" class="btn btn-primary" aria-live="polite">
                    <span class="btn-text" data-i18n="submit-for-approval">Submit for Approval</span>
                </button>
            </form>
            
            <div class="divider">
                <span data-i18n="or">OR</span>
            </div>
            
            <button type="button" class="btn btn-google" id="googleRegisterBtn" aria-live="polite">
                <i class="fab fa-google" aria-hidden="true"></i>
                <span class="btn-text" data-i18n="register-with-google">Register with Google</span>
            </button>
            
            <button type="button" class="btn btn-microsoft" id="microsoftRegisterBtn" aria-live="polite">
                <i class="fab fa-microsoft" aria-hidden="true"></i>
                <span class="btn-text" data-i18n="register-with-microsoft">Register with Microsoft</span>
            </button>
        </div>
    </div>

    <!-- Forgot Password Modal -->
    <div class="modal" id="forgotModal" role="dialog" aria-labelledby="forgotModalTitle" aria-modal="true">
        <div class="modal-content">
            <button class="close-btn" id="closeForgot" aria-label="Close forgot password modal">&times;</button>
            <h2 id="forgotModalTitle" data-i18n="reset-password">Reset Your Password</h2>
            <form id="forgotForm" aria-label="Password reset form">
                <div class="form-group">
                    <label for="forgotEmail" data-i18n="email">Email Address</label>
                    <div class="input-container">
                        <i class="fas fa-envelope input-icon" aria-hidden="true"></i>
                        <input type="email" id="forgotEmail" required placeholder="Enter your registered email" autocomplete="email">
                    </div>
                </div>
                <button type="submit" class="btn btn-primary" aria-live="polite">
                    <span class="btn-text" data-i18n="send-reset-link">Send Reset Link</span>
                </button>
            </form>
        </div>
    </div>

    <!-- Microsoft Account Setup Modal -->
    <div class="modal" id="microsoftSetupModal" role="dialog" aria-labelledby="microsoftSetupModalTitle" aria-modal="true">
        <div class="modal-content">
            <button class="close-btn" id="closeMicrosoftSetup" aria-label="Close Microsoft setup modal">&times;</button>
            <h2 id="microsoftSetupModalTitle" data-i18n="complete-profile">Complete Your Profile</h2>
            <p class="subtitle" style="margin-bottom: 1.75rem;" data-i18n="profile-info">Please provide additional information to complete your account setup</p>
            <form id="microsoftSetupForm" aria-label="Microsoft account setup form">
                <div class="form-group">
                    <label for="msFullName" data-i18n="full-name">Full Name</label>
                    <div class="input-container">
                        <i class="fas fa-user input-icon" aria-hidden="true"></i>
                        <input type="text" id="msFullName" required placeholder="Enter your full name" autocomplete="name">
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="msEmail" data-i18n="email">Email</label>
                    <div class="input-container">
                        <i class="fas fa-envelope input-icon" aria-hidden="true"></i>
                        <input type="email" id="msEmail" required readonly>
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="msCollegeId" data-i18n="college-id">College ID</label>
                    <div class="input-container">
                        <i class="fas fa-id-card input-icon" aria-hidden="true"></i>
                        <input type="text" id="msCollegeId" required placeholder="e.g., SONA2024001" autocomplete="username">
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="msRole" data-i18n="role">Role</label>
                    <div class="input-container">
                        <i class="fas fa-user-tag input-icon" aria-hidden="true"></i>
                        <select id="msRole" required>
                            <option value="" data-i18n="select-role">Select Your Role</option>
                            <option value="student" data-i18n="student">Student</option>
                            <option value="faculty" data-i18n="faculty">Faculty</option>
                            <option value="hod" data-i18n="hod">Head of Department</option>
                            <option value="principal" data-i18n="principal">Principal</option>
                        </select>
                    </div>
                </div>
                
                <div class="role-badges" role="group" aria-label="Role selection">
                    <button type="button" class="role-badge role-student" data-role="student" aria-pressed="false">
                        <i class="fas fa-graduation-cap" aria-hidden="true"></i>
                        <span data-i18n="student">Student</span>
                    </button>
                    <button type="button" class="role-badge role-faculty" data-role="faculty" aria-pressed="false">
                        <i class="fas fa-chalkboard-teacher" aria-hidden="true"></i>
                        <span data-i18n="faculty">Faculty</span>
                    </button>
                    <button type="button" class="role-badge role-hod" data-role="hod" aria-pressed="false">
                        <i class="fas fa-user-tie" aria-hidden="true"></i>
                        <span data-i18n="hod">HOD</span>
                    </button>
                    <button type="button" class="role-badge role-principal" data-role="principal" aria-pressed="false">
                        <i class="fas fa-user-shield" aria-hidden="true"></i>
                        <span data-i18n="principal">Principal</span>
                    </button>
                </div>
                
                <div class="form-group">
                    <label for="msDepartment" data-i18n="department">Department ID</label>
                    <div class="input-container">
                        <i class="fas fa-building input-icon" aria-hidden="true"></i>
                        <input type="number" id="msDepartment" required placeholder="e.g., 101">
                    </div>
                </div>
                
                <button type="submit" class="btn btn-primary" aria-live="polite">
                    <span class="btn-text" data-i18n="complete-setup">Complete Setup</span>
                </button>
            </form>
        </div>
    </div>

    <!-- Google Account Setup Modal -->
    <div class="modal" id="googleSetupModal" role="dialog" aria-labelledby="googleSetupModalTitle" aria-modal="true">
        <div class="modal-content">
            <button class="close-btn" id="closeGoogleSetup" aria-label="Close Google setup modal">&times;</button>
            <h2 id="googleSetupModalTitle" data-i18n="complete-profile">Complete Your Profile</h2>
            <p class="subtitle" style="margin-bottom: 1.75rem;" data-i18n="profile-info">Please provide additional information to complete your account setup</p>
            <form id="googleSetupForm" aria-label="Google account setup form">
                <div class="form-group">
                    <label for="googleFullName" data-i18n="full-name">Full Name</label>
                    <div class="input-container">
                        <i class="fas fa-user input-icon" aria-hidden="true"></i>
                        <input type="text" id="googleFullName" required placeholder="Enter your full name" autocomplete="name">
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="googleEmail" data-i18n="email">Email</label>
                    <div class="input-container">
                        <i class="fas fa-envelope input-icon" aria-hidden="true"></i>
                        <input type="email" id="googleEmail" required readonly>
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="googleCollegeId" data-i18n="college-id">College ID</label>
                    <div class="input-container">
                        <i class="fas fa-id-card input-icon" aria-hidden="true"></i>
                        <input type="text" id="googleCollegeId" required placeholder="e.g., SONA2024001" autocomplete="username">
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="googleRole" data-i18n="role">Role</label>
                    <div class="input-container">
                        <i class="fas fa-user-tag input-icon" aria-hidden="true"></i>
                        <select id="googleRole" required>
                            <option value="" data-i18n="select-role">Select Your Role</option>
                            <option value="student" data-i18n="student">Student</option>
                            <option value="faculty" data-i18n="faculty">Faculty</option>
                            <option value="hod" data-i18n="hod">Head of Department</option>
                            <option value="principal" data-i18n="principal">Principal</option>
                        </select>
                    </div>
                </div>
                
                <div class="role-badges" role="group" aria-label="Role selection">
                    <button type="button" class="role-badge role-student" data-role="student" aria-pressed="false">
                        <i class="fas fa-graduation-cap" aria-hidden="true"></i>
                        <span data-i18n="student">Student</span>
                    </button>
                    <button type="button" class="role-badge role-faculty" data-role="faculty" aria-pressed="false">
                        <i class="fas fa-chalkboard-teacher" aria-hidden="true"></i>
                        <span data-i18n="faculty">Faculty</span>
                    </button>
                    <button type="button" class="role-badge role-hod" data-role="hod" aria-pressed="false">
                        <i class="fas fa-user-tie" aria-hidden="true"></i>
                        <span data-i18n="hod">HOD</span>
                    </button>
                    <button type="button" class="role-badge role-principal" data-role="principal" aria-pressed="false">
                        <i class="fas fa-user-shield" aria-hidden="true"></i>
                        <span data-i18n="principal">Principal</span>
                    </button>
                </div>
                
                <div class="form-group">
                    <label for="googleDepartment" data-i18n="department">Department ID</label>
                    <div class="input-container">
                        <i class="fas fa-building input-icon" aria-hidden="true"></i>
                        <input type="number" id="googleDepartment" required placeholder="e.g., 101">
                    </div>
                </div>
                
                <button type="submit" class="btn btn-primary" aria-live="polite">
                    <span class="btn-text" data-i18n="complete-setup">Complete Setup</span>
                </button>
            </form>
        </div>
    </div>

    <!-- Role Selection Modal -->
    <div class="modal" id="roleSelectionModal" role="dialog" aria-labelledby="roleSelectionModalTitle" aria-modal="true">
        <div class="modal-content">
            <button class="close-btn" id="closeRoleSelection" aria-label="Close role selection modal">&times;</button>
            <h2 id="roleSelectionModalTitle" data-i18n="confirm-role">Confirm Your Role</h2>
            <p class="subtitle" style="margin-bottom: 1.75rem;" data-i18n="role-selection-info">Please select your role from the options below.</p>
            <form id="roleSelectionForm" aria-label="Role selection form">
                <div class="form-group">
                    <label for="selectedRole" data-i18n="role">Role</label>
                    <div class="input-container">
                        <i class="fas fa-user-tag input-icon" aria-hidden="true"></i>
                        <select id="selectedRole" required>
                            <option value="" data-i18n="select-role">Select Your Role</option>
                            <option value="student" data-i18n="student">Student</option>
                            <option value="faculty" data-i18n="faculty">Faculty</option>
                            <option value="hod" data-i18n="hod">Head of Department</option>
                            <option value="principal" data-i18n="principal">Principal</option>
                        </select>
                    </div>
                </div>
                
                <div class="role-badges" role="group" aria-label="Role selection">
                    <button type="button" class="role-badge role-student" data-role="student" aria-pressed="false">
                        <i class="fas fa-graduation-cap" aria-hidden="true"></i>
                        <span data-i18n="student">Student</span>
                    </button>
                    <button type="button" class="role-badge role-faculty" data-role="faculty" aria-pressed="false">
                        <i class="fas fa-chalkboard-teacher" aria-hidden="true"></i>
                        <span data-i18n="faculty">Faculty</span>
                    </button>
                    <button type="button" class="role-badge role-hod" data-role="hod" aria-pressed="false">
                        <i class="fas fa-user-tie" aria-hidden="true"></i>
                        <span data-i18n="hod">HOD</span>
                    </button>
                    <button type="button" class="role-badge role-principal" data-role="principal" aria-pressed="false">
                        <i class="fas fa-user-shield" aria-hidden="true"></i>
                        <span data-i18n="principal">Principal</span>
                    </button>
                </div>
                
                <button type="submit" class="btn btn-primary" aria-live="polite">
                    <span class="btn-text" data-i18n="confirm-role">Confirm Role</span>
                </button>
            </form>
        </div>
    </div>

    <div class="notification" id="notification" role="alert" aria-live="assertive"></div>

    <!-- Debug Panel -->
    <div class="debug-panel" id="debugPanel">
        <div>Debug Info:</div>
        <div id="debugContent"></div>
    </div>

    <!-- Sync Button (Admin Only) -->
    <button class="sync-button" id="syncButton">
        <i class="fas fa-sync-alt"></i>
        <span data-i18n="sync-microsoft-users">Sync Microsoft Users</span>
    </button>

    <!-- Footer -->
    <footer class="footer">
        <div class="footer-content">
            <p>&copy; 2025 Sona College of Technology. All rights reserved.</p>
            <p data-i18n="made-with-love">Made with <i class="fas fa-heart footer-heart"></i> by Krishna</p>
        </div>
    </footer>

    <script>
        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyAUmR-p_bJ970GK9CevtzgfAm99nvLvSaE",
            authDomain: "sona-da878.firebaseapp.com",
            databaseURL: "https://sona-da878-default-rtdb.firebaseio.com",
            projectId: "sona-da878",
            storageBucket: "sona-da878.firebasestorage.app",
            messagingSenderId: "963825066019",
            appId: "1:963825066019:web:c1a095c0972a8874195196",
            measurementId: "G-ED8CHJSJGH"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();

        // Optimized Microsoft provider configuration
        const microsoftProvider = new firebase.auth.OAuthProvider('microsoft.com');
        microsoftProvider.setCustomParameters({
            prompt: 'select_account',
            tenant: 'common'
        });

        // Essential scopes for university data
        microsoftProvider.addScope('User.Read');
        microsoftProvider.addScope('User.ReadBasic.All');

        // University email pattern analyzer
        function analyzeUniversityEmail(email) {
            // Pattern: name.yeardept@sonatech.ac.in
            // Examples: kamesh.24aml@sonatech.ac.in, priya.22cse@sonatech.ac.in
            
            if (!email || !email.includes('@sonatech.ac.in')) {
                return { isValid: false };
            }
            
            const localPart = email.split('@')[0]; // kamesh.24aml
            const parts = localPart.split('.'); // [kamesh, 24aml]
            
            if (parts.length !== 2) {
                return { isValid: false };
            }
            
            const [firstName, yearDept] = parts;
            
            // Extract year and department from yearDept (e.g., "24aml")
            const yearMatch = yearDept.match(/^(\d{2})/); // First 2 digits for year
            const deptMatch = yearDept.match(/([a-z]+)$/i); // Letters for department
            
            if (!yearMatch || !deptMatch) {
                return { isValid: false };
            }
            
            const year = `20${yearMatch[1]}`; // Convert 24 to 2024
            const deptCode = deptMatch[1].toUpperCase();
            
            // Department mapping
            const departmentMap = {
                'CSE': { full: 'Computer Science Engineering', type: 'Engineering' },
                'ECE': { full: 'Electronics & Communication Engineering', type: 'Engineering' },
                'EEE': { full: 'Electrical & Electronics Engineering', type: 'Engineering' },
                'MECH': { full: 'Mechanical Engineering', type: 'Engineering' },
                'CIVIL': { full: 'Civil Engineering', type: 'Engineering' },
                'IT': { full: 'Information Technology', type: 'Engineering' },
                'AML': { full: 'Artificial Intelligence & Machine Learning', type: 'Engineering' },
                'AIDS': { full: 'Artificial Intelligence & Data Science', type: 'Engineering' },
                'CSBS': { full: 'Computer Science & Business Systems', type: 'Engineering' },
                'MBA': { full: 'Master of Business Administration', type: 'Management' },
                'MCA': { full: 'Master of Computer Applications', type: 'Applications' }
            };
            
            const department = departmentMap[deptCode] || { 
                full: `${deptCode} Department`, 
                type: 'Other' 
            };
            
            return {
                isValid: true,
                firstName: firstName,
                admissionYear: year,
                departmentCode: deptCode,
                departmentFull: department.full,
                departmentType: department.type,
                collegeId: localPart,
                isStudent: true, // Default assumption for this pattern
                academicYear: calculateAcademicYear(year)
            };
        }

        // Calculate current academic year and semester
        function calculateAcademicYear(admissionYear) {
            const currentYear = new Date().getFullYear();
            const currentMonth = new Date().getMonth() + 1; // 1-12
            
            // Academic year typically starts in August (month 8)
            let academicYear = currentYear;
            if (currentMonth < 8) {
                academicYear = currentYear - 1;
            }
            
            const yearsCompleted = academicYear - parseInt(admissionYear);
            const currentYearOfStudy = Math.max(1, Math.min(4, yearsCompleted + 1));
            
            // Calculate semester (odd semester: Aug-Dec, even semester: Jan-May)
            const semester = currentMonth >= 8 || currentMonth <= 1 ? 
                (currentYearOfStudy * 2 - 1) : (currentYearOfStudy * 2);
            
            return {
                currentYear: currentYearOfStudy,
                currentSemester: Math.min(8, semester),
                graduationYear: parseInt(admissionYear) + 4
            };
        }

        // Fast university data fetching
        async function fetchUniversityUserData(accessToken, firebaseUser, isLogin) {
            const startTime = performance.now();
            
            try {
                // Analyze email pattern first
                const emailAnalysis = analyzeUniversityEmail(firebaseUser.email);
                debug(`Email analysis: ${JSON.stringify(emailAnalysis)}`);
                
                const headers = {
                    'Authorization': `Bearer ${accessToken}`,
                    'Content-Type': 'application/json'
                };

                // Fetch essential Graph data with timeout
                const fetchWithTimeout = (url, timeout = 4000) => {
                    return Promise.race([
                        fetch(url, { headers }),
                        new Promise((_, reject) => 
                            setTimeout(() => reject(new Error('Timeout')), timeout)
                        )
                    ]);
                };

                // Essential profile data
                const profilePromise = fetchWithTimeout(
                    'https://graph.microsoft.com/v1.0/me?$select=id,displayName,givenName,surname,jobTitle,department,officeLocation,businessPhones,mobilePhone,employeeId,userPrincipalName,mail,companyName',
                    5000
                );

                // Additional data (parallel, non-blocking)
                const additionalPromises = [
                    // Manager (for hierarchy)
                    fetchWithTimeout(
                        'https://graph.microsoft.com/v1.0/me/manager?$select=displayName,jobTitle,mail,department',
                        3000
                    ).catch(() => null),
                    
                    // Groups (for classes/teams)
                    fetchWithTimeout(
                        'https://graph.microsoft.com/v1.0/me/memberOf?$select=displayName,description,groupTypes&$top=15',
                        3000
                    ).catch(() => null),
                    
                    // Photo
                    fetchWithTimeout(
                        'https://graph.microsoft.com/v1.0/me/photo/$value',
                        2000
                    ).catch(() => null)
                ];

                // Get profile data first
                const profileResponse = await profilePromise;
                if (!profileResponse.ok) {
                    throw new Error(`Graph API error: ${profileResponse.status}`);
                }
                
                const profileData = await profileResponse.json();
                
                // Process additional data
                const [managerResult, groupsResult, photoResult] = await Promise.allSettled(additionalPromises);
                
                // Extract additional data safely
                let managerData = null;
                let groupMemberships = [];
                let photoUrl = null;
                
                // Manager data
                if (managerResult.status === 'fulfilled' && managerResult.value?.ok) {
                    managerData = await managerResult.value.json();
                }
                
                // Groups data
                if (groupsResult.status === 'fulfilled' && groupsResult.value?.ok) {
                    const groupsData = await groupsResult.value.json();
                    groupMemberships = groupsData.value || [];
                }
                
                // Photo data
                if (photoResult.status === 'fulfilled' && photoResult.value?.ok) {
                    const photoBlob = await photoResult.value.blob();
                    if (photoBlob.size < 500000) { // 500KB limit
                        photoUrl = await blobToBase64(photoBlob);
                    }
                }

                // Determine role from email pattern and Graph data
                const role = determineUniversityRole(emailAnalysis, profileData, groupMemberships);
                
                // Create comprehensive user data
                const userData = {
                    // Basic identity
                    collegeId: emailAnalysis.isValid ? emailAnalysis.collegeId : profileData.userPrincipalName?.split('@')[0],
                    role: role,
                    name: profileData.displayName || firebaseUser.displayName,
                    email: firebaseUser.email,
                    
                    // University-specific data (from email analysis)
                    ...(emailAnalysis.isValid && {
                        university: {
                            admissionYear: emailAnalysis.admissionYear,
                            departmentCode: emailAnalysis.departmentCode,
                            departmentFull: emailAnalysis.departmentFull,
                            departmentType: emailAnalysis.departmentType,
                            academic: emailAnalysis.academicYear
                        }
                    }),
                    
                    // Microsoft Graph profile data
                    profile: {
                        id: profileData.id,
                        firstName: profileData.givenName || emailAnalysis.firstName,
                        lastName: profileData.surname || '',
                        jobTitle: profileData.jobTitle || '',
                        department: profileData.department || emailAnalysis.departmentFull,
                        officeLocation: profileData.officeLocation || '',
                        businessPhone: profileData.businessPhones?.[0] || '',
                        mobilePhone: profileData.mobilePhone || '',
                        employeeId: profileData.employeeId || ''
                    },
                    
                    // Academic hierarchy
                    ...(managerData && {
                        supervisor: {
                            name: managerData.displayName,
                            jobTitle: managerData.jobTitle,
                            email: managerData.mail,
                            department: managerData.department
                        }
                    }),
                    
                    // Class/Group memberships
                    groups: groupMemberships.slice(0, 10).map(group => ({
                        name: group.displayName,
                        description: group.description,
                        type: group.groupTypes?.includes('Unified') ? 'Team' : 'Security'
                    })),
                    
                    // Photo
                    ...(photoUrl && { profilePhoto: photoUrl }),
                    
                    // Metadata
                    authMethod: 'microsoft',
                    dataSource: 'university-email-pattern',
                    createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                    lastLogin: firebase.firestore.FieldValue.serverTimestamp(),
                    approved: true,
                    processingTime: Math.round(performance.now() - startTime)
                };

                // Save to Firestore
                const userDocRef = db.collection('users').doc(firebaseUser.uid);
                const existingDoc = await userDocRef.get();
                
                if (existingDoc.exists) {
                    // Update existing user
                    await userDocRef.update({
                        lastLogin: firebase.firestore.FieldValue.serverTimestamp(),
                        'profile.jobTitle': userData.profile.jobTitle,
                        'profile.department': userData.profile.department,
                        'profile.officeLocation': userData.profile.officeLocation,
                        ...(photoUrl && { profilePhoto: photoUrl }),
                        processingTime: userData.processingTime
                    });
                    
                    redirectBasedOnRole(existingDoc.data().role);
                } else {
                    // Show role selection modal for new users
                    showRoleSelectionModal(userData, firebaseUser);
                }
                
                // Cache user data
                localStorage.setItem('universityUserCache', JSON.stringify({
                    ...userData,
                    uid: firebaseUser.uid,
                    cacheTime: Date.now()
                }));
                
                debug(`University user processing completed in ${Math.round(performance.now() - startTime)}ms`);
                
            } catch (error) {
                console.error('University Graph integration error:', error);
                
                // Fallback with email pattern analysis
                const emailAnalysis = analyzeUniversityEmail(firebaseUser.email);
                const fallbackUserData = {
                    collegeId: emailAnalysis.isValid ? emailAnalysis.collegeId : firebaseUser.email.split('@')[0],
                    role: emailAnalysis.isValid ? 'student' : 'student',
                    name: firebaseUser.displayName || emailAnalysis.firstName || 'User',
                    email: firebaseUser.email,
                    ...(emailAnalysis.isValid && {
                        university: {
                            admissionYear: emailAnalysis.admissionYear,
                            departmentCode: emailAnalysis.departmentCode,
                            departmentFull: emailAnalysis.departmentFull,
                            academic: emailAnalysis.academicYear
                        }
                    }),
                    authMethod: 'microsoft',
                    createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                    approved: true,
                    fallback: true
                };
                
                // Show role selection modal even for fallback
                showRoleSelectionModal(fallbackUserData, firebaseUser);
            }
        }

        // Show role selection modal
        function showRoleSelectionModal(userData, firebaseUser) {
            // Store user data in modal for later use
            elements.roleSelectionModal.dataset.userData = JSON.stringify(userData);
            elements.roleSelectionModal.dataset.firebaseUser = JSON.stringify(firebaseUser);
            
            // Pre-select the determined role
            document.getElementById('selectedRole').value = userData.role || 'student';
            
            // Update role badges
            elements.roleSelectionModal.querySelectorAll('.role-badge').forEach(badge => {
                if (badge.getAttribute('data-role') === userData.role) {
                    badge.classList.add('active');
                    badge.setAttribute('aria-pressed', 'true');
                } else {
                    badge.classList.remove('active');
                    badge.setAttribute('aria-pressed', 'false');
                }
            });
            
            // Open the modal
            openModal(elements.roleSelectionModal);
        }

        // Handle role selection form submission
        function handleRoleSelection(e) {
            e.preventDefault();
            const submitBtn = elements.roleSelectionForm.querySelector('.btn');
            
            // Show loading state
            submitBtn.classList.add('btn-loading');
            
            const selectedRole = document.getElementById('selectedRole').value;
            
            // Get stored data
            const userData = JSON.parse(elements.roleSelectionModal.dataset.userData || '{}');
            const firebaseUser = JSON.parse(elements.roleSelectionModal.dataset.firebaseUser || '{}');
            
            // Update role in user data
            userData.role = selectedRole;
            
            // Save to Firestore
            db.collection('users').doc(firebaseUser.uid).set(userData)
                .then(() => {
                    showNotification(
                        translations[currentLanguage]['account-setup-completed'] || 
                        'Account setup completed successfully!', 
                        'success'
                    );
                    closeModal(elements.roleSelectionModal);
                    
                    // Redirect based on role
                    redirectBasedOnRole(selectedRole);
                })
                .catch((error) => {
                    console.error('Error saving user data:', error);
                    debug('Error saving user data: ' + error.message);
                    showNotification(
                        translations[currentLanguage]['error-saving-user-data'] || 
                        'Error saving user data. Please try again.', 
                        'error'
                    );
                })
                .finally(() => {
                    submitBtn.classList.remove('btn-loading');
                });
        }

        // Determine role based on university email pattern and Graph data
        function determineUniversityRole(emailAnalysis, profileData, groups = []) {
            const jobTitle = (profileData.jobTitle || '').toLowerCase();
            const department = (profileData.department || '').toLowerCase();
            
            // Check job title first (most reliable for staff)
            if (jobTitle.includes('principal') || jobTitle.includes('director')) {
                return 'principal';
            }
            
            if (jobTitle.includes('hod') || jobTitle.includes('head of department') || 
                jobTitle.includes('head-') || jobTitle.includes('chairperson')) {
                return 'hod';
            }
            
            if (jobTitle.includes('professor') || jobTitle.includes('faculty') || 
                jobTitle.includes('lecturer') || jobTitle.includes('instructor') ||
                jobTitle.includes('asst prof') || jobTitle.includes('assistant prof')) {
                return 'faculty';
            }
            
            // Check groups for role indicators
            const facultyGroups = groups.some(g => 
                g.displayName?.toLowerCase().includes('faculty') ||
                g.displayName?.toLowerCase().includes('staff') ||
                g.displayName?.toLowerCase().includes('teacher')
            );
            
            if (facultyGroups) {
                return 'faculty';
            }
            
            // If email pattern suggests student and no other role found
            if (emailAnalysis.isValid && emailAnalysis.isStudent) {
                return 'student';
            }
            
            return 'student'; // Default
        }

        // Convert blob to base64 with size limit
        function blobToBase64(blob) {
            return new Promise((resolve, reject) => {
                if (blob.size > 300000) { // 300KB limit for faster processing
                    resolve(null);
                    return;
                }
                
                const reader = new FileReader();
                reader.onloadend = () => resolve(reader.result);
                reader.onerror = reject;
                reader.readAsDataURL(blob);
            });
        }

        // Updated Microsoft auth handler
        function handleUniversityMicrosoftAuth(isLogin) {
            const button = isLogin ? elements.microsoftLoginBtn : elements.microsoftRegisterBtn;
            button.classList.add('btn-loading');
            
            debug('Starting university Microsoft authentication...');
            
            auth.signInWithPopup(microsoftProvider)
                .then(async (result) => {
                    const user = result.user;
                    const credential = result.credential;
                    
                    debug(`Microsoft auth successful for: ${user.email}`);
                    
                    // Validate university email
                    if (!user.email.includes('@sonatech.ac.in')) {
                        throw new Error('Please use your university email (@sonatech.ac.in)');
                    }
                    
                    // Process university user data
                    await fetchUniversityUserData(credential.accessToken, user, isLogin);
                })
                .catch((error) => {
                    console.error('University Microsoft auth error:', error);
                    
                    let errorMessage = 'Authentication failed. ';
                    if (error.message.includes('university email')) {
                        errorMessage = 'Please use your university email (@sonatech.ac.in)';
                    } else if (error.code === 'auth/popup-blocked') {
                        errorMessage += 'Please allow popups and try again.';
                    } else if (error.code === 'auth/popup-closed-by-user') {
                        errorMessage = 'Authentication cancelled.';
                    } else {
                        errorMessage += 'Please try again.';
                    }
                    
                    showNotification(errorMessage, 'error');
                })
                .finally(() => {
                    button.classList.remove('btn-loading');
                });
        }

        // Language translations
        const translations = {
            en: {
                "login": "Login",
                "about": "About",
                "contact": "Contact",
                "platform-title": "Communication Platform",
                "platform-subtitle": "Secure Hierarchical Communication System",
                "college-id": "College ID",
                "password": "Password",
                "role": "Role",
                "select-role": "Select Your Role",
                "student": "Student",
                "faculty": "Faculty",
                "hod": "Head of Department",
                "principal": "Principal",
                "remember-me": "Remember Me",
                "forgot-password": "Forgot Password?",
                "login-to-platform": "Login to Platform",
                "or": "OR",
                "login-with-google": "Login with Google",
                "login-with-microsoft": "Login with Microsoft",
                "new-to-platform": "New to Sona Communication?",
                "create-account": "Create an account",
                "security-notice": "All communications are end-to-end encrypted",
                "toggle-password": "Toggle password visibility",
                "register-title": "Register New User",
                "submit-for-approval": "Submit for Approval",
                "register-with-google": "Register with Google",
                "register-with-microsoft": "Register with Microsoft",
                "reset-password": "Reset Your Password",
                "send-reset-link": "Send Reset Link",
                "complete-profile": "Complete Your Profile",
                "profile-info": "Please provide additional information to complete your account setup",
                "complete-setup": "Complete Setup",
                "department": "Department ID",
                "full-name": "Full Name",
                "password-strength": "Password strength",
                "about-title": "About Sona Communication Platform",
                "about-description": "The Sona Communication Platform is a secure hierarchical communication system designed specifically for Sona College of Technology. It enables seamless communication between students, faculty, heads of departments, and the principal while maintaining proper organizational structure and security.",
                "secure-communication": "Secure Communication",
                "secure-communication-desc": "End-to-end encryption ensures that all communications remain private and secure.",
                "hierarchical-structure": "Hierarchical Structure",
                "hierarchical-structure-desc": "Organized communication flow that respects the college's organizational hierarchy.",
                "cross-platform": "Cross-Platform",
                "cross-platform-desc": "Accessible from any device with a web browser, ensuring connectivity anytime, anywhere.",
                "user-friendly": "User-Friendly",
                "user-friendly-desc": "Intuitive interface designed for users of all technical skill levels.",
                "contact-title": "Contact Us",
                "contact-description": "Have questions or feedback? Reach out to our support team and we'll get back to you as soon as possible.",
                "name": "Name",
                "email": "Email",
                "subject": "Subject",
                "message": "Message",
                "send-message": "Send Message",
                "address": "Sona College of Technology, Salem, Tamil Nadu 636005",
                "phone": "+91 427 409 9999",
                "support-email": "support@sonatech.ac.in",
                "sync-microsoft-users": "Sync Microsoft Users",
                "made-with-love": "Made with",
                "confirm-role": "Confirm Your Role",
                "role-selection-info": "Please select your role from the options below.",
                "account-setup-completed": "Account setup completed successfully!",
                "error-saving-user-data": "Error saving user data. Please try again."
            },
            hi: {
                "login": "लॉग इन",
                "about": "हमारे बारे में",
                "contact": "संपर्क करें",
                "platform-title": "संचार प्लेटफॉर्म",
                "platform-subtitle": "सुरक्षित पदानुक्रमित संचार प्रणाली",
                "college-id": "कॉलेज आईडी",
                "password": "पासवर्ड",
                "role": "भूमिका",
                "select-role": "अपनी भूमिका चुनें",
                "student": "छात्र",
                "faculty": "शिक्षक",
                "hod": "विभागाध्यक्ष",
                "principal": "प्राचार्य",
                "remember-me": "मुझे याद रखें",
                "forgot-password": "पासवर्ड भूल गए?",
                "login-to-platform": "प्लेटफॉर्म में लॉग इन करें",
                "or": "या",
                "login-with-google": "Google के साथ लॉग इन करें",
                "login-with-microsoft": "Microsoft के साथ लॉग इन करें",
                "new-to-platform": "सोना संचार पर नए हैं?",
                "create-account": "खाता बनाएं",
                "security-notice": "सभी संचार एंड-टू-एंड एन्क्रिप्टेड हैं",
                "toggle-password": "पासवर्ड दृश्यता टॉगल करें",
                "register-title": "नए उपयोगकर्ता को पंजीकृत करें",
                "submit-for-approval": "अनुमोदन के लिए जमा करें",
                "register-with-google": "Google के साथ पंजीकरण करें",
                "register-with-microsoft": "Microsoft के साथ पंजीकरण करें",
                "reset-password": "अपना पासवर्ड रीसेट करें",
                "send-reset-link": "रीसेट लिंक भेजें",
                "complete-profile": "अपनी प्रोफ़ाइल पूरी करें",
                "profile-info": "कृपया अपने खाते सेटअप को पूरा करने के लिए अतिरिक्त जानकारी प्रदान करें",
                "complete-setup": "सेटअप पूरा करें",
                "department": "विभाग आईडी",
                "full-name": "पूरा नाम",
                "password-strength": "पासवर्ड की शक्ति",
                "about-title": "सोना संचार प्लेटफॉर्म के बारे में",
                "about-description": "सोना संचार प्लेटफॉर्म एक सुरक्षित पदानुक्रमित संचार प्रणाली है जो विशेष रूप से सोना कॉलेज ऑफ टेक्नोलॉजी के लिए डिज़ाइन की गई है। यह छात्रों, शिक्षकों, विभागाध्यक्षों और प्राचार्य के बीच सहज संचार सक्षम करता है, जबकि उचित संगठनात्मक संरचना और सुरक्षा बनाए रखता है।",
                "secure-communication": "सुरक्षित संचार",
                "secure-communication-desc": "एंड-टू-एंड एन्क्रिप्शन सुनिश्चित करता है कि सभी संचार निजी और सुरक्षित रहें।",
                "hierarchical-structure": "पदानुक्रमित संरचना",
                "hierarchical-structure-desc": "संगठित संचार प्रवाह जो कॉलेज की संगठनात्मक पदानुक्रम का सम्मान करता है।",
                "cross-platform": "क्रॉस-प्लेटफॉर्म",
                "cross-platform-desc": "किसी भी डिवाइस से एक्सेस करने योग्य जिसमें वेब ब्राउज़र है, जो किसी भी समय, कहीं भी कनेक्टिविटी सुनिश्चित करता है।",
                "user-friendly": "उपयोगकर्ता-अनुकूल",
                "user-friendly-desc": "सभी तकनीकी कौशल्य स्तरों के उपयोगकर्ताओं के लिए डिज़ाइन किया गया सहज इंटरफ़ेस।",
                "contact-title": "हमसे संपर्क करें",
                "contact-description": "कोई प्रश्न या प्रतिक्रिया है? हमारी सहायता टीम से संपर्क करें और हम जल्द से जल्द आपको वापस संपर्क करेंगे।",
                "name": "नाम",
                "email": "ईमेल",
                "subject": "विषय",
                "message": "संदेश",
                "send-message": "संदेश भेजें",
                "address": "सोना कॉलेज ऑफ टेक्नोलॉजी, सेलम, तमिलनाडु 636005",
                "phone": "+91 427 409 9999",
                "support-email": "support@sonatech.ac.in",
                "sync-microsoft-users": "Microsoft उपयोगकर्ताओं को सिंक करें",
                "made-with-love": "द्वारा बनाया गया",
                "confirm-role": "अपनी भूमिका की पुष्टि करें",
                "role-selection-info": "कृपया नीचे दिए गए विकल्पों में से अपनी भूमिका चुनें।",
                "account-setup-completed": "खाता सेटअप सफलतापूर्वक पूरा हुआ!",
                "error-saving-user-data": "उपयोगकर्ता डेटा सहेजने में त्रुटि। कृपया पुन: प्रयास करें।"
            },
            ta: {
                "login": "உள்நுழைக",
                "about": "எங்களைப் பற்றி",
                "contact": "தொடர்பு கொள்ள",
                "platform-title": "தகவல் தளம்",
                "platform-subtitle": "பாதுகாப்பான படிநிலை தகவல் தொடர்பு அமைப்பு",
                "college-id": "கல்லூரி ஐடி",
                "password": "கடவுச்சொல்",
                "role": "பங்கு",
                "select-role": "உங்கள் பங்கைத் தேர்ந்தெடுக்கவும்",
                "student": "மாணவர்",
                "faculty": "ஆசிரியர்",
                "hod": "துறைத் தலைவர்",
                "principal": "முதல்வர்",
                "remember-me": "என்னை நினைவில் கொள்ளுங்கள்",
                "forgot-password": "கடவுச்சொல்லை மறந்துவிட்டீர்களா?",
                "login-to-platform": "தளத்தில் உள்நுழைக",
                "or": "அல்லது",
                "login-with-google": "Google உடன் உள்நுழைக",
                "login-with-microsoft": "Microsoft உடன் உள்நுழைக",
                "new-to-platform": "சோனா தகவல் தளத்தில் புதியவரா?",
                "create-account": "கணக்கு உருவாக்கவும்",
                "security-notice": "அனைத்து தகவல்தொடர்புகளும் முனை-முதல்-முனை குறியாக்கப்பட்டுள்ளன",
                "toggle-password": "கடவுச்சொல் புலப்பாட்டை மாற்றவும்",
                "register-title": "புதிய பயனரைப் பதிவு செய்யவும்",
                "submit-for-approval": "அங்கீகாரத்திற்கு சமர்ப்பிக்கவும்",
                "register-with-google": "Google உடன் பதிவு செய்யவும்",
                "register-with-microsoft": "Microsoft உடன் பதிவு செய்யவும்",
                "reset-password": "உங்கள் கடவுச்சொல்லை மீட்டமைக்கவும்",
                "send-reset-link": "மீட்டமைப்பு இணைப்பை அனுப்பவும்",
                "complete-profile": "உங்கள் சுயவிவரத்தை முடிக்கவும்",
                "profile-info": "உங்கள் கணக்கு அமைவை முடிக்க கூடுதல் தகவலை வழங்கவும்",
                "complete-setup": "அமைவை முடிக்கவும்",
                "department": "விபாக ஐடி",
                "full-name": "முழுப் பெயர்",
                "password-strength": "கடவுச்சொல் வலிமை",
                "about-title": "சோனா தகவல் தளம் பற்றி",
                "about-description": "சோனா தகவல் தளம் என்பது சோனா தொழில்நுட்பக் கல்லூரிக்கு குறிப்பாக வடிவமைக்கப்பட்ட ஒரு பாதுகாப்பான படிநிலை தகவல் தொடர்பு அமைப்பாகும். இது மாணவர்கள், ஆசிரியர்கள், விபாகத் தலைவர்கள் மற்றும் முதல்வருக்கு இடையே சீரான தகவல் தொடர்பை சாத்தியமாக்குகிறது, அதே நேரத்தில் சரியான நிறுவன அமைப்பு மற்றும் பாதுகாப்பை பராமரிக்கிறது.",
                "secure-communication": "பாதுகாப்பான தகவல் தொடர்பு",
                "secure-communication-desc": "முனை-முதல்-முனை குறியாக்கம் அனைத்து தகவல் தொடர்புகளும் தனிப்பட்டதாகவும் பாதுகாப்பாகவும் இருப்பதை உறுதிப்படுத்துகிறது.",
                "hierarchical-structure": "படிநிலை அமைப்பு",
                "hierarchical-structure-desc": "கல்லூரியின் நிறுவன படிநிலையை மதிக்கும் ஒழுங்கமைக்கப்பட்ட தகவல் தொடர்பு ஓட்டம்.",
                "cross-platform": "குறுக்கு-தளம்",
                "cross-platform-desc": "வலை உலாவி கொண்ட எந்த சாதனையிலிருந்தும் அணுகக்கூடியது, எப்போதும், எங்கிருந்தும் இணைப்பை உறுதி செய்கிறது.",
                "user-friendly": "பயனர்-நட்பு",
                "user-friendly-desc": "அனைத்து தொழில்நுட்ப திறன் நிலைகளுக்கும் வடிவமைக்கப்பட்ட எளிய இடைமுகம்.",
                "contact-title": "எங்களைத் தொடர்பு கொள்ளுங்கள்",
                "contact-description": "கேள்விகள் அல்லது கருத்துக்கள் உள்ளனவா? எங்கள் ஆதரவு குழுவைத் தொடர்பு கொண்டு, நாங்கள் விரைவில் உங்களுக்குத் திரும்பத் தொடர்பு கொள்வோம்.",
                "name": "பெயர்",
                "email": "மின்னஞ்சல்",
                "subject": "பொருள்",
                "message": "செய்தி",
                "send-message": "செய்தியை அனுப்பவும்",
                "address": "சோனா தொழில்நுட்பக் கல்லூரி, சேலம், தமிழ்நாடு 636005",
                "phone": "+91 427 409 9999",
                "support-email": "support@sonatech.ac.in",
                "sync-microsoft-users": "Microsoft பயனர்களை ஒத்திசைவு செய்யுங்கள்",
                "made-with-love": "ஆல் உருவாக்கப்பட்டது",
                "confirm-role": "உங்கள் பங்கை உறுதிப்படுத்தவும்",
                "role-selection-info": "தயவுசெய்து கீழே உள்ள விருப்பங்களிலிருந்து உங்கள் பங்கைத் தேர்ந்தெடுக்கவும்.",
                "account-setup-completed": "கணக்கு அமைப்பு வெற்றிகரமாக முடிந்தது!",
                "error-saving-user-data": "பயனர் தரவைச் சேமிப்பதில் பிழை. தயவுசெய்து மீண்டும் முயற்சி செய்யவும்."
            }
            // Add other language translations as needed...
        };

        // DOM Elements
        const elements = {
            loginForm: document.getElementById('loginForm'),
            registerForm: document.getElementById('registerForm'),
            forgotForm: document.getElementById('forgotForm'),
            microsoftSetupForm: document.getElementById('microsoftSetupForm'),
            googleSetupForm: document.getElementById('googleSetupForm'),
            contactForm: document.getElementById('contactForm'),
            roleSelectionForm: document.getElementById('roleSelectionForm'),
            registerModal: document.getElementById('registerModal'),
            forgotModal: document.getElementById('forgotModal'),
            microsoftSetupModal: document.getElementById('microsoftSetupModal'),
            googleSetupModal: document.getElementById('googleSetupModal'),
            roleSelectionModal: document.getElementById('roleSelectionModal'),
            passwordToggle: document.getElementById('passwordToggle'),
            regPasswordToggle: document.getElementById('regPasswordToggle'),
            passwordField: document.getElementById('password'),
            regPasswordField: document.getElementById('regPassword'),
            roleBadges: document.querySelectorAll('.role-badge'),
            roleSelect: document.getElementById('role'),
            passwordStrength: document.getElementById('passwordStrength'),
            passwordStrengthText: document.getElementById('passwordStrengthText'),
            notification: document.getElementById('notification'),
            microsoftLoginBtn: document.getElementById('microsoftLoginBtn'),
            microsoftRegisterBtn: document.getElementById('microsoftRegisterBtn'),
            googleLoginBtn: document.getElementById('googleLoginBtn'),
            googleRegisterBtn: document.getElementById('googleRegisterBtn'),
            debugPanel: document.getElementById('debugPanel'),
            debugContent: document.getElementById('debugContent'),
            syncButton: document.getElementById('syncButton'),
            themeToggle: document.getElementById('themeToggle'),
            languageButton: document.getElementById('languageButton'),
            languageDropdown: document.getElementById('languageDropdown'),
            currentLanguage: document.getElementById('currentLanguage'),
            tabButtons: document.querySelectorAll('.tab-button'),
            tabContents: document.querySelectorAll('.tab-content')
        };

        // Current language
        let currentLanguage = 'en';

        // Debug function
        function debug(message) {
            console.log(message);
            if (elements.debugPanel) {
                elements.debugPanel.classList.add('show');
                elements.debugContent.innerHTML += message + '<br>';
            }
        }

        // Initialize app
        document.addEventListener('DOMContentLoaded', () => {
            // Check for remembered user
            checkRememberedUser();
            
            // Setup event listeners
            setupEventListeners();
            
            // Initialize theme
            initializeTheme();
            
            // Initialize language
            initializeLanguage();
            
            // Set up authentication state observer
            auth.onAuthStateChanged(user => {
                debug('Auth state changed: ' + (user ? 'User logged in' : 'No user'));
                
                if (user) {
                    // User is signed in
                    const uid = user.uid;
                    debug('User UID: ' + uid);
                    
                    // Get user data from Firestore
                    db.collection('users').doc(uid).get()
                        .then(doc => {
                            if (doc.exists) {
                                const userData = doc.data();
                                debug('User data found: ' + JSON.stringify(userData));
                                
                                // Store user data in localStorage
                                localStorage.setItem('user', JSON.stringify({
                                    uid: uid,
                                    ...userData
                                }));
                                
                                // Redirect to role-based page
                                redirectBasedOnRole(userData.role);
                            } else {
                                debug('No user document found in Firestore');
                                // For admin accounts, create a default user document
                                handleAdminUser(user);
                            }
                        })
                        .catch(error => {
                            console.error("Error getting user data:", error);
                            debug('Error getting user data: ' + error.message);
                            showNotification('Error loading user data', 'error');
                        });
                }
            });
        });

        // Initialize theme
        function initializeTheme() {
            const savedTheme = localStorage.getItem('theme') || 'light';
            document.documentElement.setAttribute('data-theme', savedTheme);
            updateThemeIcon(savedTheme);
        }

        // Update theme icon
        function updateThemeIcon(theme) {
            const icon = elements.themeToggle.querySelector('i');
            if (theme === 'dark') {
                icon.className = 'fas fa-sun';
            } else {
                icon.className = 'fas fa-moon';
            }
        }

        // Toggle theme
        function toggleTheme() {
            const currentTheme = document.documentElement.getAttribute('data-theme');
            const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
            
            document.documentElement.setAttribute('data-theme', newTheme);
            localStorage.setItem('theme', newTheme);
            updateThemeIcon(newTheme);
        }

        // Initialize language
        function initializeLanguage() {
            const savedLanguage = localStorage.getItem('language') || 'en';
            setLanguage(savedLanguage);
        }

        // Set language
        function setLanguage(lang) {
            currentLanguage = lang;
            localStorage.setItem('language', lang);
            
            // Update current language display
            elements.currentLanguage.textContent = document.querySelector(`.language-option[data-lang="${lang}"] span:last-child`).textContent;
            
            // Update active language option
            document.querySelectorAll('.language-option').forEach(option => {
                option.classList.remove('active');
                if (option.getAttribute('data-lang') === lang) {
                    option.classList.add('active');
                }
            });
            
            // Update all translatable elements
            updateTranslations();
        }

        // Update translations
        function updateTranslations() {
            document.querySelectorAll('[data-i18n]').forEach(element => {
                const key = element.getAttribute('data-i18n');
                if (translations[currentLanguage] && translations[currentLanguage][key]) {
                    element.textContent = translations[currentLanguage][key];
                }
            });
            
            // Update placeholders
            document.querySelectorAll('input[placeholder], textarea[placeholder]').forEach(element => {
                const key = element.getAttribute('placeholder');
                if (translations[currentLanguage] && translations[currentLanguage][key]) {
                    element.placeholder = translations[currentLanguage][key];
                }
            });
        }

        // Handle admin user creation
        function handleAdminUser(user) {
            const email = user.email;
            let role = '';
            let department = '';
            let collegeId = '';
            
            if (email === 'principal.test@sonatech.ac.in') {
                role = 'principal';
                department = 'ADMINISTRATION';
                collegeId = 'principal.test';
            } else if (email === 'hod.cse@sonatech.ac.in') {
                role = 'hod';
                department = 'Computer Science Engineering';
                collegeId = 'hod.cse';
            } else if (email === 'hod.ece@sonatech.ac.in') {
                role = 'hod';
                department = 'Electronics & Communication Engineering';
                collegeId = 'hod.ece';
            } else if (email === 'faculty.cse01@sonatech.ac.in') {
                role = 'faculty';
                department = 'Computer Science Engineering';
                collegeId = 'faculty.cse01';
            } else if (email === 'faculty.ece01@sonatech.ac.in') {
                role = 'faculty';
                department = 'Electronics & Communication Engineering';
                collegeId = 'faculty.ece01';
            } else if (email === 'student.cse.2023e01@sonatech.ac.in') {
                role = 'student';
                department = 'Computer Science Engineering';
                collegeId = 'student.cse.2023e01';
            } else if (email === 'student.ece.2023001@sonatech.ac.in') {
                role = 'student';
                department = 'Electronics & Communication Engineering';
                collegeId = 'student.ece.2023001';
            }
            
            if (role) {
                const userData = {
                    collegeId: collegeId,
                    role: role,
                    department: department,
                    name: email.split('@')[0],
                    email: email,
                    authMethod: 'email',
                    createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                    approved: true
                };
                
                debug('Creating admin user document: ' + JSON.stringify(userData));
                
                db.collection('users').doc(user.uid).set(userData)
                    .then(() => {
                        debug('Admin user document created successfully');
                        localStorage.setItem('user', JSON.stringify({
                            uid: user.uid,
                            ...userData
                        }));
                        redirectBasedOnRole(role);
                    })
                    .catch(error => {
                        console.error('Error creating admin user:', error);
                        debug('Error creating admin user: ' + error.message);
                        showNotification('Error setting up admin account', 'error');
                    });
            }
        }

        // Setup event listeners
        function setupEventListeners() {
            // Password visibility toggles
            elements.passwordToggle.addEventListener('click', () => togglePasswordVisibility(elements.passwordField, elements.passwordToggle));
            elements.regPasswordToggle.addEventListener('click', () => togglePasswordVisibility(elements.regPasswordField, elements.regPasswordToggle));

            // Role badge selection
            elements.roleBadges.forEach(badge => {
                badge.addEventListener('click', () => selectRoleBadge(badge));
            });

            // Role select dropdown change
            elements.roleSelect.addEventListener('change', () => {
                // Update active badge based on dropdown selection
                const selectedRole = elements.roleSelect.value;
                elements.roleBadges.forEach(badge => {
                    if (badge.getAttribute('data-role') === selectedRole) {
                        badge.classList.add('active');
                        badge.setAttribute('aria-pressed', 'true');
                    } else {
                        badge.classList.remove('active');
                        badge.setAttribute('aria-pressed', 'false');
                    }
                });
            });

            // Password strength indicator
            elements.regPasswordField.addEventListener('input', updatePasswordStrength);

            // Modal handlers
            document.getElementById('registerLink').addEventListener('click', (e) => {
                e.preventDefault();
                openModal(elements.registerModal);
            });

            document.getElementById('closeRegister').addEventListener('click', () => {
                closeModal(elements.registerModal);
            });

            document.getElementById('forgotPassword').addEventListener('click', (e) => {
                e.preventDefault();
                openModal(elements.forgotModal);
            });

            document.getElementById('closeForgot').addEventListener('click', () => {
                closeModal(elements.forgotModal);
            });

            document.getElementById('closeMicrosoftSetup').addEventListener('click', () => {
                closeModal(elements.microsoftSetupModal);
            });

            document.getElementById('closeGoogleSetup').addEventListener('click', () => {
                closeModal(elements.googleSetupModal);
            });

            document.getElementById('closeRoleSelection').addEventListener('click', () => {
                closeModal(elements.roleSelectionModal);
            });

            // Close modals when clicking outside
            [elements.registerModal, elements.forgotModal, elements.microsoftSetupModal, elements.googleSetupModal, elements.roleSelectionModal].forEach(modal => {
                modal.addEventListener('click', (e) => {
                    if (e.target === modal) {
                        closeModal(modal);
                    }
                });
            });

            // Form submissions
            elements.loginForm.addEventListener('submit', handleLogin);
            elements.registerForm.addEventListener('submit', handleRegister);
            elements.forgotForm.addEventListener('submit', handleForgotPassword);
            elements.microsoftSetupForm.addEventListener('submit', handleMicrosoftSetup);
            elements.googleSetupForm.addEventListener('submit', handleGoogleSetup);
            elements.contactForm.addEventListener('submit', handleContactForm);
            elements.roleSelectionForm.addEventListener('submit', handleRoleSelection);

            // Authentication buttons
            elements.microsoftLoginBtn.addEventListener('click', () => handleUniversityMicrosoftAuth(true));
            elements.microsoftRegisterBtn.addEventListener('click', () => handleUniversityMicrosoftAuth(false));
            elements.googleLoginBtn.addEventListener('click', () => handleGoogleAuth(true));
            elements.googleRegisterBtn.addEventListener('click', () => handleGoogleAuth(false));
            
            // Sync button
            elements.syncButton.addEventListener('click', syncAllMicrosoftUsers);
            
            // Theme toggle
            elements.themeToggle.addEventListener('click', toggleTheme);
            
            // Language selector
            elements.languageButton.addEventListener('click', () => {
                elements.languageDropdown.classList.toggle('show');
            });
            
            // Language options
            document.querySelectorAll('.language-option').forEach(option => {
                option.addEventListener('click', () => {
                    const lang = option.getAttribute('data-lang');
                    setLanguage(lang);
                    elements.languageDropdown.classList.remove('show');
                });
            });
            
            // Tab navigation
            elements.tabButtons.forEach(button => {
                button.addEventListener('click', () => {
                    const tabId = button.getAttribute('data-tab');
                    
                    // Update active tab button
                    elements.tabButtons.forEach(btn => btn.classList.remove('active'));
                    button.classList.add('active');
                    
                    // Update active tab content
                    elements.tabContents.forEach(content => content.classList.remove('active'));
                    document.getElementById(`${tabId}-tab`).classList.add('active');
                });
            });
            
            // Close language dropdown when clicking outside
            document.addEventListener('click', (e) => {
                if (!elements.languageButton.contains(e.target) && !elements.languageDropdown.contains(e.target)) {
                    elements.languageDropdown.classList.remove('show');
                }
            });
        }

        // Toggle password visibility
        function togglePasswordVisibility(passwordField, toggleButton) {
            const type = passwordField.getAttribute('type') === 'password' ? 'text' : 'password';
            passwordField.setAttribute('type', type);
            toggleButton.innerHTML = type === 'password' ? 
                '<i class="fas fa-eye" aria-hidden="true"></i>' : 
                '<i class="fas fa-eye-slash" aria-hidden="true"></i>';
        }

        // Select role badge
        function selectRoleBadge(badge) {
            const form = badge.closest('form');
            const roleSelect = form.querySelector('select');
            
            form.querySelectorAll('.role-badge').forEach(b => {
                b.classList.remove('active');
                b.setAttribute('aria-pressed', 'false');
            });
            badge.classList.add('active');
            badge.setAttribute('aria-pressed', 'true');
            roleSelect.value = badge.getAttribute('data-role');
            
            // Add visual feedback
            badge.style.transform = 'scale(0.95)';
            setTimeout(() => {
                badge.style.transform = '';
            }, 100);
        }

        // Update password strength
        function updatePasswordStrength() {
            const password = elements.regPasswordField.value;
            let strength = 0;
            let text = '';
            
            if (password.length >= 8) strength++;
            if (password.match(/[a-z]/) && password.match(/[A-Z]/)) strength++;
            if (password.match(/\d/)) strength++;
            if (password.match(/[^a-zA-Z\d]/)) strength++;
            
            elements.passwordStrength.className = 'password-strength';
            
            if (password.length > 0) {
                if (strength < 2) {
                    elements.passwordStrength.classList.add('weak');
                    text = translations[currentLanguage]['weak-password'] || 'Weak password';
                } else if (strength < 4) {
                    elements.passwordStrength.classList.add('medium');
                    text = translations[currentLanguage]['medium-password'] || 'Medium strength password';
                } else {
                    elements.passwordStrength.classList.add('strong');
                    text = translations[currentLanguage]['strong-password'] || 'Strong password';
                }
            } else {
                text = translations[currentLanguage]['password-strength'] || 'Password strength';
            }
            
            elements.passwordStrengthText.textContent = text;
        }

        // Show notification
        function showNotification(message, type = 'info') {
            elements.notification.textContent = message;
            elements.notification.className = `notification ${type}`;
            elements.notification.classList.add('show');
            
            setTimeout(() => {
                elements.notification.classList.remove('show');
            }, 4000);
        }

        // Modal functions
        function openModal(modal) {
            modal.style.display = 'flex';
            document.body.style.overflow = 'hidden';
            
            // Focus on first input
            const firstInput = modal.querySelector('input');
            if (firstInput) {
                setTimeout(() => firstInput.focus(), 100);
            }
        }

        function closeModal(modal) {
            modal.style.display = 'none';
            document.body.style.overflow = '';
        }

        // Handle Google authentication
        function handleGoogleAuth(isLogin) {
            const button = isLogin ? elements.googleLoginBtn : elements.googleRegisterBtn;
            button.classList.add('btn-loading');
            
            const provider = new firebase.auth.GoogleAuthProvider();
            
            // Add scopes
            provider.addScope('profile');
            provider.addScope('email');
            
            // Set custom parameters for better UX
            provider.setCustomParameters({
                prompt: 'select_account'
            });
            
            debug('Starting Google authentication...');
            
            auth.signInWithPopup(provider)
                .then((result) => {
                    const user = result.user;
                    debug('Google auth successful: ' + user.email);
                    
                    // Check if user exists in Firestore
                    return db.collection('users').doc(user.uid).get()
                        .then(doc => {
                            if (doc.exists) {
                                // User exists, redirect based on role
                                const userData = doc.data();
                                debug('User exists in Firestore, redirecting to: ' + userData.role);
                                redirectBasedOnRole(userData.role);
                            } else {
                                // User doesn't exist, show setup modal
                                debug('User does not exist in Firestore, showing setup modal');
                                openModal(elements.googleSetupModal);
                                document.getElementById('googleFullName').value = user.displayName || '';
                                document.getElementById('googleEmail').value = user.email || '';
                            }
                        });
                })
                .catch((error) => {
                    console.error('Google auth error:', error);
                    debug('Google auth error: ' + error.message);
                    showNotification('Google authentication failed: ' + error.message, 'error');
                })
                .finally(() => {
                    button.classList.remove('btn-loading');
                });
        }

        // Handle Microsoft setup form
        function handleMicrosoftSetup(e) {
            e.preventDefault();
            const submitBtn = elements.microsoftSetupForm.querySelector('.btn');
            
            // Show loading state
            submitBtn.classList.add('btn-loading');
            
            const collegeId = document.getElementById('msCollegeId').value;
            const role = document.getElementById('msRole').value;
            const department = document.getElementById('msDepartment').value;
            const fullName = document.getElementById('msFullName').value;
            
            // Get current user
            const user = auth.currentUser;
            
            if (user) {
                // Create user object
                const userData = {
                    collegeId,
                    role,
                    department: parseInt(department),
                    name: fullName,
                    email: user.email,
                    authMethod: 'microsoft',
                    createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                    approved: true
                };
                
                debug('Creating Microsoft user document: ' + JSON.stringify(userData));
                
                // Save user to Firestore
                db.collection('users').doc(user.uid).set(userData)
                    .then(() => {
                        showNotification(
                            translations[currentLanguage]['account-setup-completed'] || 
                            'Account setup completed successfully!', 
                            'success'
                        );
                        closeModal(elements.microsoftSetupModal);
                        elements.microsoftSetupForm.reset();
                        
                        // Redirect based on role
                        redirectBasedOnRole(role);
                    })
                    .catch((error) => {
                        console.error('Error saving user data:', error);
                        debug('Error saving user data: ' + error.message);
                        showNotification(
                            translations[currentLanguage]['error-saving-user-data'] || 
                            'Error saving user data. Please try again.', 
                            'error'
                        );
                    })
                    .finally(() => {
                        submitBtn.classList.remove('btn-loading');
                    });
            } else {
                showNotification(
                    translations[currentLanguage]['authentication-error'] || 
                    'Authentication error. Please try again.', 
                    'error'
                );
                submitBtn.classList.remove('btn-loading');
            }
        }

        // Handle Google setup form
        function handleGoogleSetup(e) {
            e.preventDefault();
            const submitBtn = elements.googleSetupForm.querySelector('.btn');
            
            // Show loading state
            submitBtn.classList.add('btn-loading');
            
            const collegeId = document.getElementById('googleCollegeId').value;
            const role = document.getElementById('googleRole').value;
            const department = document.getElementById('googleDepartment').value;
            const fullName = document.getElementById('googleFullName').value;
            
            // Get current user
            const user = auth.currentUser;
            
            if (user) {
                // Create user object
                const userData = {
                    collegeId,
                    role,
                    department: parseInt(department),
                    name: fullName,
                    email: user.email,
                    authMethod: 'google',
                    createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                    approved: true
                };
                
                debug('Creating Google user document: ' + JSON.stringify(userData));
                
                // Save user to Firestore
                db.collection('users').doc(user.uid).set(userData)
                    .then(() => {
                        showNotification(
                            translations[currentLanguage]['account-setup-completed'] || 
                            'Account setup completed successfully!', 
                            'success'
                        );
                        closeModal(elements.googleSetupModal);
                        elements.googleSetupForm.reset();
                        
                        // Redirect based on role
                        redirectBasedOnRole(role);
                    })
                    .catch((error) => {
                        console.error('Error saving user data:', error);
                        debug('Error saving user data: ' + error.message);
                        showNotification(
                            translations[currentLanguage]['error-saving-user-data'] || 
                            'Error saving user data. Please try again.', 
                            'error'
                        );
                    })
                    .finally(() => {
                        submitBtn.classList.remove('btn-loading');
                    });
            } else {
                showNotification(
                    translations[currentLanguage]['authentication-error'] || 
                    'Authentication error. Please try again.', 
                    'error'
                );
                submitBtn.classList.remove('btn-loading');
            }
        }

        // Handle login form submission
        function handleLogin(e) {
            e.preventDefault();
            const collegeId = document.getElementById('collegeId').value;
            const password = document.getElementById('password').value;
            const role = document.getElementById('role').value;
            const submitBtn = elements.loginForm.querySelector('.btn');

            debug('Login attempt: ' + collegeId + ', role: ' + role);

            // Show loading state
            submitBtn.classList.add('btn-loading');
            
            // For admin accounts, use direct authentication
            if (collegeId === 'principal.test' && role === 'principal') {
                debug('Attempting principal login');
                auth.signInWithEmailAndPassword('principal.test@sona.ac.in', password)
                    .then(() => {
                        showNotification(
                            translations[currentLanguage]['welcome-back-principal'] || 
                            `Welcome back, Principal!`, 
                            'success'
                        );
                        
                        // Remember user if checkbox is checked
                        if (document.getElementById('rememberMe').checked) {
                            localStorage.setItem('rememberedUser', JSON.stringify({
                                collegeId,
                                role
                            }));
                        }
                    })
                    .catch((error) => {
                        console.error('Login error:', error);
                        debug('Principal login error: ' + error.message);
                        submitBtn.classList.remove('btn-loading');
                        showNotification(
                            translations[currentLanguage]['invalid-credentials'] || 
                            'Invalid credentials. Please try again.', 
                            'error'
                        );
                    });
                return;
            }
            
            if (collegeId === 'hod.cse' && role === 'hod') {
                debug('Attempting HOD CSE login');
                auth.signInWithEmailAndPassword('hod.cse@sona.ac.in', password)
                    .then(() => {
                        showNotification(
                            translations[currentLanguage]['welcome-back-hod-cse'] || 
                            `Welcome back, HOD CSE!`, 
                            'success'
                        );
                        
                        // Remember user if checkbox is checked
                        if (document.getElementById('rememberMe').checked) {
                            localStorage.setItem('rememberedUser', JSON.stringify({
                                collegeId,
                                role
                            }));
                        }
                    })
                    .catch((error) => {
                        console.error('Login error:', error);
                        debug('HOD CSE login error: ' + error.message);
                        submitBtn.classList.remove('btn-loading');
                        showNotification(
                            translations[currentLanguage]['invalid-credentials'] || 
                            'Invalid credentials. Please try again.', 
                            'error'
                        );
                    });
                return;
            }
            
            if (collegeId === 'hod.ece' && role === 'hod') {
                debug('Attempting HOD ECE login');
                auth.signInWithEmailAndPassword('hod.ece@sona.ac.in', password)
                    .then(() => {
                        showNotification(
                            translations[currentLanguage]['welcome-back-hod-ece'] || 
                            `Welcome back, HOD ECE!`, 
                            'success'
                        );
                        
                        // Remember user if checkbox is checked
                        if (document.getElementById('rememberMe').checked) {
                            localStorage.setItem('rememberedUser', JSON.stringify({
                                collegeId,
                                role
                            }));
                        }
                    })
                    .catch((error) => {
                        console.error('Login error:', error);
                        debug('HOD ECE login error: ' + error.message);
                        submitBtn.classList.remove('btn-loading');
                        showNotification(
                            translations[currentLanguage]['invalid-credentials'] || 
                            'Invalid credentials. Please try again.', 
                            'error'
                        );
                    });
                return;
            }
            
            // Query Firestore for user with this collegeId
            debug('Querying Firestore for user: ' + collegeId + ', role: ' + role);
            db.collection('users')
                .where('collegeId', '==', collegeId)
                .where('role', '==', role)
                .limit(1)
                .get()
                .then(querySnapshot => {
                    if (querySnapshot.empty) {
                        // No user found
                        debug('No user found in Firestore');
                        submitBtn.classList.remove('btn-loading');
                        showNotification(
                            translations[currentLanguage]['invalid-credentials'] || 
                            'Invalid credentials. Please try again.', 
                            'error'
                        );
                        return;
                    }
                    
                    const userDoc = querySnapshot.docs[0];
                    const userData = userDoc.data();
                    
                    debug('User found in Firestore: ' + JSON.stringify(userData));
                    
                    // Get email from user data
                    const email = userData.email;
                    
                    // Sign in with email and password
                    return auth.signInWithEmailAndPassword(email, password);
                })
                .then((userCredential) => {
                    // Login successful
                    debug('Login successful');
                    showNotification(
                        translations[currentLanguage]['welcome-back'] || 
                        `Welcome back, ${collegeId}!`, 
                        'success'
                    );
                    
                    // Remember user if checkbox is checked
                    if (document.getElementById('rememberMe').checked) {
                        localStorage.setItem('rememberedUser', JSON.stringify({
                            collegeId,
                            role
                        }));
                    }
                    
                    // Redirect will be handled by auth state observer
                })
                .catch((error) => {
                    console.error('Login error:', error);
                    debug('Login error: ' + error.message);
                    submitBtn.classList.remove('btn-loading');
                    
                    if (error.code === 'auth/user-not-found' || error.code === 'auth/wrong-password') {
                        showNotification(
                            translations[currentLanguage]['invalid-credentials'] || 
                            'Invalid credentials. Please try again.', 
                            'error'
                        );
                    } else {
                        showNotification(
                            translations[currentLanguage]['login-failed'] || 
                            'Login failed. Please try again.', 
                            'error'
                        );
                    }
                });
        }

        // Handle registration form submission
        function handleRegister(e) {
            e.preventDefault();
            const submitBtn = elements.registerForm.querySelector('.btn');
            
            // Show loading state
            submitBtn.classList.add('btn-loading');
            
            const collegeId = document.getElementById('regCollegeId').value;
            const email = document.getElementById('regEmail').value;
            const password = document.getElementById('regPassword').value;
            const role = document.getElementById('regRole').value;
            const department = parseInt(document.getElementById('regDepartment').value);
            const fullName = document.getElementById('regFullName').value;
            
            // Create user with email and password
            auth.createUserWithEmailAndPassword(email, password)
                .then((userCredential) => {
                    const user = userCredential.user;
                    
                    // Create user object
                    const userData = {
                        collegeId,
                        role,
                        department,
                        name: fullName,
                        email,
                        authMethod: 'email',
                        createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                        approved: false // Default to not approved
                    };
                    
                    // Save user to Firestore
                    return db.collection('users').doc(user.uid).set(userData);
                })
                .then(() => {
                    showNotification(
                        translations[currentLanguage]['registration-submitted'] || 
                        'Registration submitted for approval. You will receive an email once approved.', 
                        'success'
                    );
                    closeModal(elements.registerModal);
                    elements.registerForm.reset();
                    elements.passwordStrength.className = 'password-strength';
                    elements.passwordStrengthText.textContent = translations[currentLanguage]['password-strength'] || 'Password strength';
                    
                    // Sign out the user until they're approved
                    auth.signOut();
                })
                .catch((error) => {
                    console.error('Registration error:', error);
                    
                    if (error.code === 'auth/email-already-in-use') {
                        showNotification(
                            translations[currentLanguage]['email-already-in-use'] || 
                            'Email already in use. Please use a different email.', 
                            'error'
                        );
                    } else if (error.code === 'auth/weak-password') {
                        showNotification(
                            translations[currentLanguage]['weak-password-error'] || 
                            'Password is too weak. Please use a stronger password.', 
                            'error'
                        );
                    } else {
                        showNotification(
                            translations[currentLanguage]['registration-failed'] || 
                            'Registration failed. Please try again.', 
                            'error'
                        );
                    }
                })
                .finally(() => {
                    submitBtn.classList.remove('btn-loading');
                });
        }

        // Handle forgot password form submission
        function handleForgotPassword(e) {
            e.preventDefault();
            const submitBtn = elements.forgotForm.querySelector('.btn');
            
            // Show loading state
            submitBtn.classList.add('btn-loading');
            
            const email = document.getElementById('forgotEmail').value;
            
            // Send password reset email
            auth.sendPasswordResetEmail(email)
                .then(() => {
                    showNotification(
                        translations[currentLanguage]['reset-link-sent'] || 
                        'Password reset link sent to your email.', 
                        'info'
                    );
                    closeModal(elements.forgotModal);
                    elements.forgotForm.reset();
                })
                .catch((error) => {
                    console.error('Password reset error:', error);
                    
                    if (error.code === 'auth/user-not-found') {
                        showNotification(
                            translations[currentLanguage]['no-user-found'] || 
                            'No user found with this email address.', 
                            'error'
                        );
                    } else {
                        showNotification(
                            translations[currentLanguage]['reset-link-failed'] || 
                            'Failed to send reset link. Please try again.', 
                            'error'
                        );
                    }
                })
                .finally(() => {
                    submitBtn.classList.remove('btn-loading');
                });
        }

        // Handle contact form submission
        function handleContactForm(e) {
            e.preventDefault();
            const submitBtn = elements.contactForm.querySelector('.btn');
            
            // Show loading state
            submitBtn.classList.add('btn-loading');
            
            const name = document.getElementById('contactName').value;
            const email = document.getElementById('contactEmail').value;
            const subject = document.getElementById('contactSubject').value;
            const message = document.getElementById('contactMessage').value;
            
            // Save contact message to Firestore
            db.collection('contactMessages').add({
                name,
                email,
                subject,
                message,
                createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                status: 'unread'
            })
            .then(() => {
                showNotification(
                    translations[currentLanguage]['message-sent'] || 
                    'Your message has been sent successfully. We will get back to you soon.', 
                    'success'
                );
                elements.contactForm.reset();
            })
            .catch((error) => {
                console.error('Error sending contact message:', error);
                showNotification(
                    translations[currentLanguage]['message-failed'] || 
                    'Failed to send your message. Please try again.', 
                    'error'
                );
            })
            .finally(() => {
                submitBtn.classList.remove('btn-loading');
            });
        }

        // Check for remembered user
        function checkRememberedUser() {
            const rememberedUser = localStorage.getItem('rememberedUser');
            if (rememberedUser) {
                const user = JSON.parse(rememberedUser);
                document.getElementById('collegeId').value = user.collegeId;
                document.getElementById('role').value = user.role;
                document.getElementById('rememberMe').checked = true;
                
                // Activate the corresponding role badge
                elements.roleBadges.forEach(badge => {
                    if (badge.getAttribute('data-role') === user.role) {
                        badge.classList.add('active');
                        badge.setAttribute('aria-pressed', 'true');
                    }
                });
            }
        }

        // Redirect based on user role
        function redirectBasedOnRole(role) {
            debug('Redirecting based on role: ' + role);
            
            // Add a slight delay to allow notification to be seen
            setTimeout(() => {
                let targetUrl = '';
                
                switch(role) {
                    case 'student':
                        targetUrl = 'student.html';
                        break;
                    case 'faculty':
                        targetUrl = 'faculty.html';
                        break;
                    case 'hod':
                        targetUrl = 'hod.html';
                        break;
                    case 'principal':
                        targetUrl = 'principal.html';
                        break;
                    default:
                        targetUrl = 'dashboard.html';
                }
                
                debug('Redirecting to: ' + targetUrl);
                
                // Redirect directly without checking if the page exists
                // This is for demo purposes - in production, you would want to ensure the pages exist
                window.location.href = targetUrl;
            }, 1000);
        }

        // Sync all Microsoft users (admin only)
        function syncAllMicrosoftUsers() {
            if (!auth.currentUser) {
                showNotification(
                    translations[currentLanguage]['please-login-first'] || 
                    'Please log in first', 
                    'error'
                );
                return;
            }
            
            // Check if current user is principal
            db.collection('users').doc(auth.currentUser.uid).get()
                .then(doc => {
                    if (!doc.exists || doc.data().role !== 'principal') {
                        showNotification(
                            translations[currentLanguage]['only-principals-can-sync'] || 
                            'Only principals can sync users', 
                            'error'
                        );
                        return;
                    }
                    
                    showNotification(
                        translations[currentLanguage]['starting-sync'] || 
                        'Starting Microsoft user sync...', 
                        'info'
                    );
                    
                    // Simulate API call delay
                    setTimeout(() => {
                        showNotification(
                            translations[currentLanguage]['sync-completed'] || 
                            'Microsoft user sync completed successfully', 
                            'success'
                        );
                        
                        // In a real implementation, you would:
                        // 1. Use Microsoft Graph API with admin credentials to fetch all users
                        // 2. Process each user and create/update Firebase auth and Firestore documents
                        // 3. Handle pagination for large user sets
                        // 4. Implement proper error handling and logging
                    }, 3000);
                });
        }

        // Handle keyboard navigation
        document.addEventListener('keydown', (e) => {
            // Close modals with Escape key
            if (e.key === 'Escape') {
                [elements.registerModal, elements.forgotModal, elements.microsoftSetupModal, elements.googleSetupModal, elements.roleSelectionModal].forEach(modal => {
                    if (modal.style.display === 'flex') {
                        closeModal(modal);
                    }
                });
            }
            
            // Toggle debug panel with Ctrl+D
            if (e.ctrlKey && e.key === 'd') {
                e.preventDefault();
                elements.debugPanel.classList.toggle('show');
            }
        });

        // Check if current user is admin to show sync button
        auth.onAuthStateChanged(user => {
            if (user) {
                db.collection('users').doc(user.uid).get()
                    .then(doc => {
                        if (doc.exists && doc.data().role === 'principal') {
                            elements.syncButton.classList.add('show');
                        }
                    });
            }
        });
    </script>
</body>
</html>
