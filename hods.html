<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="HOD Dashboard for Sona College of Technology Communication App">
    <title>Sona College of Technology - HOD Dashboard</title>
    <link rel="preconnect" href="https://rsms.me/">
    <link rel="stylesheet" href="https://rsms.me/inter/inter.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/tonsky/FiraCode@4/distr/fira_code.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.socket.io/4.7.5/socket.io.min.js"></script>
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-database-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-auth-compat.js"></script>
    <style>
        :root {
            /* Premium Dark Blue & Yellow Theme */
            --primary-dark: #0A192F;
            --secondary-dark: #172A45;
            --accent-blue: #1E3A8A;
            --accent-light-blue: #3B82F6;
            --primary-yellow: #F59E0B;
            --secondary-yellow: #FEF3C7;
            --accent-yellow: #FCD34D;
            --white: #FFFFFF;
            --light-gray: #F8FAFC;
            --medium-gray: #CBD5E1;
            --dark-gray: #64748B;
            --darker-gray: #334155;
            --success: #10B981;
            --warning: #F59E0B;
            --error: #EF4444;
            --info: #3B82F6;
            --shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            --shadow-lg: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--primary-dark);
            color: var(--white);
            height: 100vh;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .dashboard {
            flex: 1;
            display: flex;
            flex-direction: column;
        }

        .top-nav {
            background: var(--secondary-dark);
            padding: 1rem 1.5rem;
            display: flex;
            align-items: center;
            box-shadow: var(--shadow);
            z-index: 100;
        }

        .logo-small {
            width: 40px;
            margin-right: 1rem;
            border-radius: 4px;
        }

        .nav-title {
            font-size: 1.5rem;
            font-weight: 700;
            background: linear-gradient(90deg, var(--accent-light-blue), var(--primary-yellow));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            flex: 1;
        }

        .nav-actions {
            display: flex;
            align-items: center;
            gap: 1.5rem;
        }

        .nav-search {
            position: relative;
            display: flex;
            align-items: center;
        }

        .nav-search input {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            padding: 0.5rem 1rem 0.5rem 2.5rem;
            color: var(--white);
            width: 200px;
            transition: all 0.3s ease;
        }

        .nav-search input:focus {
            outline: none;
            background: rgba(255, 255, 255, 0.15);
            border-color: var(--accent-light-blue);
            width: 250px;
        }

        .nav-search i {
            position: absolute;
            left: 0.75rem;
            color: var(--medium-gray);
        }

        .notification-badge {
            position: relative;
            cursor: pointer;
            transition: transform 0.2s ease;
        }

        .notification-badge:hover {
            transform: scale(1.1);
        }

        .badge-count {
            position: absolute;
            top: -4px;
            right: -4px;
            background: var(--error);
            color: var(--white);
            font-size: 0.75rem;
            font-weight: 500;
            width: 1.25rem;
            height: 1.25rem;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .role-indicator {
            background: rgba(245, 158, 11, 0.2);
            color: var(--primary-yellow);
            padding: 0.5rem 1rem;
            border-radius: 9999px;
            font-size: 0.875rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            border: 1px solid rgba(245, 158, 11, 0.3);
        }

        .user-menu {
            position: relative;
        }

        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--accent-light-blue), var(--primary-yellow));
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s ease;
        }

        .user-avatar:hover {
            transform: scale(1.05);
        }

        .dropdown-menu {
            position: absolute;
            top: 100%;
            right: 0;
            margin-top: 0.5rem;
            background: var(--secondary-dark);
            border-radius: 8px;
            box-shadow: var(--shadow-lg);
            width: 200px;
            overflow: hidden;
            opacity: 0;
            visibility: hidden;
            transform: translateY(-10px);
            transition: all 0.3s ease;
            z-index: 1000;
        }

        .dropdown-menu.active {
            opacity: 1;
            visibility: visible;
            transform: translateY(0);
        }

        .dropdown-item {
            padding: 0.75rem 1rem;
            display: flex;
            align-items: center;
            gap: 0.75rem;
            cursor: pointer;
            transition: background 0.2s ease;
        }

        .dropdown-item:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        .dropdown-item i {
            width: 20px;
            color: var(--medium-gray);
        }

        .main-layout {
            flex: 1;
            display: flex;
            overflow: hidden;
        }

        .sidebar {
            width: 280px;
            background: var(--secondary-dark);
            overflow-y: auto;
            padding: 1.5rem 1rem;
            transition: width 0.3s ease, transform 0.3s ease;
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
        }

        .sidebar.collapsed {
            width: 80px;
        }

        .sidebar-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 0.5rem;
        }

        .sidebar-title {
            font-size: 1.25rem;
            font-weight: 600;
            color: var(--white);
        }

        .toggle-btn {
            background: none;
            border: none;
            cursor: pointer;
            color: var(--medium-gray);
            transition: color 0.15s ease, transform 0.2s ease;
            width: 36px;
            height: 36px;
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .toggle-btn:hover {
            color: var(--white);
            background: rgba(255, 255, 255, 0.1);
        }

        .sidebar-menu {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .menu-section {
            margin-bottom: 1rem;
        }

        .menu-section-title {
            font-size: 0.75rem;
            text-transform: uppercase;
            color: var(--medium-gray);
            margin-bottom: 0.5rem;
            padding: 0 0.75rem;
        }

        .menu-item {
            display: flex;
            align-items: center;
            padding: 0.75rem;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s ease;
            position: relative;
            overflow: hidden;
        }

        .menu-item::before {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            height: 100%;
            width: 4px;
            background: var(--primary-yellow);
            transform: translateX(-100%);
            transition: transform 0.2s ease;
        }

        .menu-item:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        .menu-item.active {
            background: rgba(245, 158, 11, 0.15);
        }

        .menu-item.active::before {
            transform: translateX(0);
        }

        .menu-icon {
            width: 24px;
            margin-right: 1rem;
            color: var(--medium-gray);
            transition: color 0.2s ease;
        }

        .menu-item.active .menu-icon {
            color: var(--primary-yellow);
        }

        .menu-text {
            font-size: 1rem;
            color: var(--white);
            font-weight: 500;
        }

        .contact-list {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
            margin-top: 1rem;
        }

        .contact-item {
            display: flex;
            align-items: center;
            padding: 0.75rem;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .contact-item:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        .contact-item.active {
            background: rgba(245, 158, 11, 0.15);
        }

        .contact-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: var(--darker-gray);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1rem;
            color: var(--white);
            margin-right: 1rem;
            position: relative;
        }

        .contact-avatar.online::after {
            content: '';
            position: absolute;
            bottom: 0;
            right: 0;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: var(--success);
            border: 2px solid var(--secondary-dark);
        }

        .contact-info {
            flex: 1;
        }

        .contact-name {
            font-size: 1rem;
            font-weight: 500;
            color: var(--white);
        }

        .contact-status {
            font-size: 0.75rem;
            color: var(--medium-gray);
        }

        .status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            margin-left: auto;
        }

        .status-online {
            background: var(--success);
        }

        .status-offline {
            background: var(--dark-gray);
        }

        .main-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            background: var(--primary-dark);
        }

        .content-header {
            padding: 1.5rem;
            display: flex;
            align-items: center;
            justify-content: space-between;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .page-title {
            font-size: 1.75rem;
            font-weight: 700;
            color: var(--white);
        }

        .header-actions {
            display: flex;
            gap: 1rem;
        }

        .btn {
            padding: 0.5rem 1rem;
            border-radius: 6px;
            font-weight: 500;
            cursor: pointer;
            border: none;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            transition: all 0.2s ease;
        }

        .btn-primary {
            background: var(--primary-yellow);
            color: var(--primary-dark);
        }

        .btn-primary:hover {
            background: var(--accent-yellow);
            transform: translateY(-2px);
            box-shadow: var(--shadow);
        }

        .btn-secondary {
            background: rgba(255, 255, 255, 0.1);
            color: var(--white);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .btn-secondary:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        .content-body {
            flex: 1;
            overflow-y: auto;
            padding: 1.5rem;
        }

        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .card {
            background: var(--secondary-dark);
            border-radius: 12px;
            padding: 1.5rem;
            box-shadow: var(--shadow);
            transition: transform 0.2s ease, box-shadow 0.2s ease;
            cursor: pointer;
        }

        .card:hover {
            transform: translateY(-4px);
            box-shadow: var(--shadow-lg);
        }

        .card-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 1rem;
        }

        .card-title {
            font-size: 1.25rem;
            font-weight: 600;
            color: var(--white);
        }

        .card-icon {
            width: 40px;
            height: 40px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.25rem;
        }

        .card-icon.blue {
            background: rgba(59, 130, 246, 0.2);
            color: var(--accent-light-blue);
        }

        .card-icon.yellow {
            background: rgba(245, 158, 11, 0.2);
            color: var(--primary-yellow);
        }

        .card-icon.green {
            background: rgba(16, 185, 129, 0.2);
            color: var(--success);
        }

        .card-value {
            font-size: 2rem;
            font-weight: 700;
            color: var(--white);
            margin-bottom: 0.5rem;
        }

        .card-description {
            color: var(--medium-gray);
            font-size: 0.875rem;
        }

        .card-action {
            margin-top: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            color: var(--accent-light-blue);
            font-size: 0.875rem;
            font-weight: 500;
            cursor: pointer;
            transition: color 0.2s ease;
        }

        .card-action:hover {
            color: var(--primary-yellow);
        }

        .chart-container {
            background: var(--secondary-dark);
            border-radius: 12px;
            padding: 1.5rem;
            box-shadow: var(--shadow);
            height: 400px;
            margin-bottom: 2rem;
        }

        .chart-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 1.5rem;
        }

        .chart-title {
            font-size: 1.25rem;
            font-weight: 600;
            color: var(--white);
        }

        .chart-options {
            display: flex;
            gap: 0.5rem;
        }

        .chart-option {
            padding: 0.25rem 0.75rem;
            border-radius: 4px;
            font-size: 0.875rem;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .chart-option.active {
            background: rgba(245, 158, 11, 0.2);
            color: var(--primary-yellow);
        }

        .chart-option:not(.active) {
            color: var(--medium-gray);
        }

        .chart-option:not(.active):hover {
            color: var(--white);
            background: rgba(255, 255, 255, 0.1);
        }

        .table-container {
            background: var(--secondary-dark);
            border-radius: 12px;
            padding: 1.5rem;
            box-shadow: var(--shadow);
            overflow: hidden;
        }

        .table-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 1.5rem;
        }

        .table-title {
            font-size: 1.25rem;
            font-weight: 600;
            color: var(--white);
        }

        .search-filter {
            display: flex;
            gap: 1rem;
        }

        .search-input {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 6px;
            padding: 0.5rem 1rem;
            color: var(--white);
            width: 250px;
            transition: all 0.3s ease;
        }

        .search-input:focus {
            outline: none;
            background: rgba(255, 255, 255, 0.15);
            border-color: var(--accent-light-blue);
        }

        .filter-select {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 6px;
            padding: 0.5rem 1rem;
            color: var(--white);
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .filter-select:focus {
            outline: none;
            background: rgba(255, 255, 255, 0.15);
            border-color: var(--accent-light-blue);
        }

        .data-table {
            width: 100%;
            border-collapse: collapse;
        }

        .data-table th {
            text-align: left;
            padding: 0.75rem;
            color: var(--medium-gray);
            font-weight: 600;
            font-size: 0.875rem;
            text-transform: uppercase;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .data-table td {
            padding: 0.75rem;
            color: var(--white);
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        }

        .data-table tr:hover {
            background: rgba(255, 255, 255, 0.05);
        }

        .status-badge {
            display: inline-flex;
            align-items: center;
            padding: 0.25rem 0.75rem;
            border-radius: 9999px;
            font-size: 0.75rem;
            font-weight: 500;
        }

        .status-badge.approved {
            background: rgba(16, 185, 129, 0.2);
            color: var(--success);
        }

        .status-badge.pending {
            background: rgba(245, 158, 11, 0.2);
            color: var(--primary-yellow);
        }

        .status-badge.rejected {
            background: rgba(239, 68, 68, 0.2);
            color: var(--error);
        }

        .table-actions {
            display: flex;
            gap: 0.5rem;
        }

        .action-icon {
            width: 32px;
            height: 32px;
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .action-icon:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        .action-icon.view {
            color: var(--accent-light-blue);
        }

        .action-icon.edit {
            color: var(--primary-yellow);
        }

        .action-icon.delete {
            color: var(--error);
        }

        .pagination {
            display: flex;
            justify-content: flex-end;
            align-items: center;
            gap: 0.5rem;
            margin-top: 1.5rem;
        }

        .page-btn {
            width: 36px;
            height: 36px;
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .page-btn.active {
            background: var(--primary-yellow);
            color: var(--primary-dark);
            font-weight: 600;
        }

        .page-btn:not(.active) {
            color: var(--medium-gray);
        }

        .page-btn:not(.active):hover {
            background: rgba(255, 255, 255, 0.1);
            color: var(--white);
        }

        .chat-container {
            display: none;
            flex-direction: column;
            height: 100%;
        }

        .chat-header {
            padding: 1rem 1.5rem;
            background: var(--secondary-dark);
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .chat-title {
            font-size: 1.25rem;
            font-weight: 600;
            color: var(--white);
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .chat-status {
            font-size: 0.875rem;
            color: var(--medium-gray);
            display: flex;
            align-items: center;
            gap: 0.25rem;
        }

        .status-indicator {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: var(--success);
        }

        .chat-actions {
            display: flex;
            gap: 1rem;
        }

        .action-btn {
            width: 36px;
            height: 36px;
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s ease;
            color: var(--medium-gray);
        }

        .action-btn:hover {
            background: rgba(255, 255, 255, 0.1);
            color: var(--white);
        }

        .chat-messages {
            flex: 1;
            overflow-y: auto;
            padding: 1.5rem;
            display: flex;
            flex-direction: column;
            gap: 1rem;
            background-image: url('https://z-cdn-media.chatglm.cn/files/e7d0f723-f080-4237-9b0d-44601e484cdb_pasted_image_1758874469084.jpg?auth_key=1790410541-aa3c91bca30d4f71b2cb96684831c7b7-0-260d43c3cae7a1ec6cad5bf7213b0812');
            background-size: cover;
            background-position: center;
            position: relative;
        }

        .chat-messages::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(10, 25, 47, 0.85);
            z-index: 1;
        }

        .message {
            display: flex;
            flex-direction: column;
            max-width: 70%;
            position: relative;
            z-index: 2;
        }

        .message.sent {
            align-self: flex-end;
            align-items: flex-end;
        }

        .message.received {
            align-self: flex-start;
            align-items: flex-start;
        }

        .message-sender {
            font-size: 0.875rem;
            color: var(--medium-gray);
            margin-bottom: 0.25rem;
        }

        .message-bubble {
            padding: 0.75rem 1rem;
            border-radius: 18px;
            font-size: 1rem;
            position: relative;
        }

        .message.sent .message-bubble {
            background: var(--primary-yellow);
            color: var(--primary-dark);
            border-bottom-right-radius: 4px;
        }

        .message.received .message-bubble {
            background: var(--secondary-dark);
            color: var(--white);
            border-bottom-left-radius: 4px;
        }

        .message-meta {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.75rem;
            color: var(--medium-gray);
            margin-top: 0.25rem;
        }

        .message-status {
            display: flex;
            align-items: center;
            gap: 0.25rem;
        }

        .message-status i {
            font-size: 0.875rem;
        }

        .message-status i.sent {
            color: var(--medium-gray);
        }

        .message-status i.delivered {
            color: var(--medium-gray);
        }

        .message-status i.seen {
            color: var(--accent-light-blue);
        }

        .encryption-indicator {
            display: flex;
            align-items: center;
            gap: 0.25rem;
        }

        .message-input {
            padding: 1rem 1.5rem;
            background: var(--secondary-dark);
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .input-wrapper {
            flex: 1;
            display: flex;
            align-items: center;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 9999px;
            padding: 0.5rem 1rem;
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: all 0.3s ease;
        }

        .input-wrapper:focus-within {
            background: rgba(255, 255, 255, 0.15);
            border-color: var(--accent-light-blue);
        }

        #messageInput {
            flex: 1;
            border: none;
            background: transparent;
            font-size: 1rem;
            color: var(--white);
        }

        #messageInput:focus {
            outline: none;
        }

        #messageInput::placeholder {
            color: var(--medium-gray);
        }

        .attach-btn, .send-btn {
            background: none;
            border: none;
            cursor: pointer;
            color: var(--medium-gray);
            transition: color 0.15s ease;
        }

        .attach-btn:hover, .send-btn:hover {
            color: var(--white);
        }

        .send-btn {
            background: var(--primary-yellow);
            color: var(--primary-dark);
            padding: 0.5rem;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .send-btn:hover {
            background: var(--accent-yellow);
            transform: scale(1.05);
        }

        .right-panel {
            width: 320px;
            background: var(--secondary-dark);
            border-left: 1px solid rgba(255, 255, 255, 0.1);
            overflow-y: auto;
            padding: 1.5rem;
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
        }

        .panel-section {
            background: rgba(255, 255, 255, 0.05);
            padding: 1rem;
            border-radius: 8px;
        }

        .section-title {
            font-size: 1rem;
            font-weight: 600;
            color: var(--white);
            margin-bottom: 0.75rem;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .section-action {
            font-size: 0.875rem;
            color: var(--accent-light-blue);
            cursor: pointer;
            transition: color 0.2s ease;
        }

        .section-action:hover {
            color: var(--primary-yellow);
        }

        .announcement-list, .file-list, .metrics-list {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .announcement-item, .file-item, .metric-item {
            padding: 0.75rem;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 6px;
            transition: all 0.2s ease;
            cursor: pointer;
        }

        .announcement-item:hover, .file-item:hover, .metric-item:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        .file-item {
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .file-icon {
            color: var(--accent-light-blue);
        }

        .file-name {
            flex: 1;
            font-size: 0.875rem;
            color: var(--white);
        }

        .download-btn {
            background: none;
            border: none;
            color: var(--medium-gray);
            cursor: pointer;
            transition: color 0.2s ease;
        }

        .download-btn:hover {
            color: var(--white);
        }

        .metric-item {
            display: flex;
            justify-content: space-between;
        }

        .metric-label {
            font-size: 0.875rem;
            color: var(--medium-gray);
        }

        .metric-value {
            font-weight: 600;
            color: var(--white);
        }

        .modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.7);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }

        .modal.active {
            opacity: 1;
            visibility: visible;
        }

        .modal-content {
            background: var(--secondary-dark);
            border-radius: 12px;
            width: 90%;
            max-width: 600px;
            max-height: 90vh;
            overflow-y: auto;
            transform: scale(0.9);
            transition: transform 0.3s ease;
        }

        .modal.active .modal-content {
            transform: scale(1);
        }

        .modal-header {
            padding: 1.5rem;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .modal-title {
            font-size: 1.5rem;
            font-weight: 600;
            color: var(--white);
        }

        .modal-close {
            width: 36px;
            height: 36px;
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s ease;
            color: var(--medium-gray);
        }

        .modal-close:hover {
            background: rgba(255, 255, 255, 0.1);
            color: var(--white);
        }

        .modal-body {
            padding: 1.5rem;
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
            color: var(--white);
        }

        .form-input, .form-textarea, .form-select {
            width: 100%;
            padding: 0.75rem;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 6px;
            color: var(--white);
            transition: all 0.3s ease;
        }

        .form-input:focus, .form-textarea:focus, .form-select:focus {
            outline: none;
            background: rgba(255, 255, 255, 0.15);
            border-color: var(--accent-light-blue);
        }

        .form-textarea {
            min-height: 120px;
            resize: vertical;
        }

        .form-actions {
            display: flex;
            justify-content: flex-end;
            gap: 1rem;
            margin-top: 1.5rem;
        }

        .notification-toast {
            position: fixed;
            bottom: 2rem;
            right: 2rem;
            background: var(--secondary-dark);
            border-radius: 8px;
            box-shadow: var(--shadow-lg);
            padding: 1rem 1.5rem;
            display: flex;
            align-items: center;
            gap: 1rem;
            min-width: 300px;
            transform: translateX(400px);
            transition: transform 0.3s ease;
            z-index: 1001;
        }

        .notification-toast.show {
            transform: translateX(0);
        }

        .notification-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }

        .notification-icon.success {
            background: rgba(16, 185, 129, 0.2);
            color: var(--success);
        }

        .notification-icon.error {
            background: rgba(239, 68, 68, 0.2);
            color: var(--error);
        }

        .notification-icon.warning {
            background: rgba(245, 158, 11, 0.2);
            color: var(--primary-yellow);
        }

        .notification-icon.info {
            background: rgba(59, 130, 246, 0.2);
            color: var(--accent-light-blue);
        }

        .notification-content {
            flex: 1;
        }

        .notification-title {
            font-weight: 600;
            color: var(--white);
            margin-bottom: 0.25rem;
        }

        .notification-message {
            font-size: 0.875rem;
            color: var(--medium-gray);
        }

        .notification-close {
            width: 24px;
            height: 24px;
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s ease;
            color: var(--medium-gray);
        }

        .notification-close:hover {
            background: rgba(255, 255, 255, 0.1);
            color: var(--white);
        }

        @media (max-width: 1024px) {
            .sidebar {
                position: absolute;
                left: 0;
                height: 100%;
                z-index: 10;
                transform: translateX(-100%);
                transition: transform 0.3s ease;
            }

            .sidebar.open {
                transform: translateX(0);
            }

            .right-panel {
                position: absolute;
                right: 0;
                height: 100%;
                z-index: 10;
                transform: translateX(100%);
                transition: transform 0.3s ease;
            }

            .right-panel.open {
                transform: translateX(0);
            }

            .dashboard-grid {
                grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            }
        }

        @media (max-width: 768px) {
            .nav-search input {
                width: 120px;
            }

            .nav-search input:focus {
                width: 150px;
            }

            .dashboard-grid {
                grid-template-columns: 1fr;
            }

            .chart-container {
                height: 300px;
            }

            .table-container {
                overflow-x: auto;
            }

            .data-table {
                min-width: 600px;
            }
        }

        @media (prefers-reduced-motion: reduce) {
            * {
                transition-duration: 0.01ms !important;
                animation-duration: 0.01ms !important;
            }
        }
    </style>
</head>
<body>
    <div class="dashboard">
        <nav class="top-nav">
            <img src="https://upload.wikimedia.org/wikipedia/commons/9/9d/Sona_College_of_Technology_logo.jpg" alt="Sona Logo" class="logo-small">
            <span class="nav-title">HOD Dashboard</span>
            <div class="nav-actions">
                <div class="nav-search">
                    <i class="fas fa-search"></i>
                    <input type="text" placeholder="Search...">
                </div>
                <div class="notification-badge" id="notifications">
                    <i class="fas fa-bell"></i>
                    <span class="badge-count">3</span>
                </div>
                <div class="user-menu">
                    <div class="user-avatar">JD</div>
                    <div class="dropdown-menu" id="userDropdown">
                        <div class="dropdown-item">
                            <i class="fas fa-user"></i>
                            <span>Profile</span>
                        </div>
                        <div class="dropdown-item">
                            <i class="fas fa-cog"></i>
                            <span>Settings</span>
                        </div>
                        <div class="dropdown-item">
                            <i class="fas fa-question-circle"></i>
                            <span>Help</span>
                        </div>
                        <div class="dropdown-item" id="logoutBtn">
                            <i class="fas fa-sign-out-alt"></i>
                            <span>Logout</span>
                        </div>
                    </div>
                </div>
                <span class="role-indicator">
                    <i class="fas fa-user-tie"></i>
                    HOD
                </span>
            </div>
        </nav>
        <div class="main-layout">
            <aside class="sidebar" id="sidebar">
                <div class="sidebar-header">
                    <span class="sidebar-title">Navigation</span>
                    <button class="toggle-btn" id="toggleSidebar">
                        <i class="fas fa-bars"></i>
                    </button>
                </div>
                <div class="sidebar-menu">
                    <div class="menu-section">
                        <div class="menu-section-title">Main</div>
                        <div class="menu-item active" data-page="dashboard">
                            <i class="fas fa-tachometer-alt menu-icon"></i>
                            <span class="menu-text">Dashboard</span>
                        </div>
                        <div class="menu-item" data-page="faculty">
                            <i class="fas fa-users menu-icon"></i>
                            <span class="menu-text">Faculty Management</span>
                        </div>
                        <div class="menu-item" data-page="academic">
                            <i class="fas fa-graduation-cap menu-icon"></i>
                            <span class="menu-text">Academic Planning</span>
                        </div>
                        <div class="menu-item" data-page="resources">
                            <i class="fas fa-box menu-icon"></i>
                            <span class="menu-text">Resource Management</span>
                        </div>
                        <div class="menu-item" data-page="budget">
                            <i class="fas fa-chart-pie menu-icon"></i>
                            <span class="menu-text">Budget & Finance</span>
                        </div>
                    </div>
                    <div class="menu-section">
                        <div class="menu-section-title">Communication</div>
                        <div class="menu-item" data-page="messages">
                            <i class="fas fa-comments menu-icon"></i>
                            <span class="menu-text">Messages</span>
                        </div>
                        <div class="menu-item" data-page="meetings">
                            <i class="fas fa-calendar-alt menu-icon"></i>
                            <span class="menu-text">Meetings</span>
                        </div>
                        <div class="menu-item" data-page="announcements">
                            <i class="fas fa-bullhorn menu-icon"></i>
                            <span class="menu-text">Announcements</span>
                        </div>
                    </div>
                    <div class="menu-section">
                        <div class="menu-section-title">Reports</div>
                        <div class="menu-item" data-page="reports">
                            <i class="fas fa-file-alt menu-icon"></i>
                            <span class="menu-text">Department Reports</span>
                        </div>
                        <div class="menu-item" data-page="analytics">
                            <i class="fas fa-chart-line menu-icon"></i>
                            <span class="menu-text">Analytics</span>
                        </div>
                    </div>
                </div>
                <div class="contact-list">
                    <div class="menu-section-title">Quick Contacts</div>
                    <div class="contact-item active" data-contact="department">
                        <div class="contact-avatar online">DG</div>
                        <div class="contact-info">
                            <span class="contact-name">Department Group</span>
                            <span class="contact-status">Active</span>
                        </div>
                        <div class="status-dot status-online"></div>
                    </div>
                    <div class="contact-item" data-contact="principal">
                        <div class="contact-avatar online">PR</div>
                        <div class="contact-info">
                            <span class="contact-name">Principal</span>
                            <span class="contact-status">Online</span>
                        </div>
                        <div class="status-dot status-online"></div>
                    </div>
                    <div class="contact-item" data-contact="admin">
                        <div class="contact-avatar">AD</div>
                        <div class="contact-info">
                            <span class="contact-name">Admin Office</span>
                            <span class="contact-status">Offline</span>
                        </div>
                        <div class="status-dot status-offline"></div>
                    </div>
                </div>
            </aside>
            <main class="main-content">
                <div class="content-header">
                    <h1 class="page-title" id="pageTitle">Dashboard</h1>
                    <div class="header-actions">
                        <button class="btn btn-secondary" id="refreshBtn">
                            <i class="fas fa-sync-alt"></i>
                            Refresh
                        </button>
                        <button class="btn btn-primary" id="newBtn">
                            <i class="fas fa-plus"></i>
                            New
                        </button>
                    </div>
                </div>
                <div class="content-body" id="contentBody">
                    <!-- Dashboard Content -->
                    <div class="dashboard-grid">
                        <div class="card" data-action="faculty-details">
                            <div class="card-header">
                                <h3 class="card-title">Faculty Members</h3>
                                <div class="card-icon blue">
                                    <i class="fas fa-users"></i>
                                </div>
                            </div>
                            <div class="card-value" id="facultyCount">0</div>
                            <div class="card-description">Active faculty members in the department</div>
                            <div class="card-action">
                                <span>View Details</span>
                                <i class="fas fa-arrow-right"></i>
                            </div>
                        </div>
                        <div class="card" data-action="student-details">
                            <div class="card-header">
                                <h3 class="card-title">Students</h3>
                                <div class="card-icon yellow">
                                    <i class="fas fa-user-graduate"></i>
                                </div>
                            </div>
                            <div class="card-value" id="studentCount">0</div>
                            <div class="card-description">Total students across all programs</div>
                            <div class="card-action">
                                <span>View Details</span>
                                <i class="fas fa-arrow-right"></i>
                            </div>
                        </div>
                        <div class="card" data-action="course-details">
                            <div class="card-header">
                                <h3 class="card-title">Courses</h3>
                                <div class="card-icon green">
                                    <i class="fas fa-book"></i>
                                </div>
                            </div>
                            <div class="card-value" id="courseCount">0</div>
                            <div class="card-description">Active courses this semester</div>
                            <div class="card-action">
                                <span>View Details</span>
                                <i class="fas fa-arrow-right"></i>
                            </div>
                        </div>
                        <div class="card" data-action="budget-details">
                            <div class="card-header">
                                <h3 class="card-title">Budget Utilization</h3>
                                <div class="card-icon blue">
                                    <i class="fas fa-chart-pie"></i>
                                </div>
                            </div>
                            <div class="card-value" id="budgetUtilization">0%</div>
                            <div class="card-description">Of the annual budget utilized</div>
                            <div class="card-action">
                                <span>View Details</span>
                                <i class="fas fa-arrow-right"></i>
                            </div>
                        </div>
                    </div>
                    
                    <div class="chart-container">
                        <div class="chart-header">
                            <h3 class="chart-title">Department Performance</h3>
                            <div class="chart-options">
                                <div class="chart-option active" data-period="semester">Semester</div>
                                <div class="chart-option" data-period="year">Year</div>
                            </div>
                        </div>
                        <canvas id="performanceChart"></canvas>
                    </div>
                    
                    <div class="table-container">
                        <div class="table-header">
                            <h3 class="table-title">Recent Approvals</h3>
                            <div class="search-filter">
                                <input type="text" class="search-input" placeholder="Search...">
                                <select class="filter-select">
                                    <option>All Status</option>
                                    <option>Pending</option>
                                    <option>Approved</option>
                                    <option>Rejected</option>
                                </select>
                            </div>
                        </div>
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>Title</th>
                                    <th>Requested By</th>
                                    <th>Date</th>
                                    <th>Status</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="approvalsTableBody">
                                <!-- Data will be loaded here -->
                            </tbody>
                        </table>
                        <div class="pagination">
                            <div class="page-btn" data-page="prev">
                                <i class="fas fa-chevron-left"></i>
                            </div>
                            <div class="page-btn active" data-page="1">1</div>
                            <div class="page-btn" data-page="2">2</div>
                            <div class="page-btn" data-page="3">3</div>
                            <div class="page-btn" data-page="next">
                                <i class="fas fa-chevron-right"></i>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Chat Container (Hidden by default) -->
                <div class="chat-container" id="chatContainer">
                    <div class="chat-header">
                        <div class="chat-title">
                            <div class="contact-avatar online">DG</div>
                            <div>
                                <div>Department Group</div>
                                <div class="chat-status">
                                    <div class="status-indicator"></div>
                                    Online
                                </div>
                            </div>
                        </div>
                        <div class="chat-actions">
                            <div class="action-btn" title="Video Call">
                                <i class="fas fa-video"></i>
                            </div>
                            <div class="action-btn" title="Voice Call">
                                <i class="fas fa-phone"></i>
                            </div>
                            <div class="action-btn" title="Search">
                                <i class="fas fa-search"></i>
                            </div>
                            <div class="action-btn" title="More Options">
                                <i class="fas fa-ellipsis-v"></i>
                            </div>
                        </div>
                    </div>
                    <div class="chat-messages" id="messages">
                        <!-- Messages will be loaded here -->
                    </div>
                    <div class="message-input">
                        <div class="input-wrapper">
                            <input type="text" id="messageInput" placeholder="Type your message...">
                        </div>
                        <label for="fileInput" class="attach-btn">
                            <i class="fas fa-paperclip"></i>
                        </label>
                        <input type="file" id="fileInput" style="display: none;" accept="image/*,application/pdf,.doc,.docx">
                        <button class="send-btn" id="sendButton">
                            <i class="fas fa-paper-plane"></i>
                        </button>
                    </div>
                </div>
            </main>
            <aside class="right-panel" id="rightPanel">
                <div class="panel-section">
                    <h3 class="section-title">
                        Announcements
                        <span class="section-action">View All</span>
                    </h3>
                    <div class="announcement-list" id="announcementList">
                        <!-- Announcements will be loaded here -->
                    </div>
                </div>
                <div class="panel-section">
                    <h3 class="section-title">
                        Shared Files
                        <span class="section-action">View All</span>
                    </h3>
                    <div class="file-list" id="fileList">
                        <!-- Files will be loaded here -->
                    </div>
                </div>
                <div class="panel-section">
                    <h3 class="section-title">Department Metrics</h3>
                    <div class="metrics-list">
                        <div class="metric-item">
                            <span class="metric-label">Attendance Rate</span>
                            <span class="metric-value" id="attendanceRate">0%</span>
                        </div>
                        <div class="metric-item">
                            <span class="metric-label">Pending Approvals</span>
                            <span class="metric-value" id="pendingApprovals">0</span>
                        </div>
                        <div class="metric-item">
                            <span class="metric-label">Upcoming Events</span>
                            <span class="metric-value" id="upcomingEvents">0</span>
                        </div>
                        <div class="metric-item">
                            <span class="metric-label">Research Papers</span>
                            <span class="metric-value" id="researchPapers">0</span>
                        </div>
                    </div>
                </div>
            </aside>
        </div>
    </div>

    <!-- Modal for forms -->
    <div class="modal" id="formModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title" id="modalTitle">New Request</h3>
                <div class="modal-close" id="modalClose">
                    <i class="fas fa-times"></i>
                </div>
            </div>
            <div class="modal-body">
                <form id="modalForm">
                    <div class="form-group">
                        <label class="form-label" for="requestType">Request Type</label>
                        <select class="form-select" id="requestType" required>
                            <option value="">Select a type</option>
                            <option value="conference">Conference Attendance</option>
                            <option value="equipment">Equipment Purchase</option>
                            <option value="research">Research Grant</option>
                            <option value="leave">Leave Request</option>
                            <option value="other">Other</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="requestTitle">Title</label>
                        <input type="text" class="form-input" id="requestTitle" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="requestDescription">Description</label>
                        <textarea class="form-textarea" id="requestDescription" required></textarea>
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="requestAmount">Amount (if applicable)</label>
                        <input type="number" class="form-input" id="requestAmount">
                    </div>
                    <div class="form-actions">
                        <button type="button" class="btn btn-secondary" id="cancelBtn">Cancel</button>
                        <button type="submit" class="btn btn-primary">Submit Request</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Notification Toast -->
    <div class="notification-toast" id="notificationToast">
        <div class="notification-icon success">
            <i class="fas fa-check-circle"></i>
        </div>
        <div class="notification-content">
            <div class="notification-title">Success</div>
            <div class="notification-message">Your request has been submitted successfully.</div>
        </div>
        <div class="notification-close" id="notificationClose">
            <i class="fas fa-times"></i>
        </div>
    </div>

    <script>
        // Initialize Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyAUmR-p_bJ970GK9CevtzgfAm99nvLvSaE",
            authDomain: "sona-da878.firebaseapp.com",
            databaseURL: "https://sona-da878-default-rtdb.firebaseio.com",
            projectId: "sona-da878",
            storageBucket: "sona-da878.firebasestorage.app",
            messagingSenderId: "963825066019",
            appId: "1:963825066019:web:c1a095c0972a8874195196",
            measurementId: "G-ED8CHJSJGH"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();
        const auth = firebase.auth();

        // Initialize variables
        const API_BASE = 'http://localhost:3000/api';
        const socket = io('http://localhost:3000');
        let currentPage = 'dashboard';
        let currentUser = null;
        let performanceChart = null;
        let chatMessages = [];
        let currentChat = 'department';

        // DOM Elements
        const sidebar = document.getElementById('sidebar');
        const toggleSidebar = document.getElementById('toggleSidebar');
        const contentBody = document.getElementById('contentBody');
        const pageTitle = document.getElementById('pageTitle');
        const menuItems = document.querySelectorAll('.menu-item');
        const contactItems = document.querySelectorAll('.contact-item');
        const userDropdown = document.getElementById('userDropdown');
        const userAvatar = document.querySelector('.user-avatar');
        const logoutBtn = document.getElementById('logoutBtn');
        const refreshBtn = document.getElementById('refreshBtn');
        const newBtn = document.getElementById('newBtn');
        const formModal = document.getElementById('formModal');
        const modalClose = document.getElementById('modalClose');
        const modalForm = document.getElementById('modalForm');
        const cancelBtn = document.getElementById('cancelBtn');
        const notificationToast = document.getElementById('notificationToast');
        const notificationClose = document.getElementById('notificationClose');
        const chatContainer = document.getElementById('chatContainer');
        const rightPanel = document.getElementById('rightPanel');
        const messageInput = document.getElementById('messageInput');
        const sendButton = document.getElementById('sendButton');
        const messagesContainer = document.getElementById('messages');

        // Initialize the app
        document.addEventListener('DOMContentLoaded', () => {
            checkAuth();
            initializeEventListeners();
            initializeChart();
            loadDashboardData();
        });

        // Check authentication
        function checkAuth() {
            auth.onAuthStateChanged((user) => {
                if (user) {
                    // User is signed in
                    currentUser = {
                        uid: user.uid,
                        name: user.displayName || 'User',
                        email: user.email,
                        role: 'hod'
                    };
                    
                    // Update user avatar
                    const initials = currentUser.name.split(' ').map(n => n[0]).join('').toUpperCase();
                    userAvatar.textContent = initials;
                    
                    // Load user data from Firebase
                    loadUserData();
                } else {
                    // User is signed out
                    window.location.href = 'index.html';
                }
            });
        }

        // Load user data from Firebase
        function loadUserData() {
            database.ref('users/' + currentUser.uid).once('value').then((snapshot) => {
                if (snapshot.exists()) {
                    const userData = snapshot.val();
                    currentUser = { ...currentUser, ...userData };
                }
            }).catch((error) => {
                console.error("Error loading user data:", error);
            });
        }

        // Initialize event listeners
        function initializeEventListeners() {
            // Toggle sidebar
            toggleSidebar.addEventListener('click', () => {
                sidebar.classList.toggle('collapsed');
            });

            // Menu item clicks
            menuItems.forEach(item => {
                item.addEventListener('click', () => {
                    const page = item.getAttribute('data-page');
                    if (page) {
                        loadPage(page);
                        
                        // Update active menu item
                        menuItems.forEach(i => i.classList.remove('active'));
                        item.classList.add('active');
                        
                        // Hide chat container if visible
                        chatContainer.style.display = 'none';
                        contentBody.style.display = 'block';
                    }
                });
            });

            // Contact item clicks
            contactItems.forEach(item => {
                item.addEventListener('click', () => {
                    const contact = item.getAttribute('data-contact');
                    if (contact) {
                        openChat(contact);
                        
                        // Update active contact
                        contactItems.forEach(i => i.classList.remove('active'));
                        item.classList.add('active');
                    }
                });
            });

            // User dropdown
            userAvatar.addEventListener('click', () => {
                userDropdown.classList.toggle('active');
            });

            // Close dropdown when clicking outside
            document.addEventListener('click', (e) => {
                if (!userAvatar.contains(e.target) && !userDropdown.contains(e.target)) {
                    userDropdown.classList.remove('active');
                }
            });

            // Logout
            logoutBtn.addEventListener('click', () => {
                auth.signOut().then(() => {
                    window.location.href = 'index.html';
                }).catch((error) => {
                    console.error("Error signing out:", error);
                });
            });

            // Refresh button
            refreshBtn.addEventListener('click', () => {
                refreshBtn.querySelector('i').classList.add('fa-spin');
                setTimeout(() => {
                    refreshBtn.querySelector('i').classList.remove('fa-spin');
                    loadPage(currentPage);
                    showNotification('success', 'Refreshed', 'Data has been refreshed successfully.');
                }, 1000);
            });

            // New button
            newBtn.addEventListener('click', () => {
                openModal();
            });

            // Modal close
            modalClose.addEventListener('click', closeModal);
            cancelBtn.addEventListener('click', closeModal);

            // Close modal when clicking outside
            formModal.addEventListener('click', (e) => {
                if (e.target === formModal) {
                    closeModal();
                }
            });

            // Form submission
            modalForm.addEventListener('submit', (e) => {
                e.preventDefault();
                submitForm();
            });

            // Notification close
            notificationClose.addEventListener('click', () => {
                notificationToast.classList.remove('show');
            });

            // Send message
            sendButton.addEventListener('click', sendMessage);
            messageInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    sendMessage();
                }
            });

            // Card actions
            document.querySelectorAll('.card[data-action]').forEach(card => {
                card.addEventListener('click', () => {
                    const action = card.getAttribute('data-action');
                    handleCardAction(action);
                });
            });

            // Table actions
            document.querySelectorAll('.action-icon').forEach(icon => {
                icon.addEventListener('click', (e) => {
                    e.stopPropagation();
                    const action = icon.getAttribute('data-action');
                    const id = icon.getAttribute('data-id');
                    handleTableAction(action, id);
                });
            });

            // Pagination
            document.querySelectorAll('.page-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    const page = btn.getAttribute('data-page');
                    handlePagination(page);
                });
            });

            // Chart options
            document.querySelectorAll('.chart-option').forEach(option => {
                option.addEventListener('click', () => {
                    const period = option.getAttribute('data-period');
                    handleChartOption(period);
                });
            });

            // File downloads
            document.querySelectorAll('.download-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    e.stopPropagation();
                    const fileItem = btn.closest('.file-item');
                    const fileName = fileItem.getAttribute('data-file');
                    downloadFile(fileName);
                });
            });

            // Socket.io events
            socket.on('connect', () => {
                console.log('Connected to server');
                // Join the department room
                socket.emit('join-room', { room: 'department', user: currentUser });
            });

            socket.on('message', (data) => {
                receiveMessage(data);
            });

            socket.on('message-status', (data) => {
                updateMessageStatus(data.messageId, data.status);
            });

            socket.on('notification', (data) => {
                showNotification(data.type, data.title, data.message);
            });
        }

        // Load page content
        function loadPage(page) {
            currentPage = page;
            
            switch (page) {
                case 'dashboard':
                    pageTitle.textContent = 'Dashboard';
                    loadDashboardData();
                    break;
                case 'faculty':
                    pageTitle.textContent = 'Faculty Management';
                    loadFacultyData();
                    break;
                case 'academic':
                    pageTitle.textContent = 'Academic Planning';
                    loadAcademicData();
                    break;
                case 'resources':
                    pageTitle.textContent = 'Resource Management';
                    loadResourcesData();
                    break;
                case 'budget':
                    pageTitle.textContent = 'Budget & Finance';
                    loadBudgetData();
                    break;
                case 'messages':
                    pageTitle.textContent = 'Messages';
                    loadMessagesData();
                    break;
                case 'meetings':
                    pageTitle.textContent = 'Meetings';
                    loadMeetingsData();
                    break;
                case 'announcements':
                    pageTitle.textContent = 'Announcements';
                    loadAnnouncementsData();
                    break;
                case 'reports':
                    pageTitle.textContent = 'Department Reports';
                    loadReportsData();
                    break;
                case 'analytics':
                    pageTitle.textContent = 'Analytics';
                    loadAnalyticsData();
                    break;
                default:
                    pageTitle.textContent = 'Dashboard';
                    loadDashboardData();
            }
        }

        // Load dashboard data from Firebase
        function loadDashboardData() {
            // Load faculty count
            database.ref('faculty').once('value').then((snapshot) => {
                const facultyData = snapshot.val();
                const facultyCount = facultyData ? Object.keys(facultyData).length : 0;
                document.getElementById('facultyCount').textContent = facultyCount;
            }).catch((error) => {
                console.error("Error loading faculty data:", error);
            });

            // Load student count
            database.ref('students').once('value').then((snapshot) => {
                const studentData = snapshot.val();
                const studentCount = studentData ? Object.keys(studentData).length : 0;
                document.getElementById('studentCount').textContent = studentCount;
            }).catch((error) => {
                console.error("Error loading student data:", error);
            });

            // Load course count
            database.ref('courses').once('value').then((snapshot) => {
                const courseData = snapshot.val();
                const courseCount = courseData ? Object.keys(courseData).length : 0;
                document.getElementById('courseCount').textContent = courseCount;
            }).catch((error) => {
                console.error("Error loading course data:", error);
            });

            // Load budget utilization
            database.ref('budget/utilization').once('value').then((snapshot) => {
                const budgetData = snapshot.val();
                const utilization = budgetData ? budgetData.utilization : 0;
                document.getElementById('budgetUtilization').textContent = utilization + '%';
            }).catch((error) => {
                console.error("Error loading budget data:", error);
            });

            // Load department metrics
            database.ref('metrics').once('value').then((snapshot) => {
                const metricsData = snapshot.val();
                if (metricsData) {
                    document.getElementById('attendanceRate').textContent = metricsData.attendanceRate + '%';
                    document.getElementById('pendingApprovals').textContent = metricsData.pendingApprovals;
                    document.getElementById('upcomingEvents').textContent = metricsData.upcomingEvents;
                    document.getElementById('researchPapers').textContent = metricsData.researchPapers;
                }
            }).catch((error) => {
                console.error("Error loading metrics data:", error);
            });

            // Load approvals
            loadApprovalsData();

            // Load announcements
            loadAnnouncementsList();

            // Load files
            loadFilesList();

            // Update chart data
            if (performanceChart) {
                database.ref('performance').once('value').then((snapshot) => {
                    const performanceData = snapshot.val();
                    if (performanceData) {
                        performanceChart.data.datasets[0].data = performanceData.data;
                        performanceChart.update();
                    }
                }).catch((error) => {
                    console.error("Error loading performance data:", error);
                });
            }
        }

        // Load approvals data
        function loadApprovalsData() {
            const approvalsTableBody = document.getElementById('approvalsTableBody');
            approvalsTableBody.innerHTML = '';

            database.ref('approvals').orderByChild('date').limitToLast(10).once('value').then((snapshot) => {
                const approvalsData = snapshot.val();
                
                if (approvalsData) {
                    Object.keys(approvalsData).forEach(key => {
                        const approval = approvalsData[key];
                        const row = document.createElement('tr');
                        
                        row.innerHTML = `
                            <td>#${approval.id}</td>
                            <td>${approval.title}</td>
                            <td>${approval.requestedBy}</td>
                            <td>${approval.date}</td>
                            <td><span class="status-badge ${approval.status}">${approval.status}</span></td>
                            <td>
                                <div class="table-actions">
                                    <div class="action-icon view" data-action="view-request" data-id="${approval.id}">
                                        <i class="fas fa-eye"></i>
                                    </div>
                                    <div class="action-icon edit" data-action="edit-request" data-id="${approval.id}">
                                        <i class="fas fa-edit"></i>
                                    </div>
                                    <div class="action-icon delete" data-action="delete-request" data-id="${approval.id}">
                                        <i class="fas fa-trash"></i>
                                    </div>
                                </div>
                            </td>
                        `;
                        
                        approvalsTableBody.appendChild(row);
                    });
                }
            }).catch((error) => {
                console.error("Error loading approvals data:", error);
            });

            // Re-attach event listeners for new elements
            attachTableActionListeners();
        }

        // Load announcements list
        function loadAnnouncementsList() {
            const announcementList = document.getElementById('announcementList');
            announcementList.innerHTML = '';

            database.ref('announcements').orderByChild('date').limitToLast(5).once('value').then((snapshot) => {
                const announcementsData = snapshot.val();
                
                if (announcementsData) {
                    Object.keys(announcementsData).forEach(key => {
                        const announcement = announcementsData[key];
                        const item = document.createElement('div');
                        item.className = 'announcement-item';
                        item.textContent = announcement.title;
                        
                        announcementList.appendChild(item);
                    });
                }
            }).catch((error) => {
                console.error("Error loading announcements data:", error);
            });
        }

        // Load files list
        function loadFilesList() {
            const fileList = document.getElementById('fileList');
            fileList.innerHTML = '';

            database.ref('files').orderByChild('uploadedAt').limitToLast(5).once('value').then((snapshot) => {
                const filesData = snapshot.val();
                
                if (filesData) {
                    Object.keys(filesData).forEach(key => {
                        const file = filesData[key];
                        const item = document.createElement('div');
                        item.className = 'file-item';
                        item.setAttribute('data-file', file.name);
                        
                        let iconClass = 'fa-file';
                        if (file.type === 'pdf') iconClass = 'fa-file-pdf';
                        else if (file.type === 'doc' || file.type === 'docx') iconClass = 'fa-file-word';
                        else if (file.type === 'xls' || file.type === 'xlsx') iconClass = 'fa-file-excel';
                        
                        item.innerHTML = `
                            <i class="fas ${iconClass} file-icon"></i>
                            <span class="file-name">${file.name}</span>
                            <button class="download-btn">
                                <i class="fas fa-download"></i>
                            </button>
                        `;
                        
                        fileList.appendChild(item);
                    });
                }
            }).catch((error) => {
                console.error("Error loading files data:", error);
            });

            // Re-attach event listeners for new elements
            attachFileDownloadListeners();
        }

        // Load faculty data
        function loadFacultyData() {
            contentBody.innerHTML = `
                <div class="table-container">
                    <div class="table-header">
                        <h3 class="table-title">Faculty Members</h3>
                        <div class="search-filter">
                            <input type="text" class="search-input" placeholder="Search faculty...">
                            <select class="filter-select">
                                <option>All Departments</option>
                                <option>Computer Science</option>
                                <option>Electronics</option>
                                <option>Mechanical</option>
                                <option>Civil</option>
                            </select>
                        </div>
                    </div>
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Name</th>
                                <th>Department</th>
                                <th>Designation</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="facultyTableBody">
                            <!-- Data will be loaded here -->
                        </tbody>
                    </table>
                    <div class="pagination">
                        <div class="page-btn" data-page="prev">
                            <i class="fas fa-chevron-left"></i>
                        </div>
                        <div class="page-btn active" data-page="1">1</div>
                        <div class="page-btn" data-page="2">2</div>
                        <div class="page-btn" data-page="3">3</div>
                        <div class="page-btn" data-page="next">
                            <i class="fas fa-chevron-right"></i>
                        </div>
                    </div>
                </div>
            `;
            
            // Load faculty data from Firebase
            const facultyTableBody = document.getElementById('facultyTableBody');
            facultyTableBody.innerHTML = '';

            database.ref('faculty').once('value').then((snapshot) => {
                const facultyData = snapshot.val();
                
                if (facultyData) {
                    Object.keys(facultyData).forEach(key => {
                        const faculty = facultyData[key];
                        const row = document.createElement('tr');
                        
                        row.innerHTML = `
                            <td>${faculty.id}</td>
                            <td>${faculty.name}</td>
                            <td>${faculty.department}</td>
                            <td>${faculty.designation}</td>
                            <td><span class="status-badge ${faculty.status}">${faculty.status}</span></td>
                            <td>
                                <div class="table-actions">
                                    <div class="action-icon view" data-action="view-faculty" data-id="${faculty.id}">
                                        <i class="fas fa-eye"></i>
                                    </div>
                                    <div class="action-icon edit" data-action="edit-faculty" data-id="${faculty.id}">
                                        <i class="fas fa-edit"></i>
                                    </div>
                                    <div class="action-icon delete" data-action="delete-faculty" data-id="${faculty.id}">
                                        <i class="fas fa-trash"></i>
                                    </div>
                                </div>
                            </td>
                        `;
                        
                        facultyTableBody.appendChild(row);
                    });
                }
            }).catch((error) => {
                console.error("Error loading faculty data:", error);
            });
            
            // Re-attach event listeners for new elements
            attachTableActionListeners();
            attachPaginationListeners();
        }

        // Load academic data
        function loadAcademicData() {
            contentBody.innerHTML = `
                <div class="dashboard-grid">
                    <div class="card" data-action="courses-details">
                        <div class="card-header">
                            <h3 class="card-title">Active Courses</h3>
                            <div class="card-icon blue">
                                <i class="fas fa-book"></i>
                            </div>
                        </div>
                        <div class="card-value" id="activeCoursesCount">0</div>
                        <div class="card-description">Courses this semester</div>
                        <div class="card-action">
                            <span>View All</span>
                            <i class="fas fa-arrow-right"></i>
                        </div>
                    </div>
                    <div class="card" data-action="programs-details">
                        <div class="card-header">
                            <h3 class="card-title">Programs</h3>
                            <div class="card-icon yellow">
                                <i class="fas fa-graduation-cap"></i>
                            </div>
                        </div>
                        <div class="card-value" id="programsCount">0</div>
                        <div class="card-description">Degree programs offered</div>
                        <div class="card-action">
                            <span>View All</span>
                            <i class="fas fa-arrow-right"></i>
                        </div>
                    </div>
                    <div class="card" data-action="curriculum-details">
                        <div class="card-header">
                            <h3 class="card-title">Curriculum Updates</h3>
                            <div class="card-icon green">
                                <i class="fas fa-sync-alt"></i>
                            </div>
                        </div>
                        <div class="card-value" id="curriculumUpdatesCount">0</div>
                        <div class="card-description">Pending curriculum updates</div>
                        <div class="card-action">
                            <span>View All</span>
                            <i class="fas fa-arrow-right"></i>
                        </div>
                    </div>
                </div>
                
                <div class="table-container">
                    <div class="table-header">
                        <h3 class="table-title">Course Schedule</h3>
                        <div class="search-filter">
                            <input type="text" class="search-input" placeholder="Search courses...">
                            <select class="filter-select">
                                <option>All Semesters</option>
                                <option>Fall 2023</option>
                                <option>Spring 2024</option>
                                <option>Summer 2024</option>
                            </select>
                        </div>
                    </div>
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Course Code</th>
                                <th>Course Name</th>
                                <th>Instructor</th>
                                <th>Schedule</th>
                                <th>Students</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="coursesTableBody">
                            <!-- Data will be loaded here -->
                        </tbody>
                    </table>
                    <div class="pagination">
                        <div class="page-btn" data-page="prev">
                            <i class="fas fa-chevron-left"></i>
                        </div>
                        <div class="page-btn active" data-page="1">1</div>
                        <div class="page-btn" data-page="2">2</div>
                        <div class="page-btn" data-page="3">3</div>
                        <div class="page-btn" data-page="next">
                            <i class="fas fa-chevron-right"></i>
                        </div>
                    </div>
                </div>
            `;
            
            // Load courses data from Firebase
            database.ref('courses').once('value').then((snapshot) => {
                const coursesData = snapshot.val();
                const coursesCount = coursesData ? Object.keys(coursesData).length : 0;
                document.getElementById('activeCoursesCount').textContent = coursesCount;
                
                const coursesTableBody = document.getElementById('coursesTableBody');
                coursesTableBody.innerHTML = '';
                
                if (coursesData) {
                    Object.keys(coursesData).forEach(key => {
                        const course = coursesData[key];
                        const row = document.createElement('tr');
                        
                        row.innerHTML = `
                            <td>${course.code}</td>
                            <td>${course.name}</td>
                            <td>${course.instructor}</td>
                            <td>${course.schedule}</td>
                            <td>${course.students}</td>
                            <td>
                                <div class="table-actions">
                                    <div class="action-icon view" data-action="view-course" data-id="${course.id}">
                                        <i class="fas fa-eye"></i>
                                    </div>
                                    <div class="action-icon edit" data-action="edit-course" data-id="${course.id}">
                                        <i class="fas fa-edit"></i>
                                    </div>
                                </div>
                            </td>
                        `;
                        
                        coursesTableBody.appendChild(row);
                    });
                }
            }).catch((error) => {
                console.error("Error loading courses data:", error);
            });
            
            // Load programs data from Firebase
            database.ref('programs').once('value').then((snapshot) => {
                const programsData = snapshot.val();
                const programsCount = programsData ? Object.keys(programsData).length : 0;
                document.getElementById('programsCount').textContent = programsCount;
            }).catch((error) => {
                console.error("Error loading programs data:", error);
            });
            
            // Load curriculum updates data from Firebase
            database.ref('curriculum').orderByChild('status').equalTo('pending').once('value').then((snapshot) => {
                const curriculumData = snapshot.val();
                const curriculumUpdatesCount = curriculumData ? Object.keys(curriculumData).length : 0;
                document.getElementById('curriculumUpdatesCount').textContent = curriculumUpdatesCount;
            }).catch((error) => {
                console.error("Error loading curriculum data:", error);
            });
            
            // Re-attach event listeners for new elements
            attachCardActionListeners();
            attachTableActionListeners();
            attachPaginationListeners();
        }

        // Load resources data
        function loadResourcesData() {
            contentBody.innerHTML = `
                <div class="dashboard-grid">
                    <div class="card" data-action="classrooms-details">
                        <div class="card-header">
                            <h3 class="card-title">Classrooms</h3>
                            <div class="card-icon blue">
                                <i class="fas fa-door-open"></i>
                            </div>
                        </div>
                        <div class="card-value" id="classroomsCount">0</div>
                        <div class="card-description">Total classrooms available</div>
                        <div class="card-action">
                            <span>View All</span>
                            <i class="fas fa-arrow-right"></i>
                        </div>
                    </div>
                    <div class="card" data-action="labs-details">
                        <div class="card-header">
                            <h3 class="card-title">Labs</h3>
                            <div class="card-icon yellow">
                                <i class="fas fa-flask"></i>
                            </div>
                        </div>
                        <div class="card-value" id="labsCount">0</div>
                        <div class="card-description">Laboratories available</div>
                        <div class="card-action">
                            <span>View All</span>
                            <i class="fas fa-arrow-right"></i>
                        </div>
                    </div>
                    <div class="card" data-action="equipment-details">
                        <div class="card-header">
                            <h3 class="card-title">Equipment</h3>
                            <div class="card-icon green">
                                <i class="fas fa-tools"></i>
                            </div>
                        </div>
                        <div class="card-value" id="equipmentCount">0</div>
                        <div class="card-description">Total equipment items</div>
                        <div class="card-action">
                            <span>View All</span>
                            <i class="fas fa-arrow-right"></i>
                        </div>
                    </div>
                    <div class="card" data-action="reservations-details">
                        <div class="card-header">
                            <h3 class="card-title">Reservations</h3>
                            <div class="card-icon blue">
                                <i class="fas fa-calendar-check"></i>
                            </div>
                        </div>
                        <div class="card-value" id="reservationsCount">0</div>
                        <div class="card-description">Pending resource reservations</div>
                        <div class="card-action">
                            <span>View All</span>
                            <i class="fas fa-arrow-right"></i>
                        </div>
                    </div>
                </div>
                
                <div class="table-container">
                    <div class="table-header">
                        <h3 class="table-title">Resource Allocation</h3>
                        <div class="search-filter">
                            <input type="text" class="search-input" placeholder="Search resources...">
                            <select class="filter-select">
                                <option>All Types</option>
                                <option>Classrooms</option>
                                <option>Labs</option>
                                <option>Equipment</option>
                            </select>
                        </div>
                    </div>
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Resource Name</th>
                                <th>Type</th>
                                <th>Assigned To</th>
                                <th>Due Date</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="resourcesTableBody">
                            <!-- Data will be loaded here -->
                        </tbody>
                    </table>
                    <div class="pagination">
                        <div class="page-btn" data-page="prev">
                            <i class="fas fa-chevron-left"></i>
                        </div>
                        <div class="page-btn active" data-page="1">1</div>
                        <div class="page-btn" data-page="2">2</div>
                        <div class="page-btn" data-page="3">3</div>
                        <div class="page-btn" data-page="next">
                            <i class="fas fa-chevron-right"></i>
                        </div>
                    </div>
                </div>
            `;
            
            // Load resources data from Firebase
            database.ref('resources').once('value').then((snapshot) => {
                const resourcesData = snapshot.val();
                
                if (resourcesData) {
                    // Count classrooms
                    const classroomsData = resourcesData.classrooms || {};
                    const classroomsCount = Object.keys(classroomsData).length;
                    document.getElementById('classroomsCount').textContent = classroomsCount;
                    
                    // Count labs
                    const labsData = resourcesData.labs || {};
                    const labsCount = Object.keys(labsData).length;
                    document.getElementById('labsCount').textContent = labsCount;
                    
                    // Count equipment
                    const equipmentData = resourcesData.equipment || {};
                    const equipmentCount = Object.keys(equipmentData).length;
                    document.getElementById('equipmentCount').textContent = equipmentCount;
                    
                    // Count reservations
                    const reservationsData = resourcesData.reservations || {};
                    const reservationsCount = Object.keys(reservationsData).length;
                    document.getElementById('reservationsCount').textContent = reservationsCount;
                    
                    // Load resources table
                    const resourcesTableBody = document.getElementById('resourcesTableBody');
                    resourcesTableBody.innerHTML = '';
                    
                    // Combine all resources
                    const allResources = [];
                    
                    Object.keys(classroomsData).forEach(key => {
                        allResources.push({
                            id: key,
                            name: classroomsData[key].name,
                            type: 'Classroom',
                            assignedTo: classroomsData[key].assignedTo || '',
                            dueDate: classroomsData[key].dueDate || '',
                            status: classroomsData[key].status || 'available'
                        });
                    });
                    
                    Object.keys(labsData).forEach(key => {
                        allResources.push({
                            id: key,
                            name: labsData[key].name,
                            type: 'Lab',
                            assignedTo: labsData[key].assignedTo || '',
                            dueDate: labsData[key].dueDate || '',
                            status: labsData[key].status || 'available'
                        });
                    });
                    
                    Object.keys(equipmentData).forEach(key => {
                        allResources.push({
                            id: key,
                            name: equipmentData[key].name,
                            type: 'Equipment',
                            assignedTo: equipmentData[key].assignedTo || '',
                            dueDate: equipmentData[key].dueDate || '',
                            status: equipmentData[key].status || 'available'
                        });
                    });
                    
                    // Display resources
                    allResources.forEach(resource => {
                        const row = document.createElement('tr');
                        
                        row.innerHTML = `
                            <td>${resource.id}</td>
                            <td>${resource.name}</td>
                            <td>${resource.type}</td>
                            <td>${resource.assignedTo}</td>
                            <td>${resource.dueDate}</td>
                            <td><span class="status-badge ${resource.status}">${resource.status}</span></td>
                            <td>
                                <div class="table-actions">
                                    <div class="action-icon view" data-action="view-resource" data-id="${resource.id}">
                                        <i class="fas fa-eye"></i>
                                    </div>
                                    <div class="action-icon edit" data-action="edit-resource" data-id="${resource.id}">
                                        <i class="fas fa-edit"></i>
                                    </div>
                                    <div class="action-icon delete" data-action="delete-resource" data-id="${resource.id}">
                                        <i class="fas fa-trash"></i>
                                    </div>
                                </div>
                            </td>
                        `;
                        
                        resourcesTableBody.appendChild(row);
                    });
                }
            }).catch((error) => {
                console.error("Error loading resources data:", error);
            });
            
            // Re-attach event listeners for new elements
            attachCardActionListeners();
            attachTableActionListeners();
            attachPaginationListeners();
        }

        // Load budget data
        function loadBudgetData() {
            contentBody.innerHTML = `
                <div class="dashboard-grid">
                    <div class="card" data-action="total-budget-details">
                        <div class="card-header">
                            <h3 class="card-title">Total Budget</h3>
                            <div class="card-icon blue">
                                <i class="fas fa-dollar-sign"></i>
                            </div>
                        </div>
                        <div class="card-value" id="totalBudgetValue">$0</div>
                        <div class="card-description">Annual department budget</div>
                        <div class="card-action">
                            <span>View Details</span>
                            <i class="fas fa-arrow-right"></i>
                        </div>
                    </div>
                    <div class="card" data-action="utilized-budget-details">
                        <div class="card-header">
                            <h3 class="card-title">Utilized</h3>
                            <div class="card-icon yellow">
                                <i class="fas fa-chart-pie"></i>
                            </div>
                        </div>
                        <div class="card-value" id="utilizedBudgetValue">$0</div>
                        <div class="card-description">Of the total budget</div>
                        <div class="card-action">
                            <span>View Details</span>
                            <i class="fas fa-arrow-right"></i>
                        </div>
                    </div>
                    <div class="card" data-action="remaining-budget-details">
                        <div class="card-header">
                            <h3 class="card-title">Remaining</h3>
                            <div class="card-icon green">
                                <i class="fas fa-wallet"></i>
                            </div>
                        </div>
                        <div class="card-value" id="remainingBudgetValue">$0</div>
                        <div class="card-description">Available for allocation</div>
                        <div class="card-action">
                            <span>View Details</span>
                            <i class="fas fa-arrow-right"></i>
                        </div>
                    </div>
                </div>
                
                <div class="chart-container">
                    <div class="chart-header">
                        <h3 class="chart-title">Budget Allocation</h3>
                        <div class="chart-options">
                            <div class="chart-option active" data-period="current">Current Year</div>
                            <div class="chart-option" data-period="previous">Previous Year</div>
                        </div>
                    </div>
                    <canvas id="budgetChart"></canvas>
                </div>
                
                <div class="table-container">
                    <div class="table-header">
                        <h3 class="table-title">Recent Expenses</h3>
                        <div class="search-filter">
                            <input type="text" class="search-input" placeholder="Search expenses...">
                            <select class="filter-select">
                                <option>All Categories</option>
                                <option>Equipment</option>
                                <option>Travel</option>
                                <option>Supplies</option>
                                <option>Maintenance</option>
                            </select>
                        </div>
                    </div>
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Description</th>
                                <th>Category</th>
                                <th>Amount</th>
                                <th>Date</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="expensesTableBody">
                            <!-- Data will be loaded here -->
                        </tbody>
                    </table>
                    <div class="pagination">
                        <div class="page-btn" data-page="prev">
                            <i class="fas fa-chevron-left"></i>
                        </div>
                        <div class="page-btn active" data-page="1">1</div>
                        <div class="page-btn" data-page="2">2</div>
                        <div class="page-btn" data-page="3">3</div>
                        <div class="page-btn" data-page="next">
                            <i class="fas fa-chevron-right"></i>
                        </div>
                    </div>
                </div>
            `;
            
            // Load budget data from Firebase
            database.ref('budget').once('value').then((snapshot) => {
                const budgetData = snapshot.val();
                
                if (budgetData) {
                    const totalBudget = budgetData.total || 0;
                    const utilizedBudget = budgetData.utilized || 0;
                    const remainingBudget = totalBudget - utilizedBudget;
                    
                    document.getElementById('totalBudgetValue').textContent = '$' + totalBudget.toLocaleString();
                    document.getElementById('utilizedBudgetValue').textContent = '$' + utilizedBudget.toLocaleString();
                    document.getElementById('remainingBudgetValue').textContent = '$' + remainingBudget.toLocaleString();
                    
                    // Load expenses data
                    const expensesTableBody = document.getElementById('expensesTableBody');
                    expensesTableBody.innerHTML = '';
                    
                    const expensesData = budgetData.expenses || {};
                    
                    Object.keys(expensesData).forEach(key => {
                        const expense = expensesData[key];
                        const row = document.createElement('tr');
                        
                        row.innerHTML = `
                            <td>${expense.id}</td>
                            <td>${expense.description}</td>
                            <td>${expense.category}</td>
                            <td>$${expense.amount}</td>
                            <td>${expense.date}</td>
                            <td><span class="status-badge ${expense.status}">${expense.status}</span></td>
                            <td>
                                <div class="table-actions">
                                    <div class="action-icon view" data-action="view-expense" data-id="${expense.id}">
                                        <i class="fas fa-eye"></i>
                                    </div>
                                    <div class="action-icon edit" data-action="edit-expense" data-id="${expense.id}">
                                        <i class="fas fa-edit"></i>
                                    </div>
                                    <div class="action-icon delete" data-action="delete-expense" data-id="${expense.id}">
                                        <i class="fas fa-trash"></i>
                                    </div>
                                </div>
                            </td>
                        `;
                        
                        expensesTableBody.appendChild(row);
                    });
                    
                    // Initialize budget chart
                    const budgetCtx = document.getElementById('budgetChart');
                    if (budgetCtx) {
                        new Chart(budgetCtx, {
                            type: 'doughnut',
                            data: {
                                labels: ['Equipment', 'Travel', 'Supplies', 'Maintenance', 'Salaries', 'Other'],
                                datasets: [{
                                    data: [
                                        budgetData.allocation?.equipment || 0,
                                        budgetData.allocation?.travel || 0,
                                        budgetData.allocation?.supplies || 0,
                                        budgetData.allocation?.maintenance || 0,
                                        budgetData.allocation?.salaries || 0,
                                        budgetData.allocation?.other || 0
                                    ],
                                    backgroundColor: [
                                        'rgba(59, 130, 246, 0.8)',
                                        'rgba(245, 158, 11, 0.8)',
                                        'rgba(16, 185, 129, 0.8)',
                                        'rgba(139, 92, 246, 0.8)',
                                        'rgba(236, 72, 153, 0.8)',
                                        'rgba(107, 114, 128, 0.8)'
                                    ],
                                    borderColor: 'rgba(10, 25, 47, 0.8)',
                                    borderWidth: 2
                                }]
                            },
                            options: {
                                responsive: true,
                                maintainAspectRatio: false,
                                plugins: {
                                    legend: {
                                        position: 'right',
                                        labels: {
                                            color: '#FFFFFF',
                                            font: {
                                                size: 12
                                            }
                                        }
                                    }
                                }
                            }
                        });
                    }
                }
            }).catch((error) => {
                console.error("Error loading budget data:", error);
            });
            
            // Re-attach event listeners for new elements
            attachCardActionListeners();
            attachTableActionListeners();
            attachPaginationListeners();
            attachChartOptionListeners();
        }

        // Load messages data
        function loadMessagesData() {
            contentBody.innerHTML = `
                <div class="table-container">
                    <div class="table-header">
                        <h3 class="table-title">Messages</h3>
                        <div class="search-filter">
                            <input type="text" class="search-input" placeholder="Search messages...">
                            <select class="filter-select">
                                <option>All Messages</option>
                                <option>Unread</option>
                                <option>Important</option>
                            </select>
                        </div>
                    </div>
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>From</th>
                                <th>Subject</th>
                                <th>Date</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="messagesTableBody">
                            <!-- Data will be loaded here -->
                        </tbody>
                    </table>
                    <div class="pagination">
                        <div class="page-btn" data-page="prev">
                            <i class="fas fa-chevron-left"></i>
                        </div>
                        <div class="page-btn active" data-page="1">1</div>
                        <div class="page-btn" data-page="2">2</div>
                        <div class="page-btn" data-page="3">3</div>
                        <div class="page-btn" data-page="next">
                            <i class="fas fa-chevron-right"></i>
                        </div>
                    </div>
                </div>
            `;
            
            // Load messages data from Firebase
            const messagesTableBody = document.getElementById('messagesTableBody');
            messagesTableBody.innerHTML = '';

            database.ref('messages').orderByChild('date').limitToLast(10).once('value').then((snapshot) => {
                const messagesData = snapshot.val();
                
                if (messagesData) {
                    Object.keys(messagesData).forEach(key => {
                        const message = messagesData[key];
                        const row = document.createElement('tr');
                        
                        row.innerHTML = `
                            <td>${message.sender}</td>
                            <td>${message.subject}</td>
                            <td>${message.date}</td>
                            <td><span class="status-badge ${message.status}">${message.status}</span></td>
                            <td>
                                <div class="table-actions">
                                    <div class="action-icon view" data-action="view-message" data-id="${message.id}">
                                        <i class="fas fa-eye"></i>
                                    </div>
                                    <div class="action-icon delete" data-action="delete-message" data-id="${message.id}">
                                        <i class="fas fa-trash"></i>
                                    </div>
                                </div>
                            </td>
                        `;
                        
                        messagesTableBody.appendChild(row);
                    });
                }
            }).catch((error) => {
                console.error("Error loading messages data:", error);
            });
            
            // Re-attach event listeners for new elements
            attachTableActionListeners();
            attachPaginationListeners();
        }

        // Load meetings data
        function loadMeetingsData() {
            contentBody.innerHTML = `
                <div class="dashboard-grid">
                    <div class="card" data-action="upcoming-meetings">
                        <div class="card-header">
                            <h3 class="card-title">Upcoming Meetings</h3>
                            <div class="card-icon blue">
                                <i class="fas fa-calendar-alt"></i>
                            </div>
                        </div>
                        <div class="card-value" id="upcomingMeetingsCount">0</div>
                        <div class="card-description">Meetings this week</div>
                        <div class="card-action">
                            <span>View All</span>
                            <i class="fas fa-arrow-right"></i>
                        </div>
                    </div>
                    <div class="card" data-action="meeting-rooms">
                        <div class="card-header">
                            <h3 class="card-title">Meeting Rooms</h3>
                            <div class="card-icon yellow">
                                <i class="fas fa-door-closed"></i>
                            </div>
                        </div>
                        <div class="card-value" id="meetingRoomsCount">0</div>
                        <div class="card-description">Available today</div>
                        <div class="card-action">
                            <span>View All</span>
                            <i class="fas fa-arrow-right"></i>
                        </div>
                    </div>
                </div>
                
                <div class="table-container">
                    <div class="table-header">
                        <h3 class="table-title">Meeting Schedule</h3>
                        <div class="search-filter">
                            <input type="text" class="search-input" placeholder="Search meetings...">
                            <select class="filter-select">
                                <option>All Meetings</option>
                                <option>Today</option>
                                <option>This Week</option>
                                <option>This Month</option>
                            </select>
                        </div>
                    </div>
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Title</th>
                                <th>Date & Time</th>
                                <th>Location</th>
                                <th>Organizer</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="meetingsTableBody">
                            <!-- Data will be loaded here -->
                        </tbody>
                    </table>
                    <div class="pagination">
                        <div class="page-btn" data-page="prev">
                            <i class="fas fa-chevron-left"></i>
                        </div>
                        <div class="page-btn active" data-page="1">1</div>
                        <div class="page-btn" data-page="2">2</div>
                        <div class="page-btn" data-page="3">3</div>
                        <div class="page-btn" data-page="next">
                            <i class="fas fa-chevron-right"></i>
                        </div>
                    </div>
                </div>
            `;
            
            // Load meetings data from Firebase
            database.ref('meetings').once('value').then((snapshot) => {
                const meetingsData = snapshot.val();
                
                if (meetingsData) {
                    // Count upcoming meetings
                    const upcomingMeetings = Object.values(meetingsData).filter(meeting => 
                        meeting.status === 'upcoming' || meeting.status === 'scheduled'
                    );
                    document.getElementById('upcomingMeetingsCount').textContent = upcomingMeetings.length;
                    
                    // Load meetings table
                    const meetingsTableBody = document.getElementById('meetingsTableBody');
                    meetingsTableBody.innerHTML = '';
                    
                    Object.keys(meetingsData).forEach(key => {
                        const meeting = meetingsData[key];
                        const row = document.createElement('tr');
                        
                        row.innerHTML = `
                            <td>${meeting.title}</td>
                            <td>${meeting.datetime}</td>
                            <td>${meeting.location}</td>
                            <td>${meeting.organizer}</td>
                            <td><span class="status-badge ${meeting.status}">${meeting.status}</span></td>
                            <td>
                                <div class="table-actions">
                                    <div class="action-icon view" data-action="view-meeting" data-id="${meeting.id}">
                                        <i class="fas fa-eye"></i>
                                    </div>
                                    <div class="action-icon edit" data-action="edit-meeting" data-id="${meeting.id}">
                                        <i class="fas fa-edit"></i>
                                    </div>
                                    <div class="action-icon delete" data-action="delete-meeting" data-id="${meeting.id}">
                                        <i class="fas fa-trash"></i>
                                    </div>
                                </div>
                            </td>
                        `;
                        
                        meetingsTableBody.appendChild(row);
                    });
                }
            }).catch((error) => {
                console.error("Error loading meetings data:", error);
            });
            
            // Load meeting rooms data from Firebase
            database.ref('resources/meetingRooms').once('value').then((snapshot) => {
                const meetingRoomsData = snapshot.val();
                const meetingRoomsCount = meetingRoomsData ? Object.keys(meetingRoomsData).length : 0;
                document.getElementById('meetingRoomsCount').textContent = meetingRoomsCount;
            }).catch((error) => {
                console.error("Error loading meeting rooms data:", error);
            });
            
            // Re-attach event listeners for new elements
            attachCardActionListeners();
            attachTableActionListeners();
            attachPaginationListeners();
        }

        // Load announcements data
        function loadAnnouncementsData() {
            contentBody.innerHTML = `
                <div class="header-actions" style="margin-bottom: 1.5rem;">
                    <button class="btn btn-primary" id="newAnnouncementBtn">
                        <i class="fas fa-plus"></i>
                        New Announcement
                    </button>
                </div>
                
                <div class="table-container">
                    <div class="table-header">
                        <h3 class="table-title">Announcements</h3>
                        <div class="search-filter">
                            <input type="text" class="search-input" placeholder="Search announcements...">
                            <select class="filter-select">
                                <option>All Announcements</option>
                                <option>Active</option>
                                <option>Expired</option>
                            </select>
                        </div>
                    </div>
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Title</th>
                                <th>Content</th>
                                <th>Posted By</th>
                                <th>Date</th>
                                <th>Expiry</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="announcementsTableBody">
                            <!-- Data will be loaded here -->
                        </tbody>
                    </table>
                    <div class="pagination">
                        <div class="page-btn" data-page="prev">
                            <i class="fas fa-chevron-left"></i>
                        </div>
                        <div class="page-btn active" data-page="1">1</div>
                        <div class="page-btn" data-page="2">2</div>
                        <div class="page-btn" data-page="3">3</div>
                        <div class="page-btn" data-page="next">
                            <i class="fas fa-chevron-right"></i>
                        </div>
                    </div>
                </div>
            `;
            
            // Add event listener for new announcement button
            const newAnnouncementBtn = document.getElementById('newAnnouncementBtn');
            if (newAnnouncementBtn) {
                newAnnouncementBtn.addEventListener('click', () => {
                    openModal('announcement');
                });
            }
            
            // Load announcements data from Firebase
            const announcementsTableBody = document.getElementById('announcementsTableBody');
            announcementsTableBody.innerHTML = '';

            database.ref('announcements').orderByChild('date').limitToLast(10).once('value').then((snapshot) => {
                const announcementsData = snapshot.val();
                
                if (announcementsData) {
                    Object.keys(announcementsData).forEach(key => {
                        const announcement = announcementsData[key];
                        const row = document.createElement('tr');
                        
                        row.innerHTML = `
                            <td>${announcement.title}</td>
                            <td>${announcement.content}</td>
                            <td>${announcement.postedBy}</td>
                            <td>${announcement.date}</td>
                            <td>${announcement.expiry}</td>
                            <td><span class="status-badge ${announcement.status}">${announcement.status}</span></td>
                            <td>
                                <div class="table-actions">
                                    <div class="action-icon view" data-action="view-announcement" data-id="${announcement.id}">
                                        <i class="fas fa-eye"></i>
                                    </div>
                                    <div class="action-icon edit" data-action="edit-announcement" data-id="${announcement.id}">
                                        <i class="fas fa-edit"></i>
                                    </div>
                                    <div class="action-icon delete" data-action="delete-announcement" data-id="${announcement.id}">
                                        <i class="fas fa-trash"></i>
                                    </div>
                                </div>
                            </td>
                        `;
                        
                        announcementsTableBody.appendChild(row);
                    });
                }
            }).catch((error) => {
                console.error("Error loading announcements data:", error);
            });
            
            // Re-attach event listeners for new elements
            attachTableActionListeners();
            attachPaginationListeners();
        }

        // Load reports data
        function loadReportsData() {
            contentBody.innerHTML = `
                <div class="dashboard-grid">
                    <div class="card" data-action="faculty-reports">
                        <div class="card-header">
                            <h3 class="card-title">Faculty Reports</h3>
                            <div class="card-icon blue">
                                <i class="fas fa-users"></i>
                            </div>
                        </div>
                        <div class="card-value" id="facultyReportsCount">0</div>
                        <div class="card-description">Faculty performance reports</div>
                        <div class="card-action">
                            <span>View All</span>
                            <i class="fas fa-arrow-right"></i>
                        </div>
                    </div>
                    <div class="card" data-action="student-reports">
                        <div class="card-header">
                            <h3 class="card-title">Student Reports</h3>
                            <div class="card-icon yellow">
                                <i class="fas fa-user-graduate"></i>
                            </div>
                        </div>
                        <div class="card-value" id="studentReportsCount">0</div>
                        <div class="card-description">Student performance reports</div>
                        <div class="card-action">
                            <span>View All</span>
                            <i class="fas fa-arrow-right"></i>
                        </div>
                    </div>
                    <div class="card" data-action="course-reports">
                        <div class="card-header">
                            <h3 class="card-title">Course Reports</h3>
                            <div class="card-icon green">
                                <i class="fas fa-book"></i>
                            </div>
                        </div>
                        <div class="card-value" id="courseReportsCount">0</div>
                        <div class="card-description">Course evaluation reports</div>
                        <div class="card-action">
                            <span>View All</span>
                            <i class="fas fa-arrow-right"></i>
                        </div>
                    </div>
                </div>
                
                <div class="table-container">
                    <div class="table-header">
                        <h3 class="table-title">Generated Reports</h3>
                        <div class="search-filter">
                            <input type="text" class="search-input" placeholder="Search reports...">
                            <select class="filter-select">
                                <option>All Types</option>
                                <option>Faculty</option>
                                <option>Student</option>
                                <option>Course</option>
                                <option>Department</option>
                            </select>
                        </div>
                    </div>
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Report ID</th>
                                <th>Title</th>
                                <th>Type</th>
                                <th>Generated By</th>
                                <th>Date</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="reportsTableBody">
                            <!-- Data will be loaded here -->
                        </tbody>
                    </table>
                    <div class="pagination">
                        <div class="page-btn" data-page="prev">
                            <i class="fas fa-chevron-left"></i>
                        </div>
                        <div class="page-btn active" data-page="1">1</div>
                        <div class="page-btn" data-page="2">2</div>
                        <div class="page-btn" data-page="3">3</div>
                        <div class="page-btn" data-page="next">
                            <i class="fas fa-chevron-right"></i>
                        </div>
                    </div>
                </div>
            `;
            
            // Load reports data from Firebase
            database.ref('reports').once('value').then((snapshot) => {
                const reportsData = snapshot.val();
                
                if (reportsData) {
                    // Count faculty reports
                    const facultyReports = Object.values(reportsData).filter(report => report.type === 'faculty');
                    document.getElementById('facultyReportsCount').textContent = facultyReports.length;
                    
                    // Count student reports
                    const studentReports = Object.values(reportsData).filter(report => report.type === 'student');
                    document.getElementById('studentReportsCount').textContent = studentReports.length;
                    
                    // Count course reports
                    const courseReports = Object.values(reportsData).filter(report => report.type === 'course');
                    document.getElementById('courseReportsCount').textContent = courseReports.length;
                    
                    // Load reports table
                    const reportsTableBody = document.getElementById('reportsTableBody');
                    reportsTableBody.innerHTML = '';
                    
                    Object.keys(reportsData).forEach(key => {
                        const report = reportsData[key];
                        const row = document.createElement('tr');
                        
                        row.innerHTML = `
                            <td>${report.id}</td>
                            <td>${report.title}</td>
                            <td>${report.type}</td>
                            <td>${report.generatedBy}</td>
                            <td>${report.date}</td>
                            <td>
                                <div class="table-actions">
                                    <div class="action-icon view" data-action="view-report" data-id="${report.id}">
                                        <i class="fas fa-eye"></i>
                                    </div>
                                    <div class="action-icon edit" data-action="edit-report" data-id="${report.id}">
                                        <i class="fas fa-edit"></i>
                                    </div>
                                    <div class="action-icon delete" data-action="delete-report" data-id="${report.id}">
                                        <i class="fas fa-trash"></i>
                                    </div>
                                </div>
                            </td>
                        `;
                        
                        reportsTableBody.appendChild(row);
                    });
                }
            }).catch((error) => {
                console.error("Error loading reports data:", error);
            });
            
            // Re-attach event listeners for new elements
            attachCardActionListeners();
            attachTableActionListeners();
            attachPaginationListeners();
        }

        // Load analytics data
        function loadAnalyticsData() {
            contentBody.innerHTML = `
                <div class="chart-container">
                    <div class="chart-header">
                        <h3 class="chart-title">Department Performance Trends</h3>
                        <div class="chart-options">
                            <div class="chart-option active" data-period="semester">Semester</div>
                            <div class="chart-option" data-period="year">Year</div>
                        </div>
                    </div>
                    <canvas id="trendsChart"></canvas>
                </div>
                
                <div class="dashboard-grid">
                    <div class="card" data-action="satisfaction-details">
                        <div class="card-header">
                            <h3 class="card-title">Student Satisfaction</h3>
                            <div class="card-icon blue">
                                <i class="fas fa-smile"></i>
                            </div>
                        </div>
                        <div class="card-value" id="studentSatisfaction">0%</div>
                        <div class="card-description">Overall satisfaction rate</div>
                        <div class="card-action">
                            <span>View Details</span>
                            <i class="fas fa-arrow-right"></i>
                        </div>
                    </div>
                    <div class="card" data-action="utilization-details">
                        <div class="card-header">
                            <h3 class="card-title">Faculty Utilization</h3>
                            <div class="card-icon yellow">
                                <i class="fas fa-user-clock"></i>
                            </div>
                        </div>
                        <div class="card-value" id="facultyUtilization">0%</div>
                        <div class="card-description">Average faculty utilization</div>
                        <div class="card-action">
                            <span>View Details</span>
                            <i class="fas fa-arrow-right"></i>
                        </div>
                    </div>
                    <div class="card" data-action="efficiency-details">
                        <div class="card-header">
                            <h3 class="card-title">Resource Efficiency</h3>
                            <div class="card-icon green">
                                <i class="fas fa-tachometer-alt"></i>
                            </div>
                        </div>
                        <div class="card-value" id="resourceEfficiency">0%</div>
                        <div class="card-description">Resource utilization efficiency</div>
                        <div class="card-action">
                            <span>View Details</span>
                            <i class="fas fa-arrow-right"></i>
                        </div>
                    </div>
                </div>
                
                <div class="chart-container">
                    <div class="chart-header">
                        <h3 class="chart-title">Course Performance</h3>
                        <div class="chart-options">
                            <div class="chart-option active" data-period="current">Current Semester</div>
                            <div class="chart-option" data-period="previous">Previous Semester</div>
                        </div>
                    </div>
                    <canvas id="courseChart"></canvas>
                </div>
            `;
            
            // Load analytics data from Firebase
            database.ref('analytics').once('value').then((snapshot) => {
                const analyticsData = snapshot.val();
                
                if (analyticsData) {
                    // Update metrics
                    document.getElementById('studentSatisfaction').textContent = (analyticsData.studentSatisfaction || 0) + '%';
                    document.getElementById('facultyUtilization').textContent = (analyticsData.facultyUtilization || 0) + '%';
                    document.getElementById('resourceEfficiency').textContent = (analyticsData.resourceEfficiency || 0) + '%';
                    
                    // Initialize trends chart
                    const trendsCtx = document.getElementById('trendsChart');
                    if (trendsCtx) {
                        new Chart(trendsCtx, {
                            type: 'line',
                            data: {
                                labels: analyticsData.trends?.labels || ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep'],
                                datasets: [{
                                    label: 'Student Performance',
                                    data: analyticsData.trends?.studentPerformance || [82, 84, 83, 85, 87, 86, 88, 89, 90],
                                    borderColor: 'rgba(59, 130, 246, 1)',
                                    backgroundColor: 'rgba(59, 130, 246, 0.1)',
                                    tension: 0.4,
                                    fill: true
                                }, {
                                    label: 'Faculty Performance',
                                    data: analyticsData.trends?.facultyPerformance || [85, 86, 85, 87, 88, 89, 90, 91, 92],
                                    borderColor: 'rgba(245, 158, 11, 1)',
                                    backgroundColor: 'rgba(245, 158, 11, 0.1)',
                                    tension: 0.4,
                                    fill: true
                                }]
                            },
                            options: {
                                responsive: true,
                                maintainAspectRatio: false,
                                plugins: {
                                    legend: {
                                        labels: {
                                            color: '#FFFFFF'
                                        }
                                    }
                                },
                                scales: {
                                    x: {
                                        grid: {
                                            color: 'rgba(255, 255, 255, 0.1)'
                                        },
                                        ticks: {
                                            color: '#FFFFFF'
                                        }
                                    },
                                    y: {
                                        grid: {
                                            color: 'rgba(255, 255, 255, 0.1)'
                                        },
                                        ticks: {
                                            color: '#FFFFFF'
                                        }
                                    }
                                }
                            }
                        });
                    }
                    
                    // Initialize course chart
                    const courseCtx = document.getElementById('courseChart');
                    if (courseCtx) {
                        new Chart(courseCtx, {
                            type: 'bar',
                            data: {
                                labels: analyticsData.courses?.labels || ['CS101', 'CS201', 'CS301', 'CS401', 'CS501', 'CS601'],
                                datasets: [{
                                    label: 'Pass Rate',
                                    data: analyticsData.courses?.passRate || [92, 88, 85, 90, 87, 91],
                                    backgroundColor: 'rgba(59, 130, 246, 0.8)',
                                    borderColor: 'rgba(59, 130, 246, 1)',
                                    borderWidth: 1
                                }, {
                                    label: 'Average Grade',
                                    data: analyticsData.courses?.averageGrade || [85, 82, 80, 84, 81, 86],
                                    backgroundColor: 'rgba(245, 158, 11, 0.8)',
                                    borderColor: 'rgba(245, 158, 11, 1)',
                                    borderWidth: 1
                                }]
                            },
                            options: {
                                responsive: true,
                                maintainAspectRatio: false,
                                plugins: {
                                    legend: {
                                        labels: {
                                            color: '#FFFFFF'
                                        }
                                    }
                                },
                                scales: {
                                    x: {
                                        grid: {
                                            color: 'rgba(255, 255, 255, 0.1)'
                                        },
                                        ticks: {
                                            color: '#FFFFFF'
                                        }
                                    },
                                    y: {
                                        grid: {
                                            color: 'rgba(255, 255, 255, 0.1)'
                                        },
                                        ticks: {
                                            color: '#FFFFFF'
                                        }
                                    }
                                }
                            }
                        });
                    }
                }
            }).catch((error) => {
                console.error("Error loading analytics data:", error);
            });
            
            // Re-attach event listeners for new elements
            attachCardActionListeners();
            attachChartOptionListeners();
        }

        // Initialize performance chart
        function initializeChart() {
            const ctx = document.getElementById('performanceChart');
            if (ctx) {
                performanceChart = new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun'],
                        datasets: [{
                            label: 'Department Performance',
                            data: [80, 85, 82, 88, 90, 92],
                            borderColor: 'rgba(245, 158, 11, 1)',
                            backgroundColor: 'rgba(245, 158, 11, 0.1)',
                            tension: 0.4,
                            fill: true
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                labels: {
                                    color: '#FFFFFF'
                                }
                            }
                        },
                        scales: {
                            x: {
                                grid: {
                                    color: 'rgba(255, 255, 255, 0.1)'
                                },
                                ticks: {
                                    color: '#FFFFFF'
                                }
                            },
                            y: {
                                grid: {
                                    color: 'rgba(255, 255, 255, 0.1)'
                                },
                                ticks: {
                                    color: '#FFFFFF'
                                }
                            }
                        }
                    }
                });
            }
        }

        // Open chat
        function openChat(contact) {
            currentChat = contact;
            contentBody.style.display = 'none';
            chatContainer.style.display = 'flex';
            
            // Load messages
            loadMessages();
        }

        // Load messages
        function loadMessages() {
            // Clear existing messages
            messagesContainer.innerHTML = '';
            chatMessages = [];
            
            // Load messages from Firebase
            database.ref('chatMessages/' + currentChat).orderByChild('timestamp').once('value').then((snapshot) => {
                const messagesData = snapshot.val();
                
                if (messagesData) {
                    Object.keys(messagesData).forEach(key => {
                        const message = messagesData[key];
                        addMessageToChat(message);
                    });
                }
            }).catch((error) => {
                console.error("Error loading messages:", error);
            });
            
            // Set up real-time listener for new messages
            database.ref('chatMessages/' + currentChat).on('child_added', (snapshot) => {
                const message = snapshot.val();
                
                // Check if message is already in chat
                const existingMessage = chatMessages.find(msg => msg.id === message.id);
                if (!existingMessage) {
                    addMessageToChat(message);
                }
            });
        }

        // Add message to chat
        function addMessageToChat(message) {
            chatMessages.push(message);
            
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${message.sender === currentUser.name ? 'sent' : 'received'}`;
            messageDiv.setAttribute('data-id', message.id);
            
            const senderDiv = document.createElement('div');
            senderDiv.className = 'message-sender';
            senderDiv.textContent = message.sender === currentUser.name ? 'You' : message.sender;
            
            const bubbleDiv = document.createElement('div');
            bubbleDiv.className = 'message-bubble';
            bubbleDiv.textContent = message.text;
            
            const metaDiv = document.createElement('div');
            metaDiv.className = 'message-meta';
            
            const timeSpan = document.createElement('span');
            timeSpan.textContent = message.time;
            
            const statusDiv = document.createElement('div');
            statusDiv.className = 'message-status';
            
            if (message.sender === currentUser.name) {
                if (message.status === 'sent') {
                    statusDiv.innerHTML = '<i class="fas fa-check sent"></i>';
                } else if (message.status === 'delivered') {
                    statusDiv.innerHTML = '<i class="fas fa-check-double delivered"></i>';
                } else if (message.status === 'seen') {
                    statusDiv.innerHTML = '<i class="fas fa-check-double seen"></i>';
                }
            }
            
            const encryptionDiv = document.createElement('div');
            encryptionDiv.className = 'encryption-indicator';
            encryptionDiv.innerHTML = '<i class="fas fa-lock"></i> <span>Encrypted</span>';
            
            metaDiv.appendChild(timeSpan);
            if (message.sender === currentUser.name) {
                metaDiv.appendChild(statusDiv);
            }
            metaDiv.appendChild(encryptionDiv);
            
            messageDiv.appendChild(senderDiv);
            messageDiv.appendChild(bubbleDiv);
            messageDiv.appendChild(metaDiv);
            
            messagesContainer.appendChild(messageDiv);
            
            // Scroll to bottom
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
        }

        // Send message
        function sendMessage() {
            const text = messageInput.value.trim();
            if (!text) return;
            
            const now = new Date();
            const time = now.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
            const messageId = 'msg_' + Date.now();
            const timestamp = now.getTime();
            
            // Create message object
            const message = {
                id: messageId,
                sender: currentUser.name,
                text: text,
                time: time,
                timestamp: timestamp,
                status: 'sent',
                room: currentChat
            };
            
            // Add to chat
            addMessageToChat(message);
            
            // Clear input
            messageInput.value = '';
            
            // Save to Firebase
            database.ref('chatMessages/' + currentChat + '/' + messageId).set(message).then(() => {
                // Update status to delivered
                updateMessageStatus(messageId, 'delivered');
                
                // Send via socket.io for real-time updates
                socket.emit('message', {
                    id: messageId,
                    sender: currentUser.name,
                    text: text,
                    time: time,
                    room: currentChat
                });
                
                // If recipient is in chat, mark as seen
                setTimeout(() => {
                    updateMessageStatus(messageId, 'seen');
                    socket.emit('message-status', {
                        messageId: messageId,
                        status: 'seen',
                        room: currentChat
                    });
                }, 1500);
            }).catch((error) => {
                console.error("Error saving message:", error);
            });
        }

        // Receive message
        function receiveMessage(data) {
            const message = {
                id: data.id,
                sender: data.sender,
                text: data.text,
                time: data.time,
                timestamp: Date.now(),
                status: 'delivered'
            };
            
            addMessageToChat(message);
            
            // Mark as seen if user is in chat
            setTimeout(() => {
                updateMessageStatus(data.id, 'seen');
                socket.emit('message-status', {
                    messageId: data.id,
                    status: 'seen',
                    room: currentChat
                });
            }, 1000);
        }

        // Update message status
        function updateMessageStatus(messageId, status) {
            const messageElement = document.querySelector(`.message[data-id="${messageId}"]`);
            if (!messageElement) return;
            
            const statusElement = messageElement.querySelector('.message-status');
            if (!statusElement) return;
            
            if (status === 'sent') {
                statusElement.innerHTML = '<i class="fas fa-check sent"></i>';
            } else if (status === 'delivered') {
                statusElement.innerHTML = '<i class="fas fa-check-double delivered"></i>';
            } else if (status === 'seen') {
                statusElement.innerHTML = '<i class="fas fa-check-double seen"></i>';
            }
            
            // Update message in Firebase
            database.ref('chatMessages/' + currentChat + '/' + messageId).update({
                status: status
            }).catch((error) => {
                console.error("Error updating message status:", error);
            });
            
            // Update message in array
            const message = chatMessages.find(msg => msg.id === messageId);
            if (message) {
                message.status = status;
            }
        }

        // Open modal
        function openModal(type = 'request') {
            const modalTitle = document.getElementById('modalTitle');
            
            if (type === 'announcement') {
                modalTitle.textContent = 'New Announcement';
            } else {
                modalTitle.textContent = 'New Request';
            }
            
            formModal.classList.add('active');
        }

        // Close modal
        function closeModal() {
            formModal.classList.remove('active');
            modalForm.reset();
        }

        // Submit form
        function submitForm() {
            const formData = {
                type: document.getElementById('requestType').value,
                title: document.getElementById('requestTitle').value,
                description: document.getElementById('requestDescription').value,
                amount: document.getElementById('requestAmount').value,
                requestedBy: currentUser.name,
                date: new Date().toISOString().split('T')[0],
                status: 'pending'
            };
            
            // Save to Firebase
            const newApprovalRef = database.ref('approvals').push();
            const approvalId = newApprovalRef.key;
            
            newApprovalRef.set({
                id: approvalId,
                ...formData
            }).then(() => {
                closeModal();
                showNotification('success', 'Submitted', 'Your request has been submitted successfully.');
                
                // Refresh current page
                loadPage(currentPage);
            }).catch((error) => {
                console.error("Error submitting form:", error);
                showNotification('error', 'Error', 'Failed to submit your request. Please try again.');
            });
        }

        // Show notification
        function showNotification(type, title, message) {
            const notificationIcon = notificationToast.querySelector('.notification-icon');
            const notificationTitle = notificationToast.querySelector('.notification-title');
            const notificationMessage = notificationToast.querySelector('.notification-message');
            
            // Update notification content
            notificationTitle.textContent = title;
            notificationMessage.textContent = message;
            
            // Update notification icon and color
            notificationIcon.className = 'notification-icon ' + type;
            
            switch (type) {
                case 'success':
                    notificationIcon.innerHTML = '<i class="fas fa-check-circle"></i>';
                    break;
                case 'error':
                    notificationIcon.innerHTML = '<i class="fas fa-times-circle"></i>';
                    break;
                case 'warning':
                    notificationIcon.innerHTML = '<i class="fas fa-exclamation-circle"></i>';
                    break;
                case 'info':
                    notificationIcon.innerHTML = '<i class="fas fa-info-circle"></i>';
                    break;
            }
            
            // Show notification
            notificationToast.classList.add('show');
            
            // Auto hide after 5 seconds
            setTimeout(() => {
                notificationToast.classList.remove('show');
            }, 5000);
        }

        // Handle card actions
        function handleCardAction(action) {
            switch (action) {
                case 'faculty-details':
                    loadPage('faculty');
                    break;
                case 'student-details':
                    showNotification('info', 'Student Details', 'Loading student information...');
                    break;
                case 'course-details':
                    loadPage('academic');
                    break;
                case 'budget-details':
                    loadPage('budget');
                    break;
                case 'courses-details':
                    loadPage('academic');
                    break;
                case 'programs-details':
                    showNotification('info', 'Programs', 'Loading degree programs...');
                    break;
                case 'curriculum-details':
                    showNotification('info', 'Curriculum', 'Loading curriculum updates...');
                    break;
                case 'classrooms-details':
                    loadPage('resources');
                    break;
                case 'labs-details':
                    loadPage('resources');
                    break;
                case 'equipment-details':
                    loadPage('resources');
                    break;
                case 'reservations-details':
                    loadPage('resources');
                    break;
                case 'total-budget-details':
                    loadPage('budget');
                    break;
                case 'utilized-budget-details':
                    loadPage('budget');
                    break;
                case 'remaining-budget-details':
                    loadPage('budget');
                    break;
                case 'upcoming-meetings':
                    loadPage('meetings');
                    break;
                case 'meeting-rooms':
                    loadPage('resources');
                    break;
                case 'faculty-reports':
                    loadPage('reports');
                    break;
                case 'student-reports':
                    loadPage('reports');
                    break;
                case 'course-reports':
                    loadPage('reports');
                    break;
                case 'satisfaction-details':
                    showNotification('info', 'Student Satisfaction', 'Loading satisfaction metrics...');
                    break;
                case 'utilization-details':
                    showNotification('info', 'Faculty Utilization', 'Loading utilization metrics...');
                    break;
                case 'efficiency-details':
                    showNotification('info', 'Resource Efficiency', 'Loading efficiency metrics...');
                    break;
                default:
                    showNotification('info', 'Details', 'Loading details...');
            }
        }

        // Handle table actions
        function handleTableAction(action, id) {
            switch (action) {
                case 'view-request':
                    showNotification('info', 'Request Details', `Viewing request ${id}...`);
                    break;
                case 'edit-request':
                    openModal();
                    break;
                case 'delete-request':
                    // Delete from Firebase
                    database.ref('approvals/' + id).remove().then(() => {
                        showNotification('warning', 'Delete Request', `Request ${id} has been deleted.`);
                        loadPage(currentPage);
                    }).catch((error) => {
                        console.error("Error deleting request:", error);
                        showNotification('error', 'Error', 'Failed to delete request.');
                    });
                    break;
                case 'view-faculty':
                    showNotification('info', 'Faculty Details', `Viewing faculty member ${id}...`);
                    break;
                case 'edit-faculty':
                    showNotification('info', 'Edit Faculty', `Editing faculty member ${id}...`);
                    break;
                case 'delete-faculty':
                    // Delete from Firebase
                    database.ref('faculty/' + id).remove().then(() => {
                        showNotification('warning', 'Delete Faculty', `Faculty member ${id} has been deleted.`);
                        loadPage('faculty');
                    }).catch((error) => {
                        console.error("Error deleting faculty:", error);
                        showNotification('error', 'Error', 'Failed to delete faculty member.');
                    });
                    break;
                case 'view-course':
                    showNotification('info', 'Course Details', `Viewing course ${id}...`);
                    break;
                case 'edit-course':
                    showNotification('info', 'Edit Course', `Editing course ${id}...`);
                    break;
                case 'view-resource':
                    showNotification('info', 'Resource Details', `Viewing resource ${id}...`);
                    break;
                case 'edit-resource':
                    showNotification('info', 'Edit Resource', `Editing resource ${id}...`);
                    break;
                case 'delete-resource':
                    // Delete from Firebase
                    database.ref('resources/' + id).remove().then(() => {
                        showNotification('warning', 'Delete Resource', `Resource ${id} has been deleted.`);
                        loadPage('resources');
                    }).catch((error) => {
                        console.error("Error deleting resource:", error);
                        showNotification('error', 'Error', 'Failed to delete resource.');
                    });
                    break;
                case 'view-expense':
                    showNotification('info', 'Expense Details', `Viewing expense ${id}...`);
                    break;
                case 'edit-expense':
                    showNotification('info', 'Edit Expense', `Editing expense ${id}...`);
                    break;
                case 'delete-expense':
                    // Delete from Firebase
                    database.ref('budget/expenses/' + id).remove().then(() => {
                        showNotification('warning', 'Delete Expense', `Expense ${id} has been deleted.`);
                        loadPage('budget');
                    }).catch((error) => {
                        console.error("Error deleting expense:", error);
                        showNotification('error', 'Error', 'Failed to delete expense.');
                    });
                    break;
                case 'view-message':
                    showNotification('info', 'Message Details', `Viewing message ${id}...`);
                    break;
                case 'delete-message':
                    // Delete from Firebase
                    database.ref('messages/' + id).remove().then(() => {
                        showNotification('warning', 'Delete Message', `Message ${id} has been deleted.`);
                        loadPage('messages');
                    }).catch((error) => {
                        console.error("Error deleting message:", error);
                        showNotification('error', 'Error', 'Failed to delete message.');
                    });
                    break;
                case 'view-meeting':
                    showNotification('info', 'Meeting Details', `Viewing meeting ${id}...`);
                    break;
                case 'edit-meeting':
                    showNotification('info', 'Edit Meeting', `Editing meeting ${id}...`);
                    break;
                case 'delete-meeting':
                    // Delete from Firebase
                    database.ref('meetings/' + id).remove().then(() => {
                        showNotification('warning', 'Delete Meeting', `Meeting ${id} has been deleted.`);
                        loadPage('meetings');
                    }).catch((error) => {
                        console.error("Error deleting meeting:", error);
                        showNotification('error', 'Error', 'Failed to delete meeting.');
                    });
                    break;
                case 'view-announcement':
                    showNotification('info', 'Announcement Details', `Viewing announcement ${id}...`);
                    break;
                case 'edit-announcement':
                    showNotification('info', 'Edit Announcement', `Editing announcement ${id}...`);
                    break;
                case 'delete-announcement':
                    // Delete from Firebase
                    database.ref('announcements/' + id).remove().then(() => {
                        showNotification('warning', 'Delete Announcement', `Announcement ${id} has been deleted.`);
                        loadPage('announcements');
                    }).catch((error) => {
                        console.error("Error deleting announcement:", error);
                        showNotification('error', 'Error', 'Failed to delete announcement.');
                    });
                    break;
                case 'view-report':
                    showNotification('info', 'Report Details', `Viewing report ${id}...`);
                    break;
                case 'edit-report':
                    showNotification('info', 'Edit Report', `Editing report ${id}...`);
                    break;
                case 'delete-report':
                    // Delete from Firebase
                    database.ref('reports/' + id).remove().then(() => {
                        showNotification('warning', 'Delete Report', `Report ${id} has been deleted.`);
                        loadPage('reports');
                    }).catch((error) => {
                        console.error("Error deleting report:", error);
                        showNotification('error', 'Error', 'Failed to delete report.');
                    });
                    break;
                default:
                    showNotification('info', 'Action', `Performing ${action} on ${id}...`);
            }
        }

        // Handle pagination
        function handlePagination(page) {
            if (page === 'prev' || page === 'next') {
                showNotification('info', 'Pagination', `Navigating to ${page} page...`);
            } else {
                showNotification('info', 'Pagination', `Loading page ${page}...`);
            }
        }

        // Handle chart options
        function handleChartOption(period) {
            // Update active option
            document.querySelectorAll('.chart-option').forEach(option => {
                option.classList.remove('active');
                if (option.getAttribute('data-period') === period) {
                    option.classList.add('active');
                }
            });
            
            showNotification('info', 'Chart Update', `Updating chart for ${period} period...`);
            
            // Update chart data
            if (performanceChart) {
                if (period === 'year') {
                    performanceChart.data.labels = ['Q1', 'Q2', 'Q3', 'Q4'];
                    performanceChart.data.datasets[0].data = [82, 85, 88, 90];
                } else {
                    performanceChart.data.labels = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun'];
                    performanceChart.data.datasets[0].data = [80, 85, 82, 88, 90, 92];
                }
                performanceChart.update();
            }
        }

        // Download file
        function downloadFile(fileName) {
            showNotification('success', 'Download Started', `Downloading ${fileName}...`);
            
            // Simulate download
            setTimeout(() => {
                showNotification('success', 'Download Complete', `${fileName} has been downloaded successfully.`);
            }, 2000);
        }

        // Attach event listeners for dynamically created elements
        function attachCardActionListeners() {
            document.querySelectorAll('.card[data-action]').forEach(card => {
                card.addEventListener('click', () => {
                    const action = card.getAttribute('data-action');
                    handleCardAction(action);
                });
            });
        }

        function attachTableActionListeners() {
            document.querySelectorAll('.action-icon').forEach(icon => {
                icon.addEventListener('click', (e) => {
                    e.stopPropagation();
                    const action = icon.getAttribute('data-action');
                    const id = icon.getAttribute('data-id');
                    handleTableAction(action, id);
                });
            });
        }

        function attachPaginationListeners() {
            document.querySelectorAll('.page-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    const page = btn.getAttribute('data-page');
                    handlePagination(page);
                });
            });
        }

        function attachChartOptionListeners() {
            document.querySelectorAll('.chart-option').forEach(option => {
                option.addEventListener('click', () => {
                    const period = option.getAttribute('data-period');
                    handleChartOption(period);
                });
            });
        }

        function attachFileDownloadListeners() {
            document.querySelectorAll('.download-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    e.stopPropagation();
                    const fileItem = btn.closest('.file-item');
                    const fileName = fileItem.getAttribute('data-file');
                    downloadFile(fileName);
                });
            });
        }

        // Handle responsive sidebar
        window.addEventListener('resize', () => {
            if (window.innerWidth > 1024) {
                sidebar.classList.remove('open');
                rightPanel.classList.remove('open');
            }
        });
    </script>
</body>
</html>
